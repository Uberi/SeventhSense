;(function(require,define,_,Backbone,ActiveXObject,require){ActiveXObject=window.ActiveXObject;;!function e(t,n,i){function a(r,s){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var _=n[r]={exports:{}};t[r][0].call(_.exports,function(e){var n=t[r][1][e];return a(n?n:e)},_,_.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)a(i[r]);return a}({1:[function(e,t,n){(function(){var e=this,i=e._,a={},o=Array.prototype,r=Object.prototype,s=Function.prototype,l=o.push,_=o.slice,c=o.concat,h=r.toString,d=r.hasOwnProperty,u=o.forEach,p=o.map,f=o.reduce,g=o.reduceRight,b=o.filter,m=o.every,v=o.some,y=o.indexOf,w=o.lastIndexOf,k=Array.isArray,x=Object.keys,S=s.bind,I=function(e){return e instanceof I?e:this instanceof I?void(this._wrapped=e):new I(e)};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=I),n._=I):e._=I,I.VERSION="1.6.0";var C=I.each=I.forEach=function(e,t,n){if(null==e)return e;if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,o=e.length;o>i;i++)if(t.call(n,e[i],i,e)===a)return}else for(var r=I.keys(e),i=0,o=r.length;o>i;i++)if(t.call(n,e[r[i]],r[i],e)===a)return;return e};I.map=I.collect=function(e,t,n){var i=[];return null==e?i:p&&e.map===p?e.map(t,n):(C(e,function(e,a,o){i.push(t.call(n,e,a,o))}),i)};var P="Reduce of empty array with no initial value";I.reduce=I.foldl=I.inject=function(e,t,n,i){var a=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return i&&(t=I.bind(t,i)),a?e.reduce(t,n):e.reduce(t);if(C(e,function(e,o,r){a?n=t.call(i,n,e,o,r):(n=e,a=!0)}),!a)throw new TypeError(P);return n},I.reduceRight=I.foldr=function(e,t,n,i){var a=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return i&&(t=I.bind(t,i)),a?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var r=I.keys(e);o=r.length}if(C(e,function(s,l,_){l=r?r[--o]:--o,a?n=t.call(i,n,e[l],l,_):(n=e[l],a=!0)}),!a)throw new TypeError(P);return n},I.find=I.detect=function(e,t,n){var i;return T(e,function(e,a,o){return t.call(n,e,a,o)?(i=e,!0):void 0}),i},I.filter=I.select=function(e,t,n){var i=[];return null==e?i:b&&e.filter===b?e.filter(t,n):(C(e,function(e,a,o){t.call(n,e,a,o)&&i.push(e)}),i)},I.reject=function(e,t,n){return I.filter(e,function(e,i,a){return!t.call(n,e,i,a)},n)},I.every=I.all=function(e,t,n){t||(t=I.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,n):(C(e,function(e,o,r){return(i=i&&t.call(n,e,o,r))?void 0:a}),!!i)};var T=I.some=I.any=function(e,t,n){t||(t=I.identity);var i=!1;return null==e?i:v&&e.some===v?e.some(t,n):(C(e,function(e,o,r){return i||(i=t.call(n,e,o,r))?a:void 0}),!!i)};I.contains=I.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):T(e,function(e){return e===t})},I.invoke=function(e,t){var n=_.call(arguments,2),i=I.isFunction(t);return I.map(e,function(e){return(i?t:e[t]).apply(e,n)})},I.pluck=function(e,t){return I.map(e,I.property(t))},I.where=function(e,t){return I.filter(e,I.matches(t))},I.findWhere=function(e,t){return I.find(e,I.matches(t))},I.max=function(e,t,n){if(!t&&I.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var i=-1/0,a=-1/0;return C(e,function(e,o,r){var s=t?t.call(n,e,o,r):e;s>a&&(i=e,a=s)}),i},I.min=function(e,t,n){if(!t&&I.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var i=1/0,a=1/0;return C(e,function(e,o,r){var s=t?t.call(n,e,o,r):e;a>s&&(i=e,a=s)}),i},I.shuffle=function(e){var t,n=0,i=[];return C(e,function(e){t=I.random(n++),i[n-1]=i[t],i[t]=e}),i},I.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=I.values(e)),e[I.random(e.length-1)]):I.shuffle(e).slice(0,Math.max(0,t))};var M=function(e){return null==e?I.identity:I.isFunction(e)?e:I.property(e)};I.sortBy=function(e,t,n){return t=M(t),I.pluck(I.map(e,function(e,i,a){return{value:e,index:i,criteria:t.call(n,e,i,a)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index-t.index}),"value")};var E=function(e){return function(t,n,i){var a={};return n=M(n),C(t,function(o,r){var s=n.call(i,o,r,t);e(a,s,o)}),a}};I.groupBy=E(function(e,t,n){I.has(e,t)?e[t].push(n):e[t]=[n]}),I.indexBy=E(function(e,t,n){e[t]=n}),I.countBy=E(function(e,t){I.has(e,t)?e[t]++:e[t]=1}),I.sortedIndex=function(e,t,n,i){n=M(n);for(var a=n.call(i,t),o=0,r=e.length;r>o;){var s=o+r>>>1;n.call(i,e[s])<a?o=s+1:r=s}return o},I.toArray=function(e){return e?I.isArray(e)?_.call(e):e.length===+e.length?I.map(e,I.identity):I.values(e):[]},I.size=function(e){return null==e?0:e.length===+e.length?e.length:I.keys(e).length},I.first=I.head=I.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:_.call(e,0,t)},I.initial=function(e,t,n){return _.call(e,0,e.length-(null==t||n?1:t))},I.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:_.call(e,Math.max(e.length-t,0))},I.rest=I.tail=I.drop=function(e,t,n){return _.call(e,null==t||n?1:t)},I.compact=function(e){return I.filter(e,I.identity)};var A=function(e,t,n){return t&&I.every(e,I.isArray)?c.apply(n,e):(C(e,function(e){I.isArray(e)||I.isArguments(e)?t?l.apply(n,e):A(e,t,n):n.push(e)}),n)};I.flatten=function(e,t){return A(e,t,[])},I.without=function(e){return I.difference(e,_.call(arguments,1))},I.partition=function(e,t){var n=[],i=[];return C(e,function(e){(t(e)?n:i).push(e)}),[n,i]},I.uniq=I.unique=function(e,t,n,i){I.isFunction(t)&&(i=n,n=t,t=!1);var a=n?I.map(e,n,i):e,o=[],r=[];return C(a,function(n,i){(t?i&&r[r.length-1]===n:I.contains(r,n))||(r.push(n),o.push(e[i]))}),o},I.union=function(){return I.uniq(I.flatten(arguments,!0))},I.intersection=function(e){var t=_.call(arguments,1);return I.filter(I.uniq(e),function(e){return I.every(t,function(t){return I.contains(t,e)})})},I.difference=function(e){var t=c.apply(o,_.call(arguments,1));return I.filter(e,function(e){return!I.contains(t,e)})},I.zip=function(){for(var e=I.max(I.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=I.pluck(arguments,""+n);return t},I.object=function(e,t){if(null==e)return{};for(var n={},i=0,a=e.length;a>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},I.indexOf=function(e,t,n){if(null==e)return-1;var i=0,a=e.length;if(n){if("number"!=typeof n)return i=I.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,a+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;a>i;i++)if(e[i]===t)return i;return-1},I.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(w&&e.lastIndexOf===w)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var a=i?n:e.length;a--;)if(e[a]===t)return a;return-1},I.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),a=0,o=new Array(i);i>a;)o[a++]=e,e+=n;return o};var O=function(){};I.bind=function(e,t){var n,i;if(S&&e.bind===S)return S.apply(e,_.call(arguments,1));if(!I.isFunction(e))throw new TypeError;return n=_.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(_.call(arguments)));O.prototype=e.prototype;var a=new O;O.prototype=null;var o=e.apply(a,n.concat(_.call(arguments)));return Object(o)===o?o:a}},I.partial=function(e){var t=_.call(arguments,1);return function(){for(var n=0,i=t.slice(),a=0,o=i.length;o>a;a++)i[a]===I&&(i[a]=arguments[n++]);for(;n<arguments.length;)i.push(arguments[n++]);return e.apply(this,i)}},I.bindAll=function(e){var t=_.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return C(t,function(t){e[t]=I.bind(e[t],e)}),e},I.memoize=function(e,t){var n={};return t||(t=I.identity),function(){var i=t.apply(this,arguments);return I.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},I.delay=function(e,t){var n=_.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},I.defer=function(e){return I.delay.apply(I,[e,1].concat(_.call(arguments,1)))},I.throttle=function(e,t,n){var i,a,o,r=null,s=0;n||(n={});var l=function(){s=n.leading===!1?0:I.now(),r=null,o=e.apply(i,a),i=a=null};return function(){var _=I.now();s||n.leading!==!1||(s=_);var c=t-(_-s);return i=this,a=arguments,0>=c?(clearTimeout(r),r=null,s=_,o=e.apply(i,a),i=a=null):r||n.trailing===!1||(r=setTimeout(l,c)),o}},I.debounce=function(e,t,n){var i,a,o,r,s,l=function(){var _=I.now()-r;t>_?i=setTimeout(l,t-_):(i=null,n||(s=e.apply(o,a),o=a=null))};return function(){o=this,a=arguments,r=I.now();var _=n&&!i;return i||(i=setTimeout(l,t)),_&&(s=e.apply(o,a),o=a=null),s}},I.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},I.wrap=function(e,t){return I.partial(t,e)},I.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},I.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},I.keys=function(e){if(!I.isObject(e))return[];if(x)return x(e);var t=[];for(var n in e)I.has(e,n)&&t.push(n);return t},I.values=function(e){for(var t=I.keys(e),n=t.length,i=new Array(n),a=0;n>a;a++)i[a]=e[t[a]];return i},I.pairs=function(e){for(var t=I.keys(e),n=t.length,i=new Array(n),a=0;n>a;a++)i[a]=[t[a],e[t[a]]];return i},I.invert=function(e){for(var t={},n=I.keys(e),i=0,a=n.length;a>i;i++)t[e[n[i]]]=n[i];return t},I.functions=I.methods=function(e){var t=[];for(var n in e)I.isFunction(e[n])&&t.push(n);return t.sort()},I.extend=function(e){return C(_.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},I.pick=function(e){var t={},n=c.apply(o,_.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},I.omit=function(e){var t={},n=c.apply(o,_.call(arguments,1));for(var i in e)I.contains(n,i)||(t[i]=e[i]);return t},I.defaults=function(e){return C(_.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},I.clone=function(e){return I.isObject(e)?I.isArray(e)?e.slice():I.extend({},e):e},I.tap=function(e,t){return t(e),e};var N=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof I&&(e=e._wrapped),t instanceof I&&(t=t._wrapped);var a=h.call(e);if(a!=h.call(t))return!1;switch(a){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]==e)return i[o]==t;var r=e.constructor,s=t.constructor;if(r!==s&&!(I.isFunction(r)&&r instanceof r&&I.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),i.push(t);var l=0,_=!0;if("[object Array]"==a){if(l=e.length,_=l==t.length)for(;l--&&(_=N(e[l],t[l],n,i)););}else{for(var c in e)if(I.has(e,c)&&(l++,!(_=I.has(t,c)&&N(e[c],t[c],n,i))))break;if(_){for(c in t)if(I.has(t,c)&&!l--)break;_=!l}}return n.pop(),i.pop(),_};I.isEqual=function(e,t){return N(e,t,[],[])},I.isEmpty=function(e){if(null==e)return!0;if(I.isArray(e)||I.isString(e))return 0===e.length;for(var t in e)if(I.has(e,t))return!1;return!0},I.isElement=function(e){return!(!e||1!==e.nodeType)},I.isArray=k||function(e){return"[object Array]"==h.call(e)},I.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){I["is"+e]=function(t){return h.call(t)=="[object "+e+"]"}}),I.isArguments(arguments)||(I.isArguments=function(e){return!(!e||!I.has(e,"callee"))}),"function"!=typeof/./&&(I.isFunction=function(e){return"function"==typeof e}),I.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},I.isNaN=function(e){return I.isNumber(e)&&e!=+e},I.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==h.call(e)},I.isNull=function(e){return null===e},I.isUndefined=function(e){return void 0===e},I.has=function(e,t){return d.call(e,t)},I.noConflict=function(){return e._=i,this},I.identity=function(e){return e},I.constant=function(e){return function(){return e}},I.property=function(e){return function(t){return t[e]}},I.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},I.times=function(e,t,n){for(var i=Array(Math.max(0,e)),a=0;e>a;a++)i[a]=t.call(n,a);return i},I.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},I.now=Date.now||function(){return(new Date).getTime()};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};j.unescape=I.invert(j.escape);var V={escape:new RegExp("["+I.keys(j.escape).join("")+"]","g"),unescape:new RegExp("("+I.keys(j.unescape).join("|")+")","g")};I.each(["escape","unescape"],function(e){I[e]=function(t){return null==t?"":(""+t).replace(V[e],function(t){return j[e][t]})}}),I.result=function(e,t){if(null==e)return void 0;var n=e[t];return I.isFunction(n)?n.call(e):n},I.mixin=function(e){C(I.functions(e),function(t){var n=I[t]=e[t];I.prototype[t]=function(){var e=[this._wrapped];return l.apply(e,arguments),H.call(this,n.apply(I,e))}})};var B=0;I.uniqueId=function(e){var t=++B+"";return e?e+t:t},I.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var F=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;I.template=function(e,t,n){var i;n=I.defaults({},n,I.templateSettings);var a=new RegExp([(n.escape||F).source,(n.interpolate||F).source,(n.evaluate||F).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(a,function(t,n,i,a,s){return r+=e.slice(o,s).replace(D,function(e){return"\\"+L[e]}),n&&(r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(r+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),a&&(r+="';\n"+a+"\n__p+='"),o=s+t.length,t}),r+="';\n",n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{i=new Function(n.variable||"obj","_",r)}catch(s){throw s.source=r,s}if(t)return i(t,I);var l=function(e){return i.call(this,e,I)};return l.source="function("+(n.variable||"obj")+"){\n"+r+"}",l},I.chain=function(e){return I(e).chain()};var H=function(e){return this._chain?I(e).chain():e};I.mixin(I),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=o[e];I.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],H.call(this,n)}}),C(["concat","join","slice"],function(e){var t=o[e];I.prototype[e]=function(){return H.call(this,t.apply(this._wrapped,arguments))}}),I.extend(I.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return I})}).call(this)},{}],2:[function(require,module,exports){function wc_config(){return new hbl.hconfig}function wc_init(e,t){if(!(hblHasinit||document.URL.search("hblNoInit")>-1)&&(hblHasinit=1,hbl.util.BrowserDetect.init(),hbl.util.BrowserDetect.supported||!hblHideUnsupported)){if(e=e||window.__get_olark_key(),"undefined"==typeof e||!e){var n=document.getElementById("hbl_code");if(n){var i=n.href.split("#");e=i[1],n.style.display="none"}else e="missing-site-id"}if(olark._.identityManager.setSiteId(e),hbl.config=t,t&&t.palette)for(var a in t.palette)"string"==typeof t.palette[a]&&(hbl.need_ugly_backwards_palette_hack=!0);hbl.started=0,hbl.prev_onload=window.onload,window.onload=function(){habla_load_func(hbl.prev_onload)},window.setTimeout(function(){habla_load_func(hbl.prev_onload)},2500)}}function habla_load_func(e){if(!hbl.started){if(hbl.started=1,e&&"function"==typeof e)try{e()}catch(t){}hblJSInline||hbl.util.simple_load_js_async(hblPostStub),hbl.eventmgr.handle("habla_called_wc_init")}}function habla_start_func(){if(!hbl.post_started){if(hbl.post_started=1,olark._.identityManager.getSiteId()?"missing-site-id"==olark._.identityManager.getSiteId()&&olark._.identityManager.setSiteId(window.__get_olark_key()):olark._.identityManager.setSiteId(window.__get_olark_key()),window.habla_window||(habla_window=new hbl._hwindow(hbl.client,hbl.config,hbl.eventmgr),hbl.eventmgr.setWindow(habla_window),habla_window.register_handlers()),hbl.config.vars.local_mode)return hbl.client.start(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),hbl.eventmgr,hbl.config),habla_window.setTheme(hbl.config.vars.theme_obj),habla_window.config.vars.welcome_msg="Hab.la is in testing mode. set <em>config.vars['local_mode'] = false;</em> to go back to normal.",habla_window.config.vars.in_chat_text="Hab.la Local Mode",habla_window.config.vars.before_chat_text="Hab.la Local Mode",habla_window.config.vars.not_available_text="Hab.la Local Mode",habla_window.setHeader(habla_window.config.vars.not_available_text),void habla_window.show(1);var e=olark._.identityManager.getSiteId();if(e&&(e.match(/(olark|\@)/i)||!e.match(/\d\d*\-\d/))&&hbl.config.vars.theme_obj)return void habla_error({etype:"invalid_site_id"});if(!e&&hbl.config.vars.theme_obj)return void habla_error({etype:"invalid_site_link"});hbl.eventmgr.register("habla_error",habla_error,10),hbl.client.start(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),hbl.eventmgr,hbl.config),hbl.eventmgr.handle("habla_started")}}function habla_error(e){"invalid_site_id"==e.etype?(hbl.client.eventmgr=new hbl.util.eventmanager,habla_window.setTheme(hbl.config.vars.theme_obj),habla_window.config.vars.offline_message="<em>"+olark._.identityManager.getSiteId()+"</em> is not a valid <a href='"+hblInstallUrl+"'>"+hblName+"</a> site ID.<p> Your "+hblName+" Site ID is in the format '###-##-###-##' and can be found on your <a href='"+hblInstallUrl+"' target='_blank'>Dashboard</a>.</p>",habla_window.config.vars.not_available_text=hblName+": Site ID Error",habla_window.setHeader(habla_window.config.vars.not_available_text),habla_window.show(1),habla_window.theme.habla_conversation_div.scrollTop=0):"invalid_site_link"==e.etype?(hbl.client.eventmgr=new hbl.util.eventmanager,habla_window.setTheme(hbl.config.vars.theme_obj),habla_window.config.vars.offline_message="Unable to determine your site-id.  Please make sure you have copied and pasted all the code as it appears on your <a href='"+hblInstallUrl+"' target='_blank'>"+hblName+" Dashboard</a>.",habla_window.config.vars.not_available_text=hblName+": Site ID Error",habla_window.setHeader(habla_window.config.vars.not_available_text),habla_window.show(1),habla_window.theme.habla_conversation_div.scrollTop=0):"operator_is_busy"==e.etype&&(hbl.client.opbusy=!0,habla_window.opbusy=!0,habla_window.setWindowText())}function wc_init_post(e){if(window.olark&&window.olark.__legacy_shim&&hbl.util.BrowserDetect.init(),hbl.config=hbl.config||new hbl.hconfig,!hbl.config.merge){var t=hbl.config;hbl.config=new hbl.hconfig,hbl.config.merge(t,!0)}(hbl.config.vars.disable_get_cookies||hbl.config.vars.wcsid)&&(hbl.config.vars.wcsid&&olark._.identityManager.setConversationId(hbl.config.vars.wcsid),hbl.config.vars.hblid&&olark._.identityManager.setVisitorId(hbl.config.vars.hblid)),hbl.config.plugins||(hbl.config.plugins=new hbl.util.pluginlist),e=e||["incoming_notification","away_div_handler","expand_on_receive_message","google_translate","auto_initiate"];for(var n=0;n<e.length;n++){var i=e[n],a=new hbl.plugins[i];hbl.config.plugins.add(a)}hbl.eventmgr.handle("habla_preload_done"),habla_start_func()}function exportLegacyGlobal(e,t){window[e]=t}!function(){function e(e){switch(e){case"api.chat.getVisitorNickname":case"api.chat.getVisitorStatus":case"api.chat.operatorsAreAvailable":case"api.chat.operatorsAreBusy":case"api.chat.operatorsAreAway":case"api.chat.onNotificationToVisitor":case"api.chat.getVisitorNickname":case"api.chat.getVisitorNickname":return!0;default:return!1}}function t(e){return function(){var t=function(){},n={};window.console?(n=window.console,t=window.console[e]||window.console.info||t):window.opera&&(n=window.opera,t=window.opera.postError||t);try{t.apply(n,arguments)}catch(i){try{t(arguments.join(" "))}catch(i){}}}}function n(e){function t(){n._releaseActive()}var n=this;e=e||{},this._win=e.window||window,this._doc=e.document||this._win.document,this._prefixes=["webkit","moz","ms","o"],this._localStorage=e.localStorage||this._win.localStorage,this._idStorageKey=e.idStorageKey||"_BrowserTabIDStorageKey",this._id=(""+Math.random()+Math.random()).replace(/\./g,""),this._listen(this._win,"unload",t),this._listen(this._win,"beforeunload",t),this._supportsVisibility()?this._initializeWithVisibility():this._initializeWithBlurring(),this.hidden()&&this._anyTabsActive()||this._makeActive()}olark._.P("application"),olark("api.chat.onBeginConversation",function(){olark._.hlog("started chatting #begin_conversation")});var i=(olark._?olark._.versions:null,/^\s*(__Extension0\..+|__ChatApiHelper|__BoxApiHelper|[A-Z]\w+)\s*$/),a=/^\s*(api|box|browser|chat|data|extensions|system|olark|.*olark.*)\s*$/,o=6,r=6,s={GoogleAnalytics:null,VisitorInsight:null,VisitorImportance:null,OfflineWarning:null,EndConversation:null},l="3a36a58c72d4661d9a9ac484606f012e",_="bf177f47611e55d4707c4d9942b696e0",c="423092e252ccbf364ff4b006e43a1b3b",h="a019e45d1183d9dd0d80ab0b3c283982",d="f06d866d2e973c62cf196ca6cc010eac",u={Shopify:l,WelcomeAssist:_,CalloutBubble:c,OfflineWarning:h,Cobrowse:d},p=/.*YOUR-SITE-ID-HERE.*/,f="0000-0000-0000-0000",g=5,b=50;olark.extend("VisitorInsight"),olark.extend("VisitorImportance"),olark.extend("OfflineWarning"),olark.extend("EndConversation"),function(){window.olark.__buildinfo=window.olark.__buildinfo||{olarkfile:"/javascript/olark.js",corefile:"/javascript/application.js",jshost:window.olark.__version?"static.olark.com":"olarkdev:8001",dev:!0}}();var m;if(window.olark.__buildinfo.dev)m={log:t("log"),info:t("info"),warn:t("warn"),error:t("error"),debug:t("debug"),showErrorBacktrace:t("error")};else{m={log:function(){},info:function(){},warn:t("warn"),error:t("error"),debug:function(){},showErrorBacktrace:function(){}};var v=m.error,y=m.warn,w=null;try{w=navigator.appName+" - "+navigator.appVersion}catch(k){}m.error=function(){try{var e=Array.prototype.slice.call(arguments||[]);olark._.hlog(e.join(" "),"#error")}catch(t){}try{v.apply(m,arguments)}catch(t){}},m.warn=function(){try{var e=Array.prototype.slice.call(arguments||[]);olark._.hlog(e.join(" "),"#warn")}catch(t){}try{y.apply(m,arguments)}catch(t){}}}window.olark.__legacy_shim=window.olark.__legacy_shim||{},document.hbl_ssl=/.*https:.*/.test(document.location.protocol)?!0:!1;var x=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n};!function(e){e.active=function(){if(arguments.length>0)throw new Error("'active' property is not settable");return this._localStorage||window.console&&window.console.warn&&window.console.warn("localStorage is required to use the active() property"),this._localStorage.getItem(this._idStorageKey)===this._id},e.hidden=function(){if(arguments.length>0)throw new Error("'hidden' property is not settable");return this._supportsVisibility()?this._getProperty(this._doc,"hidden"):this._blurred},e.on=function(e,t){e=e.split(/\s+/);for(var n=0;n<e.length;n++){var i=e[n];switch(i){case"change:hidden":this._listenForVisibilityChange(t);break;case"change:active":this._listenForActiveChange(t);break;default:throw new Error("invalid event '"+i+"'")}}},e._getProperty=function(e,t){var n=t.charAt(0).toString().toUpperCase()+t.slice(1);if(t in e)return e[t];var i;return this._eachBrowserPrefix(function(t){var a=t+n;a in e&&(i=e[a])}),i},e._supportsVisibility=function(){var e=this._getProperty(this._doc,"visibilityState");return"undefined"!==e},e._eachBrowserPrefix=function(e){for(var t=0;t<this._prefixes.length;t++)e(this._prefixes[t])},e._listen=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},e._listenForVisibilityChange=function(e){var t=this;this._listen(this._doc,"visibilitychange",e),this._eachBrowserPrefix(function(n){t._listen(t._doc,n+"visibilitychange",e)}),this._blurChangeCallbacks&&this._blurChangeCallbacks.push(e)},e._listenForActiveChange=function(e){var t=this;this._localStorage&&this._listen(this._win,"storage",function(n){n=n||window.event,n.key===t._idStorageKey&&e()})},e._makeActive=function(){this._localStorage&&this._localStorage.setItem(this._idStorageKey,this._id)},e._releaseActive=function(){if(this._localStorage){var e=this._localStorage.getItem(this._idStorageKey);e===this._id&&this._localStorage.removeItem(this._idStorageKey)}},e._anyTabsActive=function(){if(this._localStorage){var e=this._localStorage.getItem(this._idStorageKey);return"undefined"!==e}return!1},e._initializeWithVisibility=function(){function e(){t._blurred=t.hidden(),t.hidden()||t._makeActive()}var t=this;this._blurred=this.hidden(),this._uncertain=!1,e(),this._listenForVisibilityChange(e)},e._initializeWithBlurring=function(){function e(){for(var e=0;e<i.length;e++)setTimeout(i[e],0)}function t(){a._blurred=!0,a._uncertain=!1,e()}function n(){a._blurred=!1,a._uncertain=!1,a._makeActive(),e()}var i,a=this;this._blurred=!1,this._uncertain=!0,this._blurChangeCallbacks=i=[],this._listen(this._doc,"focusin",n),this._listen(this._doc,"focusout",t),this._listen(this._win,"focus",n),this._listen(this._win,"blur",t),this._listen(this._doc,"scroll",n),this._listen(this._doc,"keydown",n),this._listen(this._doc,"mousemove",n),this._listen(this._doc,"select",n),this._listen(this._win,"scroll",n),this._listen(this._win,"keydown",n),this._listen(this._win,"mousemove",n),this._listen(this._win,"select",n),this._listenForActiveChange(function(){a.active()||t()})}}(n.prototype);var S=null,I=null;!function(){var e={};S=function(t){var n=t.namespace,i=t.type,a=t.callback;if(!n)throw new Error("[olark] namespace required");if(!i)throw new Error("[olark] type required");if(!a)throw new Error("[olark] callback required");e[n]=e[n]||{},e[n][i]=e[n][i]||[],e[n][i].push(a)},I=function(t){var n=t.namespace,i=t.type,a=t.after||null,o=t;if(!n)throw new Error("[olark] namespace required");if(!i)throw new Error("[olark] type required");try{o.namespace=void 0,o.type=void 0,delete o.namespace,delete o.type,delete o.after}catch(r){}e[n]=e[n]||{};for(var s=e[n][i]||[],l=0;l<s.length;){var _=s[l++];_&&F(function(){_(o)},function(e){m.error("[olark] event handler for '"+n+"."+i+"' failed: "+e.toString()),m.showErrorBacktrace(e)})}a&&a()}}();var C=null,P=null,T=null,M=null,E=null,A=null,O=null,N=null,j=null,V=null,B=null,F=null;!function(){var e=[];E=function(t,n){var i=t.delay,a=setTimeout(n,i);return e.push(a),a},A=function(){for(var t=e.length;t--;)clearTimeout(e[t])},C=function(e){var t=!1;return function(){return t?void 0:(t=!0,e.apply(e,arguments))}},P=function(e){for(var t=e.length,n="\n";t--;){var i=e[t];n+=0===t?"- "+i:"- "+i+"\n"}return n},V=function(e){var t=e.url;if("string"!=typeof t)throw new Error("[olark] string 'url' is required");var n=-1!=t.indexOf("http://"),i=-1!=t.indexOf("https://"),a=0!==t.split("/")[0].indexOf(".");return!n&&!i&&!a};var t={};T=function(e){var n=e.url;if("string"!=typeof n)throw new Error("[olark] string 'url' is required");var i="https:"==document.location.protocol?!0:!1,a=-1==n.indexOf("http://")?!1:!0,o=-1==n.indexOf("https://")?!1:!0,r=a||o,s=null;if(s=V({url:n})?n:r?n:(i?"https://":"http://")+n,i&&r&&!o&&m.warn("[olark] you cannot load from ",s," when you are on an SSL page, you will probably get mixed-content warnings"),!t[s]){t[s]=!0;var l=document.createElement("script"),_=document.getElementsByTagName("script")[0];l.setAttribute("async",""),l.setAttribute("defer","true"),l.src=s,_.parentNode.insertBefore(l,_)}},M=function(e,t){var n=!1,i=function(){n||(n=!0,t())},a=function(){e()?i():n||E({delay:b},a)};a()},O=function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=O(e[n]));return t},N=function(e,t){if(e==t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t))return!0;if("object"==typeof e&&"object"==typeof t&&null!==e&&null!==t){for(var n in e)if(!N(e[n],t[n]))return!1;for(var i in t)if(!N(e[i],t[i]))return!1;return!0}return!1},j=function(e){return e.replace(/\s+$/,"").replace(/^\s+/,"")},B=function(e){if("undefined"==typeof e.list)throw new Error("[olark] 'list' required");if("undefined"==typeof e.separator)throw new Error("[olark] 'separator' required");for(var t=e.list,n=e.separator,i=!0,a="",o=0;o<t.length;o++){var r=t[o];i?(i=!1,a+=r):a+=n+r}return a},F=function(e,t){if(window.olark.__buildinfo.strict)return e();try{return e()}catch(n){return t(n)}}}();var L=function(e,t){var n=window[e];if(!n)throw new Error("[lightloader] stub library not defined: "+e);var i=n.__lightload,a={publicMethods:{}},o=[],r=[];a.getLightloaderVersion=function(){return i.V},a.isDocumentReady=function(){return i.A||0},a.isWindowLoaded=function(){return i.B||0},a.whenDocumentReady=function(e){a.isDocumentReady()?e():o.push(e)},a.whenWindowLoaded=function(e){a.isWindowLoaded()?e():r.push(e)},a.reloadLibrary=function(){i.D=[],i.l()};var s=function(e){for(var t=e.length>0?e.shift():void 0;t;)t(),t=e.shift()},l=function(){var e=i.D;e.reverse();for(var t=e.length;t-->0;){var a=e[t],o=a[0],r=a[1],s=n[o];s?s.apply(n,r):window.console&&window.console.error&&window.console.error("[lightloader] missing method '"+o+"'")}e.reverse()};i.a=function(){i.A=!0,s(o)},i.b=function(){i.B=!0,s(r)},t(n,a),olark.extend=a.publicMethods.extend,olark.declare=a.publicMethods.declare,olark.configure=a.publicMethods.configure,olark.ready=a.publicMethods.ready,l()},D=function(t,n){function i(e,t){s.push([e,t]),l()}function a(){for(var t,n,a,s,l,_=o.callstack;_.length;)if(t=_.shift(),t&&t.length)try{a=Array.prototype.slice.call(t||[]),n=a.length?a.shift():void 0,l=/api\.[a-zA-Z]+\.(__SPI_)?[a-zA-Z]+/.test(n),"debug"==n?!function(){var e=document.createElement("script");e.src="https://static.olark.com/record.js",document.getElementsByTagName("head")[0].appendChild(e)}():l?e(n)?m.warn("[olark] the API call '"+n+"' is deprecated"):i(n,a):r.publicMethods.hasOwnProperty(n)?(s=r.publicMethods[n],s.apply(s,a)):m.warn("[olark] unknown method 'olark."+n+"'")}catch(c){m.error("[olark] unknown exception in dequeueCallbacks: method: "+n+" ",c.message)}else m.warn("[olark] empty method call in dequeueCallbacks #empty_dequeue_call")}var o=olark._,r=(o.P,{publicMethods:{}});r.getLightloaderVersion=function(){return o.v},r.whenDocumentReady=function(e){e()},r.reloadLibrary=function(){olark._=null,olark=null,o.i()};var s=[],l=function(){};olark.extend(function(e){l=function(){for(var t;s.length;){t=s.shift();var n=t[0],i=t[1],a=n.split("."),o=a[1],r=a[2];if(e[o]&&e[o][r])try{e[o][r].apply(e[o],i)}catch(l){m.error(l.toString())}else m.warn("[olark] unknown API call '"+n+"'")}},s.length>0&&l()}),n(olark,r),r.publicMethods.call=function(e,t){var n=r.publicMethods[e];n?n.apply(n,t):m.warn("[olark] unknown method 'olark."+e+"'")},olark._.s={push:function(e){o.callstack.push(e),a()}},a()};!function(){var e=window.olark;if(e.__v){m.warn("[olark] you are using an old version of the Olark Code on your page, please check your dashboard to get the new code.");var t=olark.__v[0],n=olark.__v[1],i=olark.__v[2],a=olark.__v[3];for(var o in t)"function"!=typeof t[o]&&e.configure.apply(e,t[o]);for(var r in n)"function"!=typeof n[r]&&e.extend.apply(e,n[r]);for(var s in i)"function"!=typeof i[s]&&e.declare.apply(e,i[s]);for(var l in a)"function"!=typeof a[l]&&e.ready.apply(e,a[l]);e.__lightload.A=!0}}();var H=function(e,t){olark._?D(e,t):L(e,t)};H("olark",function(e,t){var l=function(e){var t=this;if(t.__name=e.name,t.__startup=e.startup,"undefined"==typeof t.__name)throw new Error("[olark] 'name' required");if("undefined"==typeof t.__startup)throw new Error("[olark] 'startup' required");t.__version=e.version||null,t.__source=e.source||null
};!function(t){t.get_name=function(){var e=this;return e.__name},t.get_version=function(){var e=this;return e.__version},t.get_source=function(){var e=this;return e.__source},t.get_pretty_string=function(){var e=this,t=e.__name;return e.__version&&e.__source?t+=" (version "+e.__version+", from "+e.__source+")":e.__version&&(t+=" (version "+e.__version+")"),t},t.activate=function(t){var n=this,i=t.configuration;if("undefined"==typeof i)throw new Error("[olark] 'configuration' required");var a=/__.+/.test(n.__name),o=a?"__inline":n.__name;if(i[o]&&i[o].enabled===!1);else{var r=new e.__core.api.ApiInstance({conf:i,namespace:o,extension_name:n.__name});n.__startup(r,i),I({namespace:"Extension",type:"extensionActivated"})}}}(l.prototype);var _=function(e){var t=this;if(t.__name=e.name,"undefined"==typeof t.__name)throw new Error("[olark] 'name' required");t.__version=e.version||null,t.__source=e.source||c.get_instance().get_expected_source_for_extension({name:t.__name})};!function(e){e.get_name=function(){var e=this;return e.__name},e.get_version=function(){var e=this;return e.__version},e.get_source=function(){var e=this;return e.__source},e.get_pretty_string=function(){var e=this;return e.__name&&e.__version&&e.__source?e.__name+" (version "+e.__version+", from "+e.__source+")":e.__name&&e.__version?e.__name+" (version "+e.__version+")":e.__name&&e.__source?e.__name+" (from "+e.__source+")":e.__name},e.begin_download=function(){var e=this;e.__source&&T({url:e.__source})},e.is_downloaded=function(){var e=this,t=c.get_instance().search_for_extension({extension_spec:e});return t.length>0?!0:!1},e.when_downloaded=function(e){var t=this,n=!1,i=function(){t.is_downloaded()&&!n&&(n=!0,e())};i(),S({namespace:"ExtensionManager",type:"registeredExtension",callback:i})}}(_.prototype);var c=function(){var e=this;e.__extension_specs=[],e.__extension_specs_by_name={},e.__extensions_by_name={},e.__extensions_by_source={},e.__extensions_by_name_and_version={},e.__extensions_by_name_and_source={},e.__extensions_by_name_and_version_and_source={}};!function(t){var n=null;c.get_instance=function(){return n=n||new c};var o=0;c.get_next_extension_name=function(){return o+=1,"__Extension0."+o},t.__lazy_load_data_structures=function(e){var t=this,n=e.name,i=e.version,a=e.source;t.__extensions_by_name[n]=t.__extensions_by_name[n]||[],t.__extensions_by_source[a]=t.__extensions_by_name[a]||[],t.__extensions_by_name_and_version[n]=t.__extensions_by_name_and_version[n]||{},t.__extensions_by_name_and_version[n][i]=t.__extensions_by_name_and_version[n][i]||[],t.__extensions_by_name_and_source[n]=t.__extensions_by_name_and_source[n]||{},t.__extensions_by_name_and_source[n][a]=t.__extensions_by_name_and_source[n][a]||[],t.__extensions_by_name_and_version_and_source[n]=t.__extensions_by_name_and_version_and_source[n]||{},t.__extensions_by_name_and_version_and_source[n][i]=t.__extensions_by_name_and_version_and_source[n][i]||{},t.__extensions_by_name_and_version_and_source[n][i][a]=t.__extensions_by_name_and_version_and_source[n][i][a]||[]},t.get_expected_source_for_extension=function(t){if("undefined"==typeof t.name)throw new Error("[olark] 'name' required for extension source lookup");var n=t.name,o=i.test(n)?!1:!0;if(o=o||a.test(n.toLowerCase()),o=o||/.*_.*/.test(n),"undefined"!=typeof s[n])return s[n];if(o)return null;for(var r="",l=0;l<n.length;l++){var _=n[l]||n.slice(l,l+1);/[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/.test(_)?(r.length>0&&(r+="-"),r+=_.toLowerCase()):r+=_}var c=e._&&e._.plugins?e._.plugins:window.olark.__buildinfo.jshost+"/javascript/plugins",h=u[n]||"1",d=c+"/"+r+".js?v="+h;return d},t.register_declared_extension=function(e){var t=this,n=e.extension;if("undefined"==typeof n)throw new Error("[olark] 'extension' required");var i=n.get_name(),a=n.get_version(),o=n.get_source();o&&V({url:o})&&(o=null),t.__lazy_load_data_structures({name:i,version:a,source:o}),t.__extensions_by_name[i].push(n),t.__extensions_by_source[o].push(n),t.__extensions_by_name_and_version[i][a].push(n),t.__extensions_by_name_and_source[i][o].push(n),t.__extensions_by_name_and_version_and_source[i][a][o].push(n),I({namespace:"ExtensionManager",type:"registeredExtension"})},t.for_each_extension_spec=function(e){for(var t=this,n=t.__extension_specs.length,i=t.__extension_specs,a=0;n>a;)!function(t){F(function(){e(t,i)},function(e){m.error("[olark] error while iterating over required extension spec:",t,"error was: "+e.toString()),m.showErrorBacktrace(e)})}(t.__extension_specs[a]),a++},t.register_extension_spec=function(e){var t=this,n=e.extension_spec;if("undefined"==typeof n)throw new Error("[olark] 'extension_spec' required");var i=n.get_name(),a=n.get_version(),o=n.get_source();o&&V({url:o})&&(o=null);var r=t.__extension_specs_by_name[i];if(!r||r.get_source()!==n.get_source()){if(r){var s=r.get_version(),l=r.get_source();a&&o&&s&&l?(a!=s||o!=l)&&m.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",r.get_pretty_string()):a&&s?a!=s&&m.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",r.get_pretty_string()):o&&l&&o!=l&&m.warn("[olark] conflicting extensions:",n.get_pretty_string(),"and",r.get_pretty_string())}n.begin_download(),t.__extension_specs.unshift(n),t.__extension_specs_by_name[i]=n,I({namespace:"ExtensionManager",type:"registeredExtensionSpec"})}},t.search_for_extension=function(e){var t=this,n=e.name,i=e.version,a=e.source,o=e.extension_spec;if(o&&(n=o.get_name(),i=o.get_version(),a=o.get_source()),a&&V({url:a})&&(a=null),a=null,t.__lazy_load_data_structures({name:n,version:i,source:a}),n&&i&&a)return t.__extensions_by_name_and_version_and_source[n][i][a];if(n&&i)return t.__extensions_by_name_and_version[n][i];if(n&&a)return t.__extensions_by_name_and_source[n][a];if(i&&a)throw new Error("[olark] cannot search by version and source");if(n)return t.__extensions_by_name[n];if(a)return t.__extensions_by_source[a];throw new Error(i?"[olark] cannot search by version":"[olark] missing search criteria")}}(c.prototype);var h=function(){var e=this;e.__configuration_callbacks=[],S({namespace:"ExtensionManager",type:"registeredExtensionSpec",callback:function(){e.__check_for_olark_key()}})};!function(t){function n(t){var n,i,a=e._?e._.defaults:null;if(a)for(n in a)if(a.hasOwnProperty(n)){t[n]||(t[n]={});for(i in a[n])a[n].hasOwnProperty(i)&&(t[n][i]=a[n][i])}return t}var i=null;h.get_instance=function(){return i=i||new h},t.register_configure_callback=function(e){var t=this,n=e.callback;if("undefined"==typeof n)throw new Error("[olark] 'callback' required");t.__configuration_callbacks.push(n),t.__check_for_olark_key()},t.read_configuration=function(){var e=this,t=e.__read_configuration({ignore_errors:!1});return t.system.olark_key=e.get_olark_key(),t},t.get_olark_key=function(){var e=this,t=e.__read_configuration({ignore_errors:!0});t.chat.legacy_site_id&&(t.system.legacy_site_id=t.system.legacy_site_id||t.chat.legacy_site_id,m.warn("[olark] conf.chat.legacy_site_id is deprecated, please use conf.system.legacy_site_id instead"));var n=e.__parse_olark_site_id_from_dom(),i=t.system.site_id||t.system.olark_key||t.system.legacy_site_id||window.olark.__k||n;return i&&(i=i.replace(/^\s*/,"").replace(/\s*$/,""),p.test(i)&&(i=f)),i},t.__parse_olark_site_id_from_dom=function(){var e=document.getElementById("olark-key");if(e&&e.className)return j(e.className.replace("site-",""));var t=document.getElementsByTagName("a");for(var n in t)if("function"!=typeof t[n]){var i=t[n];if(i&&"olark-key"==i.className)return i.style.display="none",i.id.replace("olark-","")}return null},t.__read_configuration=function(e){var t=this;e=e||{};var i=e.ignore_errors?!0:!1,a={box:{},chat:{},data:{},browser:{},extensions:{},system:{},locale:{}};a=n(a),c.get_instance().for_each_extension_spec(function(e){a[e.get_name()]=a[e.get_name()]||{}});for(var o=0;o<t.__configuration_callbacks.length;){if("function"==typeof t.__configuration_callbacks[o]){var r=t.__configuration_callbacks[o];if(i)try{r(a)}catch(s){}else F(function(){r(a)},function(e){m.error("[olark] error with your configuration, overall configuration may be incomplete now: "+e.toString()),m.showErrorBacktrace(e)})}o++}return a},t.__check_for_olark_key=function(){var e=this;e.get_olark_key()&&I({namespace:"ConfigurationManager",type:"olarkKeyAvailable"})}}(h.prototype);var d=function(e){if(e.length<o)throw new Error("[olark] extensions cannot be named '"+e+"', names must be more than "+o+" letters long");if(!i.test(e))throw new Error("[olark] extensions cannot be named '"+e+"', names must start with a capital alphabetic letter and contain only alpha characters");if(a.test(e.toLowerCase()))throw new Error("[olark] extensions cannot be named '"+e+"', that name is protected for internal use")},b=function(e){var t=e.extension_name;if("undefined"==typeof t)throw new Error("[olark] 'extension_name' required");var n=!1;return c.get_instance().for_each_extension_spec(function(e){e.get_name()==t&&(n=!0)}),n},v=function(e){var t=!1,n=function(){var n=!0;c.get_instance().for_each_extension_spec(function(e){e.is_downloaded()||(n=!1)}),n&&!t&&(t=!0,e())};n(),S({namespace:"ExtensionManager",type:"registeredExtension",callback:n}),E({delay:1e3*r},function(){if(!t){t=!0,e();var n=[];c.get_instance().for_each_extension_spec(function(e){e.is_downloaded()||n.push(e.get_pretty_string())}),m.warn("[olark] unable to download some extensions:",n.join(","))}})},y=function(e){var t=!1;M(function(){return window.olark&&window.olark.__core&&window.olark.__core.api&&window.olark.__core.box&&window.olark.__core.chat&&window.olark.__core.data&&window.olark.__core.extensions&&window.olark.__core.framestorewithjson&&window.olark.__legacy_shim&&window.olark.__legacy_shim.legacy_stub_is_loaded&&window.olark.__legacy_shim.legacy_post_stub_is_loaded},function(){t||(t=!0,e())}),E({delay:1e3*g},function(){t||(t=!0,e(),m.warn("[olark] unable to download core libraries."))})},w=function(e){var t={};c.get_instance().for_each_extension_spec(function(n,i){var a=c.get_instance().search_for_extension({extension_spec:n}),o=null;if(0===a.length)m.error("[olark] no loaded extensions matched:"+n.get_pretty_string(),i);else if(1==a.length)o=a[0];else{o=a[0];for(var r=a.slice(1),s=[],l=r.length;l--;){var _=r[l].get_pretty_string();s.push(_)}m.warn("[olark] more than one extension matched for "+n.get_pretty_string(),", so we used the first one:",o.get_pretty_string(),"\nYou might want to be more specific. These extensions were also found:",P(s))}var h=t[n.get_name()];h?m.warn("[olark] we already loaded an extension by the name of "+n.get_name(),"(",h.get_pretty_string(),")",i):o&&(o.activate({configuration:e}),t[n.get_name()]=o)}),I({namespace:"core",type:"extensionsActivated"})},k=function(){t.publicMethods.extend=function(e){m.warn("[olark] you cannot do olark.extend() once Olark is already starting up (dropping extension:"+e+")")},t.publicMethods.configure=function(){m.warn("[olark] you cannot do olark.configure() once Olark is already starting up.")}},A=function(e){var t=h.get_instance().get_olark_key(),n=C(e);t?n():S({namespace:"ConfigurationManager",type:"olarkKeyAvailable",callback:n})},L=function(e){/Chrome/.test(navigator.userAgent)&&e.chat.onReady(function(){try{for(var e=document.styleSheets,t=e.length-1;t>=0;t--){var n=e[t].cssRules;if(n){var i=n[0],a=i.selectorText;i.selectorText="#olark-workaround",i.selectorText=a;break}}}catch(o){m.warn("[olark] Chrome stylesheet workaround not active")}})},D=function(t,n){var i="olark-targeting-plugin";e._.opm.install([i],function(a,o){if(a)m.warn("[olark] unable to install '"+i+"' due to",a);else{try{o(i).activate(e,n)}catch(r){m.warn("[olark] unable to activate plugin '"+i+"'"),m.error(r)}H(t,n)}})},H=function(t,n){L(t),n.system.force_ssl&&(window.hbl_ext="https",window.hblStaticPath=window.hblStaticPath.replace("http:","https:"),window.hblPostURL=window.hblPostURL.replace("http:","https:"));var i=n.system.deferred_chat_connection!==!0||t.chat.__SPI_hasConnectedAlready();1!=e._.preventBoot&&i&&n.system.disable_event_connection!==!0&&t.chat.connect()},q=function(){var e="#habla_beta_container_do_not_rely_on_div_classes_or_names",t="@media print {"+e+" {display: none !important}}",n=document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),n.appendChild(i)},R=function(){e._.P("bootstart"),y(function(){t.whenDocumentReady(function(){e._.P("domready"),A(function(){e._.P("keyready");var t=h.get_instance().get_olark_key(),n=h.get_instance().read_configuration();e._.P("getstorage"),window.olark.__core.data.prepare(t,n.system.force_localstorage_fallback,function(){e._.P("storage");var t=new window.olark.__core.data.StorejsKeyStore;e._.isNewConversation&&(t.clearConversationData(),window.olark.__legacy_shim.isNewConversation=!0),k(),v(function(){e._.P("extready");var t=h.get_instance().read_configuration();if(t.system.allow_end_conversation&&(e.__legacy_shim.allowEndConversation=!0),t.system.domain)try{window.olark.__core.data.forceDomain(t.system.domain),window.olark.__legacy_shim.forced_cookie_domain=t.system.domain}catch(n){m.warn("[olark] unable to use domain '"+t.system.domain+"' ("+n+")")}if(t.system.path)try{window.olark.__core.data.forcePath(t.system.path)}catch(n){m.warn("[olark] unable to use path '"+t.system.path+"' ("+n+")")}w(t);var i=new e.__core.api.ApiInstance({conf:t,namespace:"__bootprocessplugin",extension_name:"__bootprocessplugin"});i.chat.onReady(q);for(var a=t.system.rules||[],o=e._.rulesLookup={},r=!1,s=0;s<a.length;s++){var l=a[s];l.enabled&&(r=!0,o[l.id]=l)}r?D(i,t):H(i,t)})})})})})},G=function(e){c.get_instance().for_each_extension_spec(function(t){e(t.get_name())})},z=function(e){S({namespace:"core",type:"extensionsActivated",callback:e})},U=function(e){return e(window)};e.__core={listen_for_event:S,trigger_event:I,async_script_load:T,logger:m,format_bulleted_list_for_logger:P,wait_for:M,is_extension_required:b,create_idempotent_callback:C,trigger_olark_boot_process:R,when_document_is_ready:function(e){t.whenDocumentReady(e)},when_corelib_is_available:y,do_async_call:E,run_legacy_code:U,clone_object:O,deep_equals:N,join_string_list:B,for_each_extension_name_starting_with_most_recent:G,after_extensions_are_activated:z,try_and_optionally_catch:F,listen_for_browser_event:x,ConfigurationManager:h,BrowserTab:n},t.publicMethods.extend=function(t,n){F(function(){var i=null,a=null,o=null;if("function"==typeof t){i=c.get_next_extension_name();var r=t;e.declare({name:i,startup:r})}else{if("string"!=typeof t)throw new Error("[olark] extend requires either an extension name or an inline startup function");i=t,a=n?n.version:null,o=n?n.source:null,d(i)}var s=new _({name:i,version:a,source:o});c.get_instance().register_extension_spec({extension_spec:s})},function(e){m.error("[olark] failed in olark.extend: "+e.toString()),m.showErrorBacktrace(e)})},t.publicMethods.declare=function(e,t){F(function(){var n=null,i=null,a=null;if("string"==typeof e){m.warn("[olark] old-style extension declarations are no longer supported");var o=e.split("@");n=o[0],i=2==o.length?o[1]:null,a=t}else n=e.name,i=e.version,a=e.startup;d(n);var r=new l({name:n,version:i,startup:a});c.get_instance().register_declared_extension({extension:r})},function(e){m.error("[olark] failed in olark.declare: "+e.toString()),m.showErrorBacktrace(e)})},t.publicMethods.configure=function(e,t){var n,i;"string"==typeof e?(i=e.split("."),n=function(e){var n=i[0],a=e[i[0]];if(a){var o=i[1];a[o]=t,"_"==o[0]&&m.warn("[olark] cannot configure private key:",o)}else m.warn("[olark] unknown configuration namespace:",n)}):n=e,h.get_instance().register_configure_callback({callback:n})},t.publicMethods.ready=function(e){e()},t.publicMethods.identify=function(){},t.publicMethods.load=function(){}});try{window.olark.__core.trigger_olark_boot_process()}catch(k){T({url:""})}}(),window.hbl_ssl="https:"==document.location.protocol?!0:!1,hbl_ext=window.hbl_ssl?"https":"http",hblCacheConstant="application",hbl_hostname="olark.com/nrpc",hbl_static_hostname="static.olark.com",hblStaticPath=hbl_ext+"://static.olark.com/js",hblPostURL=hbl_ext+"://www.olark.com/emails/create",hblPopupURL=olark&&olark._&&olark._.popout?olark._.popout:hblStaticPath+"/html/popout.html",hblUrlHandler=olark&&olark._&&olark._.follow?olark._.follow:hblStaticPath+"/html/url_handler.html",hblPostStub=hblStaticPath+"/wc_post.js?"+hblCacheConstant,hblJSInline=!0,hblName="Olark Chat",hblInstallUrl="http://www.olark.com/dashboard/install";var _=require("underscore"),hbl={util:{},pipelines:{},themes:{},hwindow_util:{},plugins:{},hwindow:{config:function(){this.vars={},this.palette={},this.style_id={},this.style={},this.style_classes={},this.style_classes_map={}}},jsoncallback_norv:function(){}};hbl.util.eventmanager=function(){this.registered_events={},this.register=function(e,t,n){void 0==this.registered_events[e]&&(this.registered_events[e]=[]),void 0==n&&(n=999),this.registered_events[e].push({handler:t,priority:n}),this.registered_events[e]=this.registered_events[e].sort(function(e,t){return e.priority-t.priority})},this.handle=function(e,t){if(void 0!=this.registered_events[e]){void 0==t&&(t={}),t.window=this.win,t.event_name=e;var n="";for(var i in t)t.hasOwnProperty(i)&&(n+=i+"="+t[i]+"|");for(var a in this.registered_events[e])this.registered_events[e].hasOwnProperty(a)&&this.registered_events[e][a]&&"function"==typeof this.registered_events[e][a].handler&&this.registered_events[e][a].handler(t)}},this.unregister_all=function(e){this.registered_events[e]=[]},this.setWindow=function(e){this.win=e}};var hblrpcTrick=1,hblDEBUG=0,hblnoconsole=1,hblHideUnsupported=1,hblJavaScriptVersion="0.5m",hblBegincall="begin_2",hblJSInline=!0,hbl_max_event=1e3,hbl_hostname_delimiter=".";hbl.eventmgr=new hbl.util.eventmanager,habla_window=void 0,hbl.get_current_page=function(){return document.URL},hbl.get_current_referrer=function(){return document.referrer},hbl.hconfig=function(){this.vars={input_width_offset_normal:16,input_width_offset_ie:16,input_width_offset_compat:8,theme_url:"../theme.js"},this.palette={},this.style={},this.plugins=new hbl.util.pluginlist,this.style_id={},this.style_classes={},this.style_classes_map={}},hbl.hconfig.prototype.setMargin=function(e){this.setMargins(e,e,e,e)},hbl.hconfig.prototype.setMargins=function(e,t,n,i){this.vars.bottom_margin=i,this.vars.right_margin=n,this.vars.left_margin=e,this.vars.top_margin=t},hbl.hconfig.prototype.setPosition=function(e){this.vars.corner_position=e},hbl.hconfig.prototype.setDirectionRtl=function(e){this.vars.rtl=e,this.style_classes.habla_conversation_div='height: $vars["convo_height_px"]; overflow: auto; border-bottom: 1px dotted $palette["control"]; background: transparent; line-height: 1.5em; padding: 3px 23px 3px 3px; border: 1px solid',this.style_classes.habla_window_div="z-index:3000; direction: rtl",this.style_classes.habla_conversation_message_off="margin: 0; padding: 3px 23px 3px 3px;",this.style_classes.habla_conversation_p_item='color: $palette["main_fg"]; margin: 0; padding: 0; text-indent: -20px; background: transparent; text-align: right;',this.style_classes.habla_conversation_person1='color: $palette["local"]; padding-left: 5px; float: right;',this.style_classes.habla_conversation_person2='color: $palette["remote"]; padding-left: 5px; float: right;'},hbl.hconfig.prototype.setInline=function(e){e?(this.vars.is_inline=1,this.vars.disableFocus=1):(this.vars.is_inline=0,this.vars.disableFocus=0)},hbl.hconfig.prototype.setHeight=function(e){this.vars.convo_height=e},hbl.hconfig.prototype.setWidth=function(e){this.vars.width=e},hbl.util.pluginlist=function(){this.todo=[],this.defined={},this.add=function(e,t){void 0==t&&(t=999),void 0!=e&&(this.defined[e.name]||(this.defined[e.name]=1,this.todo.push({handler:e,priority:t}),this.todo=this.todo.sort(function(e,t){return e.priority-t.priority})))}},hbl.util.get_body=function(){var e=document.getElementsByTagName("html"),t=null;e.length<1?(t=document.createElement("html"),document.appendChild(t)):t=e[0],e=document.getElementsByTagName("body");var n=null;return e.length>0?n=document.getElementsByTagName("body").item(0):(n=document.createElement("body"),t.appendChild(n)),n},hbl.util.get_head=function(){var e=document.getElementsByTagName("html"),t=null;e.length<1?(t=document.createElement("html"),document.appendChild(t)):t=e[0],e=document.getElementsByTagName("head");var n=null;return e.length>0?n=document.getElementsByTagName("head").item(0):(n=document.createElement("head"),t.appendChild(n)),n},hbl.util.simple_load_js_async=function(e){var t=hbl.util.get_body(),n=document.createElement("script");n.setAttribute("language","javascript"),n.setAttribute("type","text/javascript"),n.setAttribute("data-cfasync","false"),n.setAttribute("async",""),n.setAttribute("defer","true"),n.setAttribute("src",e),t.appendChild(n)},hbl.util.BrowserDetect={_initialized:!1,init:function(){if(!this._initialized){if(this.browser=this.searchString(this.dataBrowser,1)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.use_position_absolute_on_ie=!1,this.backwards_dimension=!1,this.need_submit_button=!1,"BackCompat"==document.compatMode&&(this.backwards_dimension=!0),"Explorer"==this.browser){var e=0,t=navigator.userAgent.match(/Trident\/(\d+)/);t&&(e=t[1]),this.version>=10||e>=6?this.use_position_absolute_on_ie=!1:(this.use_position_absolute_on_ie=!0,(this.version>=7||document.body&&"undefined"!=typeof document.body.style.maxHeight)&&"BackCompat"!=document.compatMode&&(this.use_position_absolute_on_ie=!1))}navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("wii")>-1&&(this.need_submit_button=!0),this._initialized=!0}},searchString:function(e,t){for(var n=0;n<e.length;n++){var i=e[n].string,a=e[n].prop;if(this.versionSearchString=e[n].versionSearch||e[n].identity,i){if(-1!=i.indexOf(e[n].subString))return void 0!=t&&(this.supported=e[n].supported),e[n].identity}else if(a)return e[n].identity&&(this.supported=e[n].supported),e[n].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.vendor,subString:"Apple",identity:"Safari",supported:"1"},{prop:window.opera,identity:"Opera",supported:"1"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox",supported:"1"},{string:navigator.vendor,subString:"Camino",identity:"Camino",supported:"1"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape",supported:"1"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE",supported:"1"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv",supported:"1"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla",supported:"1"},{string:navigator.userAgent,subString:"iPad",identity:"iPad",supported:"1"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone",supported:"1"}]},hblHasinit=void 0,window.__olark_external_start&&window.__olark_external_start();var hbl_link=document.getElementById("hbl_code");hbl_link&&(hbl_link.style.display="none"),function(){try{var e=".olark-key,#hbl_code,#olark-data{display: none !important;}",t=document.getElementsByTagName("head")[0],n=document.createElement("style"),i=document.createTextNode(e);n.type="text/css",n.styleSheet?n.styleSheet.cssText=i.nodeValue:n.appendChild(i),t.appendChild(n)}catch(a){}}(),window.__get_olark_key=function(){var e=function(e,t){var n=e.className||"";return-1!=n.indexOf(t)},t=document.getElementById("olark-data");if(t&&t.childNodes)for(var n=t.childNodes.length;n--;){var i=t.childNodes[n];if(e(i,"olark-key"))return i.id.replace("olark-","")}for(var a=document.getElementsByTagName("a"),o=a.length;o--;){var r=a[o];if(e(r,"olark-key"))return r.id.replace("olark-","")}return null},window.olark&&window.olark.__legacy_shim&&(window.olark.__legacy_shim.legacy_stub_is_loaded=!0),hbl.hconfig.prototype.merge=function(e,t){if(this.copy_hash(this.vars,e.vars,t),this.copy_hash(this.style,e.style,t),this.copy_hash(this.palette,e.palette,t),this.copy_hash(this.style_id,e.style_id,t),this.copy_hash(this.style_classes,e.style_classes,t),this.copy_hash(this.style_classes_map,e.style_classes_map,t),e.plugins&&e.plugins.todo)for(var n in e.plugins.todo)e.plugins.todo.hasOwnProperty(n)&&this.plugins.add(e.plugins.todo.handler,e.plugins.todo.priority)},hbl.hconfig.prototype.copy_hash=function(e,t,n){if(t)for(var i in t)t.hasOwnProperty(i)&&(n||void 0==e[i])&&(e[i]=t[i])},hbl.hconfig.prototype.up=function(e){this.merge(e,!0)},hbl.hconfig.prototype.render_all_styles=function(e){for(var t in this.style_classes_map)this.style_classes_map.hasOwnProperty(t)&&"string"==typeof t&&e[t]&&this.render_element_classes(e,t)},hbl.hconfig.prototype.render_stylesheet=function(){hbl.util.css.create_css_class("div#habla_window_div p","padding:0;");for(var e in this.style_classes)if(this.style_classes.hasOwnProperty(e)){var t=this.render_part(this.style_classes[e]);hbl.util.css.create_css_class("."+e,t)}},hbl.hconfig.prototype.smart_join=function(e,t){var n="";for(var i in e)e.hasOwnProperty(i)&&"string"==typeof e[i]&&(n+=e[i]+t);return n},hbl.hconfig.prototype.render_element_classes=function(e,t){this.set_element_classes(e[t],t)},hbl.hconfig.prototype.set_element_classes=function(e,t){e&&this.style_classes_map[t]&&this.style_classes_map[t].join&&(e.className=this.smart_join(this.style_classes_map[t]," "))},hbl.hconfig.prototype.render_element=function(e,t){this.render_element_classes(e,t)},hbl.hconfig.prototype.render_class=function(e,t,n){if(e&&e.className){var i=e.className.split(" "),a=[];for(var o in i)i.hasOwnProperty(o)&&"string"==typeof o&&i[o]!=n&&i[o]!=t&&a.push(i[o]);a.push(t),e.className=this.smart_join(a," ")}},hbl.hconfig.prototype.render_ie_hacks=function(){(hbl.util.BrowserDetect.use_position_absolute_on_ie&&this.vars.disableJSStyles&&!this.vars.is_inline||this.vars.yahoo_ui)&&(window.hbl.__ie6_floating_div_monitor||(window.hbl.__ie6_floating_div_monitor=new window.__ie6_float_hack))},hbl.hconfig.prototype.remap_palette=function(){var e={mainbg:"main_bg",mainfg:"main_fg",titlebg:"title_bg",titlefg:"title_fg",buttonbg:"button_bg",buttonfg:"button_fg",buttonhi:"button_bg_highlight",titlebg_highlight:"title_bg_highlight",titlefg_highlight:"title_fg_highlight",control:"control_border",control_highlight:"control_highlight_border",local:"local_fg",remote:"remote_fg",border:"panel_border"};for(var t in e)if(e.hasOwnProperty(t)){if("string"!=typeof t)continue;this.palette[t]&&(this.palette[e[t]]=this.palette[t])}this.palette.buttonfg&&(this.palette.button_fg_highlight=this.palette.buttonfg)},hbl.hconfig.prototype.init_from_config=function(e){e.setWidth(this.vars.width),e.setHeight(this.vars.height),this.vars.is_inline?e.setInline(this.vars.is_inline):e.setPosition(this.vars.corner_position),e.setMargins(this.vars.left_margin,this.vars.top_margin,this.vars.right_margin,this.vars.bottom_margin),e.setInputHeight(this.vars.input_height),e.setFormInputHeight(this.vars.input_height),"Opera"==hbl.util.BrowserDetect.browser&&(this.vars.poll=!0)},hbl.hconfig.prototype.load_defaults=function(){this.plugins=new hbl.util.pluginlist,this.vars=[],this.palette={},this.palette.link="#e75917",this.vars.line_length=21,this.vars.bottom_margin=10,this.vars.right_margin=10,this.vars.left_margin=10,this.vars.top_margin=10,this.vars.width=260,this.vars.height=155,this.vars.panel_offset=20,this.vars.resize_input_height=60,this.vars.input_height=20,this.vars.corner_position="BR",this.vars.offline_msg_mode=!0,this.vars.rtl=!1,this.vars.resize_length=25,this.vars.myname="you",this.vars.say_text="Type here and hit enter to chat",this.vars.send_text="Send",this.vars.check_for_status=hblName+" (startup)",this.vars.disable_expand_text_input=!1,this.vars.disable_set_cookies=!1,this.vars.disable_get_cookies=!1,this.vars.cookie_path="/",this.vars.hbl_cookie_path="/",this.vars.session_expire=void 0,this.vars.local_user_display_name="&rarr;",this.vars.disableGoogleAnalytics=0,this.vars.expandOnMessageReceived=0,this.vars.enable_google_analytics=!1,this.vars.google_analytics_domain="auto",this.vars.language="en",this.vars.enableLanguageTranslation=!1,this.vars.expandOnFirstMessageReceived=1,this.vars.close_hides_window=!1,this.vars.plugin_path=hblStaticPath+"/plugins/",this.vars.divid="habla_window_div",this.vars.poll=!1,"Opera"==hbl.util.BrowserDetect.browser&&(this.vars.poll=!0),this.vars.habla_name_input_text="click here and type your Name",this.vars.habla_offline_email_text="click here and type your Email",this.vars.habla_offline_phone_text="click here and type your Phone",this.vars.habla_offline_body_text="We're not around but we still want to hear from you!  Leave us a note:",this.vars.habla_offline_submit_value="Send",this.vars.habla_offline_sent_text="Thanks for your message!  We'll get back to you shortly.",this.vars.in_chat_text="Now Chatting",this.vars.before_chat_text="Chat with us!",this.vars.not_available_text="Contact us!",this.vars.busy_text="Contact us",this.vars.away_text="Contact us",this.vars.offline_message="We're not around, but we'd love to chat another time.",this.vars.welcome_msg="Questions? We'd love to chat!",this.vars.busy_message="All of our representatives are with other customers at this time. We will be with you shortly.",this.vars.enable_buttons=1,this.vars.hide_min_max_buttons=0,this.vars.local_name_override=void 0,this.vars.url_handler_target_window="_top",this.vars.url_handler=hblUrlHandler,this.vars.url_local_pattern=document.domain,this.vars.parse_links=1,this.vars.is_inline=0,this.vars.start_expanded=0,this.vars.start_hidden=0,this.vars.hide_not_available=0,this.vars.append_to_body=1,this.vars.show_away=0,this.vars.hide_when_away=0,this.vars.show_away_as_header=0,this.vars.habla_sizebutton_text_expanded="_",this.vars.habla_sizebutton_text_compressed="^",this.vars.habla_closebutton_text="x",this.vars.habla_popout_text=">",this.vars.habla_end_popout_text="<<",this.vars.start_visible=!1,this.vars.start_habla_window_visible=!1,this.vars.pre_chat_message="Hi, I am around, click 'start chatting' to contact me.",this.vars.pre_chat_submit="Click here to start chatting",this.vars.pre_chat_error_text="Please enter your name and email in case we get disconnected.",this.vars.show_pre_chat=0,this.vars.require_name=2,this.vars.require_email=1,this.vars.require_phone=0,this.vars.require_offline_phone=0,this.vars.show_end_popout=0,this.vars.show_popout=0,this.vars.is_popup=0,this.vars.sending_text="sending",this.vars.email_body_error_text="You must complete all fields and specify a valid email address",this.vars.habla_special_div_show_type="block",this.vars.operator_has_stopped_typing_text="has stopped typing",this.vars.operator_is_typing_text="is typing...",this.vars.flash_icons=1,this.vars.flash_titlebar=1,this.vars.default_flash_off_icon=hblStaticPath+"/images/white.ico",this.vars.default_flash_on_icon=hblStaticPath+"/images/orange.ico",this.vars.ended_chat_message="This chat has ended, start typing below if you need anything else!",this.style_classes_map={},this.style_id={},this.style_classes={}},window.hbl||(window.hbl={}),window.hbl.__ie6_floating_div_monitor=void 0,window.__ie6_float_hack=function(){var e=this;e.__moving=!1,e.__need_to_move=function(){var t=e.__with_complete_habla_window(function(e){var t=e.config.vars,n=__get_element_position({dom_element:e.theme.habla_window_div,top:t.top_margin,bottom:t.bottom_margin,left:t.left_margin,right:t.right_margin,corner:t.corner_position});if(e.theme){var i={x:e.theme.getX(),y:e.theme.getY()},a=n.x-i.x,o=n.y-i.y,r=Math.max(Math.abs(a),Math.abs(o));return{x:a,y:o,max_diff:r}}return{x:0,y:0,max_diff:0}});return t?t:{x:0,y:0,max_diff:0}},e.__with_complete_habla_window=function(e){var t=window.habla_window;
return t&&t.config&&t.config.vars&&t.config.vars.corner_position?e(t):void 0},e.__move_window=function(t,n){e.__with_complete_habla_window(function(e){var i=e.config.vars,a=__get_element_position({dom_element:e.theme.habla_window_div,top:i.top_margin,bottom:i.bottom_margin,left:i.left_margin,right:i.right_margin,corner:i.corner_position});e.theme.setXY(a.x-t,a.y-n)})},e.__check_location=function(){e.__move_to_correct_location(),setTimeout(function(){e.__check_location()},500)},e.__move_to_correct_location=function(t){var n=e.__need_to_move();!t&&n.max_diff<2||(t||n.max_diff<15?e.__move_window(0,0):(e.__move_window(0,.5*n.y),setTimeout(function(){e.__move_to_correct_location()},40)))},e.stop=function(){e.__timeout&&clearTimeout(e.__timeout),e.__timeout=void 0},e.start=function(){e.stop(),e.__timeout=setTimeout(function(){e.__check_location()},500)},e.__move_to_correct_location(!0),e.start()};var __get_element_position=function(e){var t=0,n=0,i=e.dom_element.offsetWidth,a=e.dom_element.offsetHeight,o=window.innerWidth||(document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth),r=window.innerHeight||(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight),s=document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,l=document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop;return t=e.corner.match("R")?o+s-e.right-i:e.left+s,n=e.corner.match("B")?r+l-e.bottom-a:e.top+l,{x:t,y:n}};hbl.util.pluginlist.prototype.load=function(e){for(var t=e,n=0;n<this.todo.length;n++)this.todo[n]&&this.todo[n].handler&&"function"==typeof this.todo[n].handler.load&&1==this.defined[this.todo[n].handler.name]&&(this.todo[n].handler.load(e),this.defined[this.todo[n].handler.name]=2);return t},hbl.util.last_js_id=0,hbl.util.last_js_pollid=0,hbl.util.pipeline=function(e){this.todo=[],this.host_obj=e,this.add=function(e,t){void 0==t&&(t=999),this.todo.push({handler:e,priority:t}),this.todo=this.todo.sort(function(e,t){return e.priority-t.priority})},this.run=function(e){for(var t=e,n=0;n<this.todo.length;n++)if(this.todo[n]&&"function"==typeof this.todo[n].handler){if(t=this.todo[n].handler(e,this.host_obj),void 0==t)return void 0;e=t}return t},this.setTarget=function(e){this.host_obj=e}},hbl.util.listenForEvent=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):(e["on"+t]=n,n)},hbl.util.pluginloader=function(e,t,n){hbl.pluginArgs={conf:e,client:t,hwindow:n},e.plugins.load({conf:e,client:t,hwindow:n})},hbl.util.timestamp=function(){var e=new Date;return e.toUTCString()},hbl.util.reportException=function(e){olark._.hlog("exception:",e,"#error")},hbl.util.urlencode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t+=n+"="+encodeURIComponent(e[n])+"&");return t},hbl.util.load_js_async=function(e){hbl.util.last_js_id+=1,hbl.util.last_js_pollid+=1;var t="jscript"+hbl.util.last_js_id;if(e+=e.indexOf("?")>-1?"&"+t:"?"+t,hbl.util.last_js_id>1900){if(!e.match(/sendmessage/i)&&!e.match(/begin/i))return;hbl.util.last_js_id=1}var n=hbl.util.get_body(),i=document.createElement("script");i.setAttribute("language","javascript"),i.setAttribute("id",t),i.setAttribute("type","text/javascript"),i.setAttribute("data-cfasync","false"),i.setAttribute("async",""),i.setAttribute("defer","true"),i.setAttribute("src",e),n.appendChild(i)},hbl.util.remove_element=function(e){var t=document.getElementById(e);void 0!=t&&void 0!=t.parentNode&&t.parentNode.removeChild(t)},hbl.util.calculate_retry_delay=function(e,t,n){var i=e*(1+t);return i>n?n:i},hbl.util.append_script=function(e,t,n){var i=hbl.util.append_script,a=n.scriptid,o=n.url,r=n.tries,s=n.previous_tries||0,l=n.timeout,_=n.error_callback,c=n.success_callback,h=n.cache,d=n.retryid?n.retryid:"",u=100,p=1200,f=15e3;e.opera&&!l&&(l=200);var g=function(n){var u=t.getElementById(a+d);u?(u.loaded=!0,void 0!=u.parentNode&&u.parentNode.removeChild(u),_&&_({status:n}),r>0?e.setTimeout(function(){i(e,t,{scriptid:a,retryid:"r"+r,url:o,tries:r,previous_tries:s+1,timeout:l,error_callback:_,cache:h})},hbl.util.calculate_retry_delay(p,s,f)):window.olark&&window.olark._.hlog&&olark._.hlog("#rpc_call_error-"+n+" url:"+o)):c&&c()},b=o;if(!h){var m=b.length>0&&"&"!=b.charAt(b.length-1)&&"?"!=b.charAt(b.length-1);b.match(/\?/)?m&&(b+="&"):b+="?",b+="_rnd="+Math.random()}b=b.replace("?","?j="+a+d+"&");var v=t.createElement("script");v.setAttribute("language","javascript"),v.setAttribute("id",a+d),v.setAttribute("type","text/javascript"),v.setAttribute("data-cfasync","false"),v.setAttribute("async",""),v.setAttribute("defer","true"),v.setAttribute("src",b),v.loaded=!1,r&&(r-=1),l&&(v.timeout=e.setTimeout(function(){g("timeout")},l)),v.readyState?v.onreadystatechange=function(){"loaded"!=v.readyState&&"complete"!=v.readyState||v.loaded||(v.onreadystatechange=function(){},v.loaded=!0,v.timeout&&e.clearTimeout(v.timeout),e.setTimeout(function(){g("error")},u))}:(v.onload=function(){v.loaded||(v.loaded=!0,v.timeout&&e.clearTimeout(v.timeout),e.setTimeout(function(){g("error")},u))},v.onerror=function(){v.loaded||(v.loaded=!0,v.timeout&&e.clearTimeout(v.timeout),e.setTimeout(function(){g("error")},u))});var y=t.getElementsByTagName("script")[0];y.parentNode.insertBefore(v,y),olark._.internalLog&&olark._.internalLog.logHttpRequest(b)},hbl.util.as_dom=function(e){var t;return"object"==typeof e?e:(t=document.createElement("span"),t.innerHTML=e,t)},hbl.util.set_inner_text=function(e,t){null!==e.textContent&&void 0!==e.textContent?e.textContent=t:e.innerText=t},hbl.util.encode_html_entities=function(e,t){t||(t=[]);var n={ampersand:{regex:/&/gi,replaceValue:"&amp;"},lessThan:{regex:/\</gi,replaceValue:"&lt;"},greaterThan:{regex:/\>/gi,replaceValue:"&gt;"},doubleQuote:{regex:/\"/gi,replaceValue:"&quot;"},singleQuote:{regex:/\'/gi,replaceValue:"&#x27;"},slash:{regex:/\//gi,replaceValue:"&#x2F;"}};for(var i in n)n.hasOwnProperty(i)&&_.indexOf(t,i)<=-1&&(e=e.replace(n[i].regex,n[i].replaceValue));return e},hbl.util.decode_html_entities=function(e){try{var t=hbl.util.encode_html_entities(e,["ampersand"]),n=document.createElement("div");n.innerHTML=t;var i=0===n.childNodes.length?"":n.childNodes[0].nodeValue;return i&&!/^\s*$/.test(i)?i:e}catch(n){return e}},hbl.util.find_or_create_el=function(e,t,n){var i=document.getElementById(e);return(!i||i.length<0)&&(void 0==t&&(t="div"),i=document.createElement(t),i.setAttribute("id",e),void 0!=n&&n.appendChild(i)),("input"==t||"textarea"==t)&&(i.name=e),i},hbl.util.find_or_create_div=function(e,t){return hbl.util.find_or_create_el(e,"div",t)},hbl.util.hide_div=function(e){return"object"!=typeof e&&(e=document.getElementById(e)),void 0!=e?(e.style.display="none",!0):!1},hbl.util.show_div=function(e,t){return void 0==t&&(t="block"),"object"!=typeof e&&(e=document.getElementById(e)),void 0!=e?(e.style.display=t,!0):!1},hbl.util.clean_whitespace=function(e){return e=e.replace(/^\s*/,""),e=e.replace(/\s*$/,""),e=e.replace("'","")},hbl.util.decode_base64=function(e){var t="";try{t=window.atob(e)}catch(n){var i,a,o,r,s,l,_,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=c.indexOf(e.charAt(h++)),s=c.indexOf(e.charAt(h++)),l=c.indexOf(e.charAt(h++)),_=c.indexOf(e.charAt(h++)),i=r<<2|s>>4,a=(15&s)<<4|l>>2,o=(3&l)<<6|_,t+=String.fromCharCode(i),64!=l&&(t+=String.fromCharCode(a)),64!=_&&(t+=String.fromCharCode(o));while(h<e.length)}return t},hbl.util.encode_base64=function(e){var t,n,i,a,o,r,s,l,_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=0,h=0,d="",u=[];if(!e)return e;e=hbl.util.utf8_encode(e+"");do t=e.charCodeAt(c++),n=e.charCodeAt(c++),i=e.charCodeAt(c++),l=t<<16|n<<8|i,a=l>>18&63,o=l>>12&63,r=l>>6&63,s=63&l,u[h++]=_.charAt(a)+_.charAt(o)+_.charAt(r)+_.charAt(s);while(c<e.length);switch(d=u.join(""),e.length%3){case 1:d=d.slice(0,-2)+"==";break;case 2:d=d.slice(0,-1)+"="}return d},hbl.util.strip_whitespace=function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},hbl.util.is_valid_email=function(e){if(!e)return!1;var t=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;return t.test(e)},hbl.util.is_valid_phone=function(e){if(!e)return!1;var t=e.replace(/[^\+\d]/g,""),n=/[\+01]{0,4}(9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)\d{0,14}(x\d{1,5})?$/;return n.test(t)},hbl.util.utf8_encode=function(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t,n,i="",a=0;t=n=0,a=e.length;for(var o=0;a>o;o++){var r=e.charCodeAt(o),s=null;128>r?n++:s=r>127&&2048>r?String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128),null!==s&&(n>t&&(i+=e.substring(t,n)),i+=s,t=n=o+1)}return n>t&&(i+=e.substring(t,e.length)),i},hbl.util.css={},hbl.util.getElementsByClass=function(e,t){e||(e=document.getElementsByTagName("body")[0]);for(var n=[],i=new RegExp("\\b"+t+"\\b"),a=e.getElementsByTagName("*"),o=0,r=a.length;r>o;o++)i.test(a[o].className)&&n.push(a[o]);return n};var PollingManager=function(e,t,n,i,a){var o=this,r=1,s=!0,l=!1,_=!1,c=!1,h=void 0,d=void 0,u=void 0,p=void 0,f=void 0,g=!1,b=3e4,m=900,v=0,y=300,w=15,k=60,x=0,S=18e5,I=+new Date;n("api.chat.onOperatorsAvailable",function(){c=!0,f=+new Date}),n("api.chat.onOperatorsAway",function(){c=!1}),g=!0,/irefox/.test(a.userAgent)&&e.addEventListener&&e.addEventListener("unload",function(){l&&_&&i.client.sendcommand("return_long_poll_now","")},!1),o.getMinAvailablePollTime=function(){return x},o.setMinAvailablePollTime=function(e){x=e},o.setAllowedDelayWhenSlow=function(e){w=e},o.reset=function(){I=+new Date},o.__timeOnPage=function(){return(+new Date-I)/1e3},o.__secondsSinceOnline=function(){return f?(+new Date-f)/1e3:void 0},o.__setLastPollStartedTimestamp=function(e){u=e},o.setLongPoll=function(e){s=e},o.startFailSafeIntervalIfNeeded=function(){h||(h=e.setInterval(function(){o.getNextPollTime(function(e){var t=!1,n=u?(+new Date-u)/1e3:void 0,i=e-+new Date;if(void 0==e)void 0==u?t=!0:n>y&&(t=!0);else if(u){var a=u+i;+new Date-a<w&&(t=!0)}t&&(o.finishLastPoll(),o.startNextPollNow())})},b))},o.startNextPollNow=function(){_||C()},o.finishLastPoll=function(){return _&&(_=!1),p=void 0,l};var C=function(t){l=!0,d&&e.clearTimeout(d),d=void 0,o.startFailSafeIntervalIfNeeded(),void 0==t&&(t=s?v:m),d=e.setTimeout(function(){o.poll()},t),p=+new Date+t,r=t};o.__determinePollTime=function(e,t,n){var i=n&&k>n;if(e){var a=0;return a=120>t?4e3:300>t?1e4:1800>t?3e4:7200>t?45e3:t/20*1e3,x>a?x:a}if(i)return 15e3;if(300>t)return 45e3;if(3600>t)return 15e5;var o=t/2*1.3*1e3;return 15e5>o?15e5:o},o.getNextPollTime=function(e){var t,i=function(n){t=n,e&&e(n)};return n("api.visitor.getDetails",function(e){var t=e.secondsSinceLastMessage,n=e.secondsSinceLastNotificationToOperator,a=t;void 0!=n&&(void 0==t||t>n)&&(a=n);var r=o.__timeOnPage(),s=o.__secondsSinceOnline(),l=void 0!=a;return i(l?180>a?void 0:300>a?1e4:1800>a?2e4:o.__determinePollTime(c,r,s):o.__determinePollTime(c,r,s))}),t},o.scheduleNextPoll=function(){_||o.getNextPollTime(function(e){var t=void 0==e;(!p||t||p>+new Date+e)&&(g?e>S?o.stop():C(e):(e>S&&(e=S),C(e)))})},o.stop=function(){l?(l=!1,d&&e.clearTimeout(d),h&&e.clearInterval(h),d=void 0,h=void 0,i.client.sendcommand("return_long_poll_now","")):l=!1},o.isRunning=function(){return l},o.poll=function(){_=!0,u=+new Date,r==v&&s?i.client.proxy2.getmessages(olark._.identityManager.getConversationId(),i.client.last_poll_index,i.client.callbacks.getmessages):i.client.proxy3.pollmessages(olark._.identityManager.getConversationId(),i.client.last_poll_index,i.client.callbacks.pollmessages)}};hbl._pollevents_errors=0,hbl.client={SENDMESSAGE_DELAY:100,incoming_pipeline:new hbl.util.pipeline,first_time:!0,recorded_ssl_ip:!1,op_nickname_map:{},pollingmanager:new PollingManager(window,document,olark,hbl,navigator),is_conversation:function(){for(var e=!1,t=!1,n=0;n<hbl.client.buffer.length;++n)hbl.client.buffer[n]&&("you"==hbl.client.buffer[n][0]&&(e=!0),"you"!=hbl.client.buffer[n][0]&&(t=!0));return e&&t},current_operator:function(){for(var e="",t=0;t<hbl.client.buffer.length;++t)hbl.client.buffer[t]&&"you"!=hbl.client.buffer[t][0]&&(e=hbl.client.buffer[t][0]);return e},noop:function(){},geolocation_ready:function(e){hbl.client.eventmgr.handle("geolocation_ready",e)},callbacks:{begin:function(e){hbl.client.jsoncallback(e,hbl.client.begin_call_back)},sendmessage:function(e){hbl.client.msg_callback(e)},sendpresence:function(){},sendcommand:function(){},pollevents:function(e){hbl._pollevents_errors=0,hbl.client.pollingmanager.finishLastPoll()&&hbl.client.jsoncallback(e,hbl.client.callbacks.pollmessages1)},pollmessages1:function(e){var t=e;if(setTimeout(function(){hbl.client.eventmgr.handle("handled_nrpc_response")}),t.is_new_conversation&&hbl.client.eventmgr.handle("session_was_not_in_memcache",{}),t.ipaddress_lookup_needed&&hbl.client.record_ssl_ip(),hbl.client.site_is_online=t.site_is_online,hbl.client.conversation_has_slot=t.conversation_has_slot,e={sid:t.conversation_id,hblid:t.visitor_id,chatting:t.in_active_conversation,opstatus:t.status_state,opavailable:t.site_is_online,geoip:t.geolocation_data,ipaddress:t.ipaddress,pop_out:t.is_popup,ssl:t.ssl,box_visible:!0,opbusy:!1,operator_composing_state:e.operator_composing_state,operator_nickname:e.operator_nickname},t.operator_has_sent_message&&t.site_is_online&&(e.opstatus="available"),!t.operator_has_sent_message&&t.site_is_online&&"available"!=e.opstatus&&(e.opavailable=!1),hbl.client.chatting=e.chatting,e.disconnected);else{if(hbl.client.first_time&&(hbl.client.first_time=!1),"no session found"==e.exception)return;(e.opavailable!=hbl.client.opavailable||hbl.client.opmessage!=e.opmessage||hbl.client.opstatus!=e.opstatus||hbl.client.opbusy!=e.opbusy||hbl.client.pop_out!=e.pop_out)&&(hbl.client.eventmgr.handle("operator_status_change",{available:e.opavailable,opavailable:e.opavailable,status:e.opstatus,opstatus:e.opstatus,message:e.opmessage,busy:e.opbusy,pop_out:e.pop_out,pop_out_change:hbl.client.pop_out!=e.pop_out,chatting:hbl.client.chatting,box_visible:hbl.client.box_visible,opbusy:e.opbusy}),hbl.client.first_time=!1,hbl.client.opavailable=e.opavailable,hbl.client.opmessage=e.opmessage,hbl.client.opstatus=e.opstatus,hbl.client.opbusy=e.opbusy,hbl.client.pop_out=e.pop_out),hbl.client.composing!=e.operator_composing_state&&(hbl.client.eventmgr.handle("operator_composing",{composing_type:e.operator_composing_state,operator_nickname:e.operator_nickname}),hbl.client.composing=e.operator_composing_state);for(var n,i=[],a=!1,o=t.new_events||[],r=0;r<o.length;r++){var s=o[r][0];s>hbl.client.last_poll_index&&(hbl.client.last_poll_index=s);var l=o[r][1];l.body&&"you"!=l.nickname&&(i.push([l.nickname,l.body,s]),hbl.client.op_nickname_map[l.nickname]=l.operator_id),"site_config_changed"==l.type&&(a=!0,n=l.md5)}hbl.client.append1(i),a&&(olark._.setSiteAssetHash(n),olark._.setLoaderUseAssets("1")),hbl.client.whenNicknameAndPresenceAreAllowed(function(){t.resend_nickname&&hbl.client.eventmgr.handle("resend_nickname",{}),t.resend_status&&hbl.client.eventmgr.handle("resend_status",{})}),hbl.client.pollingmanager.scheduleNextPoll()}}},siteid:"",wc_sid:"",sid:"",proxy:null,buffer:[],myname:"you",jsoncallback:function(e,t){return e.http_traffic_blocked?(olark("api.box.hide"),hbl.util.append_script=function(){},window.console&&window.console.warn&&window.console.warn("[olark] Olark Chat is turned off for this website, if you own this website please contact Olark via support@olark.com"),!1):(e.ended&&hbl.client.eventmgr.handle("conversation_ended",{next_conversation_id:e.ended.next_conversation_id}),void(e.conversation_does_not_exist?hbl.client.restart_session():e.retry?hbl.client.pollingmanager.startNextPollNow():null==t||e.duplicate_session_id||t(e)))},begin_call_back:function(e){function t(){olark._.identityManager.deleteIdentityFromCookies()}var n=olark._.hlog,i=e;if(e.error){var a=[];return"fatal_boot_exception"==e.error&&(t(),a.push("#fatal_boot_exception")),i.invalid_id_format&&(t(),a.push("#invalid_id_format")),i.conversation_does_not_exist&&(t(),a.push("#conversation_does_not_exist")),void n("stopped begin call:",e.error,"#error #begin_call_error",a.join(" "))}if(i.invalid_id_format||i.conversation_does_not_exist)return t(),void n("RPC reported no errors, but gave error flags #error #unexpected_rpc_output");i.conversation_id!=olark._.identityManager.getConversationId()&&n("RPC reported new conversationId:",i.conversation_id,"!=",olark._.identityManager.getConversationId(),"#error #new_rpc_wcsid"),i.visitor_id!=olark._.identityManager.getVisitorId()&&(n("RPC reported new visitorId, re-storing to cookie:",i.visitor_id,"!=",olark._.identityManager.getVisitorId(),"#error #new_rpc_hblid"),i.visitor_id&&olark._.identityManager.setVisitorId(i.visitor_id));var o=function(){olark("api.box.__SPI_getLegacyState",function(t){olark._.needsFirstTimeOperatorLogin=!1;var n=e;if(e.site_config_changed&&(olark._.setSiteAssetHash(e.site_md5||e.assets_config_md5),olark._.setLoaderUseAssets("1")),e={sid:n.conversation_id,hblid:n.visitor_id,chatting:n.in_active_conversation,opstatus:n.status_state,opavailable:n.site_is_online,geoip:n.geolocation_data,ipaddress:n.ipaddress,pop_out:n.is_popup,ssl:n.ssl,opbusy:!1,operator_composing_state:e.operator_composing_state,operator_nickname:e.operator_nickname,habla_message:e.habla_message,box_visible:t.box_visible,box_open:t.box_open},n.operator_has_sent_message&&n.site_is_online&&(e.opstatus="available"),!n.operator_has_sent_message&&n.site_is_online&&"available"!=e.opstatus&&(e.opavailable=!1),null==e||e.error)e&&e.error&&hbl.client.eventmgr.handle("habla_error",{etype:e.error});else{olark._.identityManager.setConversationId(e.sid),olark._.identityManager.setVisitorId(e.hblid),hbl.client.chatting=e.chatting,hbl.client.site_is_online=n.site_is_online,hbl.client.conversation_has_slot=n.conversation_has_slot,hbl.client.opavailable=e.opavailable,hbl.client.opmessage=e.opmessage,hbl.client.opstatus=e.opstatus,hbl.client.opbusy=e.opbusy,hbl.client.pop_out=e.pop_out,hbl.client.ssl=e.ssl,hbl.client.box_visible=e.box_visible;var i=function(e){return{available:e.opavailable,opavailable:e.opavailable,opstatus:e.opstatus,status:e.opstatus,message:e.opmessage,busy:e.opbusy,pop_out:e.pop_out,pop_out_change:hbl.client.pop_out!=e.pop_out,chatting:hbl.client.chatting,box_visible:hbl.client.box_visible,opbusy:e.opbusy}};if(olark._.geoip=e.geoip,olark._.ipaddress=e.ipaddress,hbl.client.eventmgr.handle("nrpc_data_ready",i(e)),hbl.client.eventmgr.handle("chat_started",{chatting:e.chatting,box_open:e.box_open,box_visible:e.box_visible,opstatus:e.opstatus,opavailable:e.opavailable,opmessage:e.opmessage,opbusy:e.opbusy,pop_out:e.pop_out,config:e.config,dconfig:e.dconfig,habla_message:e.habla_message,browser_ip:e.ipaddress,geolocation:e.geocode_ip}),hbl.client.last_poll_index=0,n.conversation_history){for(var a=[],o=0;o<n.conversation_history.length;o++){var r=n.conversation_history[o][0];r>hbl.client.last_poll_index&&(hbl.client.last_poll_index=r);var s=n.conversation_history[o][1];s.body&&("visitor_message"==s.type&&(r=0),a.push([s.nickname,s.body,r]),hbl.client.op_nickname_map[s.nickname]=s.operator_id)}hbl.client.setContents(a)}hbl.client.eventmgr.handle("operator_status_change",i(e)),hbl.client.opavailable=e.opavailable,hbl.client.opmessage=e.opmessage,hbl.client.opstatus=e.opstatus,hbl.client.opbusy=e.opbusy,hbl.client.pop_out=e.pop_out,hbl.client.eventmgr.handle("operator_composing",{composing_type:e.operator_composing_state,operator_nickname:e.operator_nickname}),hbl.client.composing=e.composing_type,hbl.client.whenNicknameAndPresenceAreAllowed(function(){n.resend_nickname&&hbl.client.eventmgr.handle("resend_nickname",{}),n.resend_status&&hbl.client.eventmgr.handle("resend_status",{})}),n.is_new_conversation&&hbl.client.eventmgr.handle("session_was_not_in_memcache",{}),hbl.client.pollingmanager.scheduleNextPoll()}})};"fatal exception"!=e.error?e.ipaddress_lookup_needed?(olark._.identityManager.setConversationId(e.conversation_id),hbl.client.record_ssl_ip(),hbl.client.eventmgr.register("geolocation_ready",function(t){e.geolocation_data=t.geolocation,e.ipaddress=t.geolocation.ipaddress,o()})):o():olark._.hlog("#boot #spoof detected")},start:function(e,t,n,i,a){olark._.identityManager.setSiteId(n),olark._.identityManager.setConversationId(e),olark._.identityManager.setVisitorId(t),hbl.client.eventmgr=i,hbl.client.config=a,hbl.client.opstatus=null,hbl.client.opavailable=null,hbl.client.opmessage=null,hbl.client.chatting=!1,hbl.client.pop_out=!1,hbl.client.buffer=[],hbl.client.the_count=0,hbl.client.newlinecount=0,hbl.client.lastindex=0,hbl.client.last_getmessages=new Date,hbl.client.jsondata=null,hbl.client.datareadycallback=null,hbl.client.getmsgcallback=null,hbl.client.first_time=!0,hbl.client.incoming_pipeline.setTarget(this);try{var o=new hbl.client.jsonproxy(olark._.nrpcBaseUrl);hbl.client.proxy=hbl.client.proxy3=hbl.client.proxy2=o,hbl.config&&hbl.config.vars&&!hbl.config.vars.local_mode&&(olark._.P("begin"),hbl.client.proxy.begin(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId(),olark._.identityManager.getSiteId(),hbl.get_current_page(),hbl.get_current_referrer(),a.vars.start_passive,a.vars.force_nickname,a.vars.no_system_messages,hbl.client.begin_call_back))}catch(r){throw hbl.client.chatting=!1,hbl.util.reportException(r),r}},jsoncallback_norv:function(){},jsonproxy:function(e,t){this.uri=e,this.callq=[],this.rnd=t},check_getmsg:function(){},setContents:function(e){if(!e||0==e.length){if(!(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.has_messages_in_history))return;e=[[null,"  ",.2]]}hbl.client.lastindex=0;for(var t=0;t<e.length;++t)hbl.client.buffer[hbl.client.buffer.length]=new Array(e[t][0],e[t][1],e[t][2]),e[t][2]>hbl.client.lastindex&&(hbl.client.lastindex=e[t][2]);hbl.client.newlinecount=1,window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.load_missed_messages&&window.olark.__legacy_shim.load_missed_messages(e),hbl.client.eventmgr.handle("receive_message",{type:"start",msg:e})},append:function(e){if(e&&e.length>0){for(var t=0;t<e.length;++t)hbl.client.buffer[hbl.client.buffer.length]=new Array(e[t][0],e[t][1],e[t][2]);hbl.client.newlinecount+=e.length,hbl.client.chatting=!0,hbl.client.eventmgr.handle("send_message",{type:"local_update",msg:e})}},append1:function(e){if(e&&e.length>0){for(var t=[],n=0,i=0;i<e.length;++i)if(e[i][2]>hbl.client.lastindex){hbl.client.lastindex=e[i][2];var a=hbl.client.incoming_pipeline.run(e[i]);void 0!=a&&(hbl.client.buffer[hbl.client.buffer.length]=a,t.push(a)),e[i]&&(n+=1)}hbl.client.newlinecount+=e.length,n>0&&(hbl.client.chatting=!0),t.length>0&&hbl.client.eventmgr.handle("receive_message",{type:"remote_update",msg:t})}},msg_callback:function(e){"operator_is_busy"==e.error&&hbl.eventmgr.handle("habla_error",{etype:"operator_is_busy"})},sendmessage:function(e,t,n,i,a,o){hbl.client.lastNickname=a,hbl.client.lastStatusMessage=o;var r=!t,s=new Array(new Array(hbl.client.myname,e,r,n));if(r&&hbl.client.append(s),i){var l="chat";hbl.client.proxy.setnickname(olark._.identityManager.getConversationId(),a),hbl.client.proxy.sendpresence(olark._.identityManager.getConversationId(),o,l)}setTimeout(function(){hbl.client.proxy.sendmessage(olark._.identityManager.getConversationId(),e,r,n,hbl.client.msg_callback)},hbl.client.SENDMESSAGE_DELAY),hbl.client.pollingmanager.startNextPollNow()},sendofflinemessage:function(e,t){var n="chat";hbl.client.proxy.setnickname(olark._.identityManager.getConversationId(),hbl.client.lastNickname),hbl.client.proxy.sendpresence(olark._.identityManager.getConversationId(),hbl.client.lastStatusMessage,n),setTimeout(function(){hbl.client.proxy.sendofflinemessage(olark._.identityManager.getConversationId(),e,t)},hbl.client.SENDMESSAGE_DELAY)},setnickname:function(e){hbl.client.lastNickname=e,hbl.client.whenNicknameAndPresenceAreAllowed(function(){hbl.client.proxy.setnickname(olark._.identityManager.getConversationId(),e)})},sendcommand:function(e,t){hbl.client.proxy.sendcommand(olark._.identityManager.getConversationId(),e,t)},record_ssl_ip:function(){hbl.client.recorded_ssl_ip||(hbl.client.proxy.geolocation(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId()),hbl.client.recorded_ssl_ip=!0)},restart_session:function(){hbl.client.proxy.noop(olark._.identityManager.getConversationId(),olark._.identityManager.getVisitorId())},setvcard:function(){},sendpresence:function(e,t){hbl.client.lastStatusMessage=e,hbl.client.whenNicknameAndPresenceAreAllowed(function(){hbl.client.proxy.sendpresence(olark._.identityManager.getConversationId(),e,t)})},log_event:function(e,t){hbl.client.proxy&&hbl.client.proxy.log_event(olark._.identityManager.getConversationId(),e,t)},sendexpand:function(){},sendcompress:function(){},sendend:function(){},sendhide:function(){},sendshow:function(){},popout:function(){hbl.client.proxy&&hbl.client.proxy.popout(olark._.identityManager.getConversationId())},end_popout:function(){hbl.client.proxy&&hbl.client.proxy.end_popout(olark._.identityManager.getConversationId())},whenNicknameAndPresenceAreAllowed:function(e){olark("api.visitor.getDetails",function(t){var n=void 0!=t.secondsSinceLastMessage||void 0!=t.secondsSinceLastNotificationToOperator;if(n)e();else if("chatting"==hbl.config.vars.show_in_buddy_list);else{var i=hbl.client.conversation_has_slot,a=hbl.client.site_is_online;i&&a&&e()}})}},hbl.client.map={command:"c",callback:"cb",group_id:"g",group_idstring:"g",conversation_id:"i",script_id:"j",site_idstring:"s",sequence_id:"q",status_message:"m",status_state:"p",current_url:"u",visitor_id:"v",referrer_url:"r"},hbl.client.jsonproxy.prototype.__build_nrpc_arguments=function(e){var t="";e.command&&(t+="&c="+encodeURIComponent(e.command+"")),e.sequence_id&&(t+="&q="+e.sequence_id);var n=hbl.client.map,i=[];for(var a in e)if(i.push(a),e.hasOwnProperty(a)&&e[a]&&"append_settings"!=a&&"throttle"!=a&&"sequence_id"!=a&&"command"!=a){var o=encodeURIComponent(e[a]+"");n[a]&&(a=n[a]),t+="&"+a+"="+o}return""==t&&(t="?command=invalid_buffer&buffer_is_empty="+escape(i.join(","))),t},hbl.client.jsonproxy.prototype.do_nrpc_call=function(e){var t=this,n=hbl.client.pollingmanager.getNextPollTime();n&&(e.next_poll_time=n);var i=hbl._pollevents_errors;i&&(e.num_retries=hbl._pollevents_errors),t.do_raw_nrpc_call(e)},hbl.client.jsonproxy.prototype.do_raw_nrpc_call=function(e){var t=e.command,n=e.append_settings,i="",a=hbl_ext;if(olark.__legacy_shim.allowEndConversation&&(e.end_conversation=1,olark._.identityManager.isNewConversation()&&"create"===t&&(e.is_new_conversation=1)),e.visitor_id=e.visitor_id||olark._.identityManager.getVisitorId(),("create"==t||"sendmessage"==t)&&(hbl.util.last_js_id=1),hbl.util.last_js_id+=1,hbl.util.last_js_id<1900){hbl.util.last_js_pollid+=1,this.rnd&&(i=parseInt(10*Math.random()).toString()+"-");var o="/"+t.charAt(0)+"?";"geolocation"==t&&hblrpcTrick?(i="start-"+parseInt(3*Math.random()).toString()+"."+hbl_hostname,i+=o,a="https"):i+=this.uri+o;var r=parseInt(1e4*Math.random())+"."+ +new Date%1e5+"."+hbl.util.last_js_pollid;e.sequence_id=r,e.version=hblJavaScriptVersion,e.pretty=!0,e.throw_exceptions=window.olark.__buildinfo.strict?!0:!1,i+=this.__build_nrpc_arguments(e),hbl.util.append_script(window,document,{scriptid:"o"+hbl.util.last_js_pollid,url:a+"://"+i,tries:n.tries,timeout:n.timeout,cache:!1,error_callback:n.error_callback})}},hbl.client.jsonproxy.prototype.begin=function(e,t,n,i,a){(e?1:0)||olark._.hlog("missing sid #no_begin_wcsid_input"),(t?1:0)||olark._.hlog("missing hblid #no_begin_hblid_input");var o="ALL",r=olark.__legacy_shim.currentGroupIdstring||o,s=this,l=function(){s.do_nrpc_call({command:"create",conversation_id:e,visitor_id:t,site_idstring:n,current_url:i,referrer_url:a,callback:"hbl.client.callbacks.begin",group_id:r,throttle:!1,append_settings:{tries:3,timeout:2e4}})},_=function(e){e.status?l():hbl.client.callbacks.begin(e)},c=olark._.nrpcPrecache;c?c.response?_(c.response):c.responseCallback=_:l()},hbl.client.jsonproxy.prototype.sendmessage=function(e,t,n,i){var a=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendmessage",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),body:t,no_history:!n,notification:i,callback:"hbl.client.callbacks.sendmessage",group_idstring:a,version:hblJavaScriptVersion,append_settings:{tries:3,timeout:45e3}})},hbl.client.jsonproxy.prototype.sendofflinemessage=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring,a={command:"sendofflinemessage",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),body:t,callback:"hbl.client.noop",group_idstring:i,version:hblJavaScriptVersion,append_settings:{tries:3,timeout:45e3}};for(var o in n)n.hasOwnProperty(o)&&(a["form_"+o]=n[o]);this.do_nrpc_call(a)},hbl.client.jsonproxy.prototype.sendcommand=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring;if("disconnectchat"==t)this.do_nrpc_call({command:"destroy",conversation_id:e,callback:"hbl.client.noop",group_idstring:i,append_settings:{tries:3,timeout:45e3}});else if("send_compose_state"==t)this.do_nrpc_call({command:"sendcomposing",conversation_id:e,callback:"hbl.client.noop",state:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}});else if("return_long_poll_now"==t)this.do_nrpc_call({command:"finishlongpoll",conversation_id:e,callback:"hbl.client.noop",state:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}});else{if("unlock_operator"!=t)throw"Unsupported command: "+t;this.do_nrpc_call({command:"sendunlock",conversation_id:e,callback:"hbl.client.noop",message:n,group_idstring:i,append_settings:{tries:3,timeout:45e3}})}},hbl.client.jsonproxy.prototype.setnickname=function(e,t){var n=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendnickname",conversation_id:e,callback:"hbl.client.noop",nickname:t,group_idstring:n,append_settings:{tries:3,timeout:45e3}})},hbl.client.jsonproxy.prototype.noop=function(e,t){this.do_nrpc_call({command:"noop",conversation_id:e,visitor_id:t,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},hbl.client.jsonproxy.prototype.geolocation=function(e,t){this.do_nrpc_call({command:"geolocation",conversation_id:e,visitor_id:t,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.geolocation_ready",append_settings:{tries:3,timeout:45e3}})},hbl.client.jsonproxy.prototype.sendpresence=function(e,t,n){var i=olark.__legacy_shim.currentGroupIdstring;this.do_nrpc_call({command:"sendpresence",conversation_id:e,callback:"hbl.client.noop",status_message:t,status_state:n,group_idstring:i,append_settings:{tries:5,timeout:45e3}})},hbl._exponential_backoff_pollevents_error_handler=function(){var e=1e3*hbl._pollevents_errors*hbl._pollevents_errors,t=45e3;e>t&&(e=t),setTimeout(function(){hbl.client.pollingmanager.finishLastPoll(),hbl.client.pollingmanager.startNextPollNow()},e),hbl._pollevents_errors+=1},hbl.client.jsonproxy.prototype.getmessages=function(e,t){hbl.client.the_count++,hbl.client.last_getmessages=new Date,this.do_nrpc_call({command:"pollevents",throttle:!1,conversation_id:e,callback:"hbl.client.callbacks.pollevents",timeout:29,after:t,append_settings:{timeout:4e4,error_callback:hbl._exponential_backoff_pollevents_error_handler}})},hbl.client.jsonproxy.prototype.pollmessages=function(e,t){hbl.client.the_count++,this.do_nrpc_call({command:"pollevents",throttle:!1,conversation_id:e,callback:"hbl.client.callbacks.pollevents",timeout:0,after:t,append_settings:{timeout:1e4,error_callback:hbl._exponential_backoff_pollevents_error_handler}})},hbl.client.jsonproxy.prototype.popout=function(e){this.do_nrpc_call({command:"popout",conversation_id:e,callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})
},hbl.client.jsonproxy.prototype.end_popout=function(e){this.do_nrpc_call({command:"endpopout",conversation_id:e,callback:"hbl.client.noop",append_settings:{tries:3,timeout:45e3}})},hbl.client.jsonproxy.prototype.log_event=function(e,t,n){this.do_nrpc_call({command:"logevent",conversation_id:e,site_idstring:olark._.identityManager.getSiteId(),callback:"hbl.client.noop",event_type:t,body:n,append_settings:{tries:3,timeout:45e3}})},hbl._hwindow=function(e,t,n){return this.config=t,this.client=e,this.handlers=!1,this.theme=void 0,this.eventmgr=n,this.loaded=!1,this.expanded_textbox=!1,this.has_typed=!1,this.offline_msg_started=!1,this.offline_msg_visible=!1,this.pop_out=!1,this.setTheme=function(e){this.theme&&this.theme.remove(),this.theme=e,this.theme.build(this.config,this.client,this.config.vars.start_visible,this.config.vars.start_habla_window_visible),this.check_theme_for_link_div(),hbl.util.pluginloader(this.config,this.client,this)},this.check_theme_for_link_div=function(){this.theme&&(this.config.vars.hkey&&(this.config.vars.special_link=hbl.util.decode_base64(this.config.vars.hkey).replace("href",'style="'+this.config.vars._habla_link_a+'" href')),(!this.theme.habla_link_div||this.theme.habla_link_div.style&&"none"==this.theme.habla_link_div.style.display||this.theme.habla_link_div.innerHTML.indexOf("http://hab.la")<0&&this.theme.habla_link_div.innerHTML.indexOf("http://www.olark.com")<0||!this.theme.habla_link_div.parentNode)&&(this.theme.habla_link_div=document.createElement("div"),this.config.vars.force_name_habla_link_div&&this.theme.habla_link_div.setAttribute("id","habla_link_div"),this.config.vars.special_link&&(this.theme.habla_link_div.innerHTML=this.config.vars.special_link.replace("hblink1","hblink9")),this.theme.config.vars.append_middle?this.theme.habla_middle_div.appendChild(this.theme.habla_link_div):this.theme.habla_expanded_div.appendChild(this.theme.habla_link_div)),document.getElementById("hblink9")||(this.theme.habla_link_div.innerHTML=hbl.util.decode_base64("RnJlZSA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/ZnJlZV9saXZlaGVscCIgaWQ9ImhibGluazkiIHRhcmdldD0iX2JsYW5rIj5PbGFyazwvYT4gbGl2ZWhlbHAgfCA8YSBocmVmPSJodHRwOi8vd3d3Lm9sYXJrLmNvbS8/bW9yZSIgaWQ9ImhibGluazk5IiB0YXJnZXQ9Il9ibGFuayI+R2V0IGl0ITwvYT48IS0taHR0cDovL3d3dy5vbGFyay5jb20tLT4=")),this.set_link(document.getElementById("hblink9")),this.set_link(document.getElementById("hblink99")),this.theme.habla_link_div.setAttribute("style",this.config.vars._habla_link_div),this.theme.habla_link_div.style.clear="both",document.getElementById("hblink9")&&document.getElementById("hblink9").setAttribute("style",this.config.vars._habla_link_a),document.getElementById("hblink99")&&document.getElementById("hblink99").setAttribute("style",this.config.vars._habla_link_a))},this.set_link=function(e){if(e&&e.href){var t=e.href.split(/[\?\#]/);e.href=t[0]+"?rid="+olark._.identityManager.getSiteId()+"&"+t[1],e.href=e.href.replace("olark.com/","olark.com/welcome/"),e.target="_blank";var n="expanded"==window.olark.__legacy_shim.box_state?!0:!1;olark("api.box.onExpand",function(){setTimeout(function(){n=!0},2e3)}),e.onclick=function(){return n?!0:!1}}},this.register_handlers=function(){this.handlers||(this.handlers=!0,this.eventmgr.register("window_focus",this.events.onWindowFocus,0),this.eventmgr.register("window_click",this.events.onWindowFocus,0),this.eventmgr.register("window_submit",this.events.onWindowSubmit,0),this.eventmgr.register("window_form_submit",this.events.onWindowFormSubmit,0),this.eventmgr.register("window_topbar_clicked",this.events.topBarClicked,0),this.eventmgr.register("habla_closebutton_a_onclick",this.events.closeClicked,0),this.eventmgr.register("habla_sizebutton_a_onclick",this.events.topBarClicked,0),this.eventmgr.register("habla_oplink_a_onclick",this.events.topBarClicked,0),this.eventmgr.register("operator_status_change",this.events.onOpstatusStatusChanged,0),this.eventmgr.register("receive_message",this.events.onChatUpdated,0),this.eventmgr.register("send_message",this.events.onChatUpdated,0),this.eventmgr.register("chat_started",this.events.onChatStarted,0),this.eventmgr.register("theme_loaded",this.events.onThemeLoaded,0))},this.get_operator_state=function(){return this.config.vars.local_mode?this.config.vars.local_operator_state||"available":this.opavailable?this.opbusy?this.config.vars.show_busy_message?"busy":"available":"chat"!=this.opstatus&&"available"!=this.opstatus&&this.opstatus&&""!=this.opstatus?"notavailable":"available":"notavailable"},this.determine_window_status=function(e){var t={};if(window.olark&&window.olark.__legacy_shim){t=window.olark.__legacy_shim,null!=t.box_state&&(e.box_open="expanded"==t.box_state?!0:!1),null!=t.box_visible&&(e.window.theme.visible=t.box_visible?!0:!1,e.box_visible=t.box_visible?!0:!1);var n=e.window.config.vars.close_hides_window;n&&"closed"==t.box_state&&(e.box_visible=!1),e.window.theme.state=t.box_state||e.window.theme.state}if(e.pop_out&&!e.window.config.vars.is_popup)return!1;if(e.pop_out_change&&!e.pop_out)return!0;if(e.chatting||hbl.client.buffer.length>0&&!e.window.config.vars.close_hides_window)return!0;if(e.box_open||"expanded"==e.window.theme.state)return!0;if(e.window.config.vars.start_hidden&&!e.window.theme.visible)return!1;if(e.window.config.vars.close_hides_window&&!e.box_visible)return!1;if(e.window.config.vars.hide_not_available&&!e.opavailable)return!1;var i=e.opavailable&&"chat"!=e.opstatus&&void 0!=e.opstatus&&""!=e.opstatus&&"available"!=e.opstatus;return e.window.config.vars.hide_not_available&&i?!1:!0},this.setInputBox=function(e,t,n){this.theme.setInputBox(e,t,n)},this.setWindowText=function(){var e=this.get_operator_state();if(("notavailable"==e||this.offline_msg_started)&&this.config.vars.offline_msg_mode)return this.setHeader(this.config.vars.not_available_text),void this.setOfflineWindow(this.config.vars.offline_message||" ");if(this.setOfflineWindow(!1),"notavailable"==e)return this.setHeader(this.config.vars.not_available_text),void(hbl.client.buffer.length<1&&this.setBody(this.config.vars.offline_message));if("away"==e)return this.config.vars.show_away_as_header&&this.opmessage?this.setHeader(this.opmessage,!0):this.setHeader(this.config.vars.busy_text||this.config.vars.away_text),void(0==this.client.buffer.length&&this.setBody(this.config.vars.away_message||this.config.vars.busy_message||this.config.vars.offline_message));if("busy"==e)return this.setHeader(this.config.vars.busy_text),void this.setBody(this.config.vars.busy_message);if(0==this.client.buffer.length){var n=t.vars.force_nickname&&""!=t.vars.force_nickname,i=window.olark&&window.olark.__legacy_shim?!0:!1;!this.config.vars.show_pre_chat||this.theme.pre_chat_sent||!i&&n?this.setBody(this.config.vars.welcome_msg):this.setShowPreChat(!0),this.setHeader(this.config.vars.before_chat_text)}else this.setHeader(this.config.vars.in_chat_text)},this.appendFromBuffer=function(e){if(!this.offline_msg_started)if(this.theme)for(var t=0;t<e.length;t++)e[t]&&this.theme.appendNiceMessage(e[t][0],e[t][1],!0);else hbl.hwindow_last_buffer=e,this.eventmgr.register("theme_loaded",function(e){e.window.appendFromBuffer(hbl.hwindow_last_buffer),hbl.hwindow_last_buffer=""},100)},this.setHeader=function(e,t){void 0!=e&&(t&&(e=".."+e.substr(0,10)+".."),this.theme.setHeader(e))},this.events={onOpstatusStatusChanged:function(e){e.window.opstatus=e.status,e.window.opmessage=e.message,e.window.opbusy=e.busy,e.window.pop_out=e.pop_out,e.window.opavailable||!e.available||e.window.config.vars.offline_msg_mode&&e.window.offline_msg_mode||e.window.reloadBuffer(),e.window.opavailable=e.available,e.window.setWindowText();var t=e.window.determine_window_status(e),n=window.olark&&window.olark.__legacy_shim,i=!e.pop_out&&e.pop_out_change;n&&i&&window.olark.__legacy_shim.populate_message_history_from_chat_api&&(habla_conversation_div.innerHTML="",window.olark.__legacy_shim.populate_message_history_from_chat_api()),t||(e.available||!e.window.config.vars.hide_not_available)&&e.window.theme.visible?e.window.show():e.window.hide(1)},onChatUpdated:function(e){e.window.setShowPreChat(!1),e.window.appendFromBuffer(e.msg)},onChatStarted:function(e){if(e.window.opavailable=e.opavailable,e.window.opbusy=e.busy,null==e.nick||e.nick.match(/webuser\d\d/)||e.window.setnickname(e.nick,1),hbl.chat_started_arg=e,e.window.theme)e.window.theme.build(e.window.config,e.window.client,!0),e.window.events.onThemeLoaded(e);else if(e.window.config.vars.theme_obj)e.window.setTheme(t.vars.theme_obj),e.window.events.onThemeLoaded(e);else{hbl.chat_started_arg=e;var n="";e.window.config.vars.theme_path&&(n="http://"+hbl_static_hostname+"/"+e.window.config.vars.theme_path),e.window.config.vars.theme_url&&(n=e.window.config.vars.theme_url),hbl.util.simple_load_js_async(n)}hbl.client.eventmgr.handle("chat_loaded",e)},onThemeLoaded:function(e){e.window.theme||e.window.setTheme(e.obj),hbl.util.BrowserDetect.use_position_absolute_on_ie&&hbl.config.render_ie_hacks();var t=hbl.chat_started_arg,n=t.window.determine_window_status(t);n?(t.window.show(1),t.pop_out&&!t.window.config.vars.is_popup||!(t.box_open||t.window.config.vars.start_expanded||window.olark&&window.olark.__legacy_shim&&"expanded"==olark.__legacy_shim.box_state)||t.window.expand()):t.window.hide(1),t.habla_message&&(t.window.config.vars.offline_message=t.habla_message.msg,t.habla_message.header&&(t.window.config.vars.not_available_text=t.habla_message.header,t.window.setHeader(habla_window.config.vars.not_available_text)),t.window.show(1),t.habla_message.expand&&t.window.expand(),t.window.theme.habla_conversation_div.scrollTop=0)},onWindowFocus:function(e){e.window.normal(),e.window.setWindowText()},topBarClicked:function(e){return e.window.normal(),e.window.expanded?(e.window.compress(),hbl.client.eventmgr.handle("window_compressed")):(e.window.expand(),hbl.client.eventmgr.handle("window_expanded")),!1},closeClicked:function(e){return e.window.close(),hbl.client.eventmgr.handle("window_closed"),!1},onWindowFormSubmit:function(e){e.window.send()},onWindowSubmit:function(e){e.window.send()}},this.send_pipeline=new hbl.util.pipeline(this),this.send_pipeline.add(hbl.pipelines.nickname,999),this},hbl._hwindow.prototype.setnickname=function(e,t){void 0==t&&this.client.setnickname(e)},hbl._hwindow.prototype.show=function(e){"closed"==this.theme.state&&this.theme.__set_css_window_state("compressed"),this.theme.show(),this.visible=!0,e||this.config.vars.disable_rpc_state||this.client.sendshow(),hbl.eventmgr.handle("habla_window_changed",{type:"show"})},hbl._hwindow.prototype.popout=function(e){habla_popup=window.open(hblPopupURL+"?_ok="+olark._.identityManager.getSiteId()+"&wcsid="+olark._.identityManager.getConversationId()+"&_oklv="+olark._.identityManager.getOklvValueForPopout()+"&hblid="+olark._.identityManager.getVisitorId()+"&_okgid="+olark._.cookieManager.get("_okgid")+"&olfsk="+olark._.cookieManager.get("olfsk")+"&host="+window.location.host,"habla_popout","width=300,height=400,scrollbars=no,location=no,status=no,menubar=no,toolbar=no,directories=no,resizable=yes"),habla_popup&&(e||this.client.popout(),this.pop_out=!0,hbl.client.pop_out=!0,habla_popup.focus(),this.hide(e),hbl.eventmgr.handle("habla_window_changed",{type:"popout"}))},hbl._hwindow.prototype.end_popout=function(e){this.pop_out=!1,e||this.client.end_popout(),hbl.eventmgr.handle("habla_window_changed",{type:"endpop_out"})},hbl._hwindow.prototype.close=function(e){this.theme.close(),e||this.config.vars.disable_rpc_state||this.client.sendend(),this.config.vars.close_hides_window&&this.hide(),hbl.eventmgr.handle("habla_window_changed",{type:"close"})},hbl._hwindow.prototype.hide=function(e){this.theme.hide(),this.visible=!1,e||this.config.vars.disable_rpc_state||this.client.sendhide(),hbl.eventmgr.handle("habla_window_changed",{type:"hide"})},hbl._hwindow.prototype.setWidth=function(e){this.theme&&this.theme.setWidth(e),hbl.eventmgr.handle("habla_window_changed",{type:"resize"})},hbl._hwindow.prototype.setInputHeight=function(e){this.theme.setInputHeight(e),hbl.eventmgr.handle("habla_window_changed",{type:"resize"})},hbl._hwindow.prototype.setHeight=function(e){this.theme&&this.theme.setHeight(e),hbl.eventmgr.handle("habla_window_changed",{type:"resize"})},hbl._hwindow.prototype.compress=function(){this.expanded=!1,this.theme.compress(),hbl.util.BrowserDetect.use_position_absolute_on_ie&&this.visible&&window.hbl.__ie6_floating_div_monitor&&window.hbl.__ie6_floating_div_monitor.__move_to_correct_location(),hbl.eventmgr.handle("habla_window_changed",{type:"compress"}),this.config.vars.disable_rpc_state||this.client.sendcompress()},hbl._hwindow.prototype.expand=function(){this.expanded=!0,hbl.util.BrowserDetect.use_position_absolute_on_ie&&"bottom"==this.config.vars.ycorner&&this.theme.setXY(this.theme.habla_window_div.style.left.match(/\d\d*/),this.theme.habla_window_div.style.top.match(/\d\d*/)-this.config.vars.convo_height-this.config.vars.panel_offset),this.theme&&this.theme.expand(),this.config.vars.disable_rpc_state||this.client.sendexpand(),hbl.eventmgr.handle("habla_window_changed",{type:"expand"})},hbl._hwindow.prototype.setPosition=function(e){this.theme.setPosition(e)},hbl._hwindow.prototype.setInline=function(e){this.theme.setInline(e)},hbl._hwindow.prototype.setMargins=function(e,t,n,i){this.theme.setMargins(e,t,n,i)},hbl._hwindow.prototype.getHeader=function(){return this.theme.getHeader()},hbl._hwindow.prototype.reloadBuffer=function(){this.theme.setBody(""),this.appendFromBuffer(this.client.buffer)},hbl._hwindow.prototype.setBody=function(e){this.setOfflineWindow(!1),this.theme.setBody(e||"")},hbl._hwindow.prototype.setOfflineWindow=function(e){this.theme.setOfflineWindow(e)},hbl._hwindow.prototype.setShowPreChat=function(e){this.theme.setShowPreChat(e)},hbl._hwindow.prototype.highlight=function(){this.theme.highlight()},hbl._hwindow.prototype.normal=function(){this.theme.normal()},hbl._hwindow.prototype.send=function(){var e=this.theme.getMessageInputField(),t=this.theme.getMessageInputFieldValue();if(t==this.config.vars.say_text)this.theme.setMessageInputFieldValue("");else if(t&&t.length>0)try{var n=t;this.theme.setMessageInputFieldValue(""),n=this.send_pipeline.run(n),n&&this.client.sendmessage(n),this.normal()}catch(i){throw i}return this.config.vars.disableFocus||(e.focus(),setTimeout(function(){habla_window.theme.getMessageInputField().focus()},10)),!1},hbl.hwindow_util.wrap_and_create_links=function(e,t){function n(e){var t=e.childNodes;if(0==t.length){if(e.data){var i=e.data.replace(/([^\s]{13})/g,"$1%|%").split("%|%");if(i.length>1){var a=document.createElement("span");for(var o in i)if(i.hasOwnProperty(o)&&"string"==typeof i[o]){var r=document.createElement("span");o>0&&r.setAttribute("class","olark_new_line"),i[o]=i[o].replace(/</g,"&lt;"),i[o]=i[o].replace(/>/g,"&gt;"),r.innerHTML=i[o],a.appendChild(r),a.appendChild(document.createElement("wbr"))}return a}return e}return e}for(var s in t)"object"==typeof t[s]&&e.replaceChild(n(t[s]),t[s]);return e}function i(e){var t=document.createElement("div");return t.innerHTML=e,t=n(t),t.innerHTML}function a(e){return e=e.replace(/<\/*body[^>]*>/gi,""),e=e.replace(/<((\/[^a]|[^\/a])[^>]*)>/gi,"<wbr>&lt;$1&gt;<wbr>"),l.config.vars.parse_links&&(e=r(e,l.config.vars.url_handler_target_window,s)),l.config.vars.parse_smileys!==!1&&(e=o(e)),i(e)}function o(e){function t(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}var n={":)":"smile",":(":"frown"};for(var i in n)if(n.hasOwnProperty(i)){var a=new RegExp("\\s"+t(i),"g"),o="olark-smiley-"+n[i];e=e.replace(a,function(e){return' <span class="'+o+'">'+e+"</span>"})}return e}function r(e,t,n){function i(e,n){var i=l.config.vars.chat_does_not_follow_external_links?!0:!1,a=hbl.hwindow_util.refers_to_local_domain(e)?!1:!0;return!n||i&&a?"_blank":t}var a=/^\+?[\<\[]?(?:\%3C)?\s*((https?|ftp|file|telnet|ldap|irc|nntp|news|irc):\/\/\/?)?([\w-]+\.)+[a-zA-Z]{2,4}(:\d+)?(\/[\w\!\#\$\%\&\'\*\+\/\-\=\?\^\_\.\`\{\|\}\~\-]*)*(\?.*)?[\>\]]?$|^[\w\!\#\$\%\&\'\*\+\.\/\-\=\?\^\_\`\{\|\}\~\-]+(?:\.[\w!\#$%&'*+\/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?$/,o=e.split(" ");for(var r in o)o.hasOwnProperty(r)&&(o[r]=o[r].replace(a,function(e){var t=!0;"+"===e.charAt(0)&&(t=!1,e=e.slice(1));var a=e;return'<a href="'+n(e,t)+'" target="'+i(e,t)+'" >'+a.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</a>"}));return o.join(" ")}function s(e,t){return hbl.hwindow_util.get_habla_url(e,l,t)}var l=t;return a(e)},hbl.hwindow_util.refers_to_local_domain=function(e,t){function n(e){return e.replace(/^(?:https?\:\/\/)?(?:www\.)?/,"").split("/")[0]}return t=t||window.location.host,n(t)===n(e)},hbl.hwindow_util.get_habla_url=function(e,t,n){var i=/^\s*(ftp|file|telnet|ldap|irc|nntp|news|irc).*/,a=/^\s*(\/).*/,o=/^\s*(https?)\:\/\/.+/,r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,s=function(e){if(t.config.vars.url_handler&&n){for(var i,a=window.location.search.replace(/^\?/,""),o={},r=a.split(/&/),s=r.length-1;s>=0;s--)i=r[s].split(/=/),o[i[0]]=i[1];return t.config.vars.url_handler+"?_ok="+olark._.identityManager.getSiteId()+"&wcsid="+olark._.identityManager.getConversationId()+"&_oklv="+olark._.identityManager.getOklvValueForPopout()+"&hblid="+olark._.identityManager.getVisitorId()+"&_okgid="+olark._.cookieManager.get("_okgid")+"&olfsk="+olark._.cookieManager.get("olfsk")+"&url="+hbl.util.encode_base64(e)+"&host="+window.location.host}return e};if(e=e.replace(/^\s*%3C\s*/,""),r.test(e))return"mailto:"+e;if(i.test(e))return e;if(a.test(e))return document.location.protocol+"//"+document.domain+e;var l=null;return l=o.test(e)?e:hbl.hwindow_util.refers_to_local_domain(e)?document.location.protocol+"//"+e:"http://"+e,t.config.vars.chat_does_not_follow_external_links||hbl.hwindow_util.refers_to_local_domain(l)?l:s(l)},hbl.pipelines.nickname=function(e,t){if("/nick "==e.substr(0,6)){var n=e.substr(6);return void t.client.setnickname(n)}return e},hbl.pipelines.wrap_text=function(e,t){return hbl.hwindow_util.wrap_and_create_links(e,t)},hbl.pipelines.emoticons=function(e){return e=e.replace(/\;\-\)/,"<code><big>;-)</big></code>"),e=e.replace(/\:\-\)/,"<code><big>:-)</big></code>")},hbl.pipelines.push_url=function(e){var t=e;if(e=e[1],"!push "==e.substr(0,6)){var n="";if(e=e.replace(/&lt;/gi,"["),e=e.replace(/\/*&gt;/gi,"]"),e.match(/<a/)){var i=e.match(/src\s*=\s*"*([^\"]+)\"*/i);i.length>1&&(n=i[1])}else if(e.match(/\[(http[^\]]+)\s*\]/i)){var a=e.match(/\[(http[^\]]+)\]/i);n=a[1]}else n=e.substr(6,e.length-6);if(n=n.split(" ")[0],n=n.split("%20")[0],""!=n){var o=hbl.hwindow_util.get_habla_url(n,habla_window,!0);return void setTimeout(function(){window.location=o},0)}}return t},hbl.client.incoming_pipeline.add(hbl.pipelines.push_url,999),hbl.plugins.incoming_notification_vars={},hbl.plugins.incoming_notification=function(){this.name="incoming_notification",this.load=function(e){var t=this;hbl.plugins.incoming_notification_vars.freq=3e3,hbl.plugins.incoming_notification_vars.flashicon=!1,hbl.plugins.incoming_notification_vars.flashing=!1,hbl.plugins.incoming_notification_vars.original_favicon=!1;var n=hbl.util.find_or_create_el("habla_wcsend_input","textarea");hbl.plugins.incoming_notification_vars.windowTextCleared=!0,e.hwindow.config.vars.flash_titlebar&&(e.hwindow.eventmgr.register("receive_message",this.onReceiveMessage),e.hwindow.eventmgr.register("send_message",this.onWindowFocus),e.hwindow.eventmgr.register("window_focus",this.onWindowFocus),e.hwindow.eventmgr.register("window_click",this.onWindowFocus)),e.hwindow.config.vars.flash_icons&&(hbl.plugins.incoming_notification_vars.default_flash_on_icon=e.hwindow.config.vars.default_flash_off_icon,hbl.oldtitle||(hbl.oldtitle=/Message Received/i.test(document.title)?"":document.title||""),hbl.plugins.incoming_notification_vars.originalFavicon||(hbl.plugins.incoming_notification_vars.originalFavicon=hbl.plugins.incoming_notification_vars.remove_current_icon(!0)||e.hwindow.config.vars.default_flash_on_icon),hbl.plugins.incoming_notification_vars.default_flash_off_icon=hbl.plugins.incoming_notification_vars.originalFavicon,n.onkeypress=function(){t.onWindowFocus({window:e.hwindow}),hbl.plugins.incoming_notification_vars.windowTextCleared=!0})},this.onReceiveMessage=function(e){var t=e.msg[e.msg.length-1][1];/^\s*!/.test(t)||"remote_update"==e.type&&(e.window.highlight(),hbl.plugins.incoming_notification_vars.last_msg="",hbl.client.buffer&&hbl.client.buffer[hbl.client.buffer.length-1]&&(hbl.plugins.incoming_notification_vars.last_msg=hbl.client.buffer[hbl.client.buffer.length-1][1].substr(0,10),e.window.setHeader(".."+hbl.plugins.incoming_notification_vars.last_msg+"..")),hbl.plugins.incoming_notification_vars.windowTextCleared=!1,hbl.plugins.incoming_notification_vars.flashOlarkFavicon())},this.onWindowFocus=function(e){if(hbl.plugins.incoming_notification_vars.resetFavicon(),!hbl.plugins.incoming_notification_vars.windowTextCleared){e.window.setWindowText(),hbl.plugins.incoming_notification_vars.windowTextCleared=!0;var t=document.getElementById("habla_topbar_div");t.className=t.className.replace(/habla_topbar_div_highlighted/,"habla_topbar_div_normal")}},hbl.plugins.incoming_notification_vars.flashOlarkFavicon=function(){document.title="(Message Received: "+hbl.plugins.incoming_notification_vars.last_msg+") "+hbl.oldtitle,hbl.plugins.incoming_notification_vars.set_icon(hbl.plugins.incoming_notification_vars.default_flash_on_icon);var e=!0;hbl.plugins.incoming_notification_vars.flashingInterval=setInterval(function(){hbl.plugins.incoming_notification_vars.set_icon(e?hbl.plugins.incoming_notification_vars.originalFavicon:hbl.plugins.incoming_notification_vars.default_flash_on_icon),e=!e},hbl.plugins.incoming_notification_vars.freq)},hbl.plugins.incoming_notification_vars.resetFavicon=function(){document.title=hbl.oldtitle,clearInterval(hbl.plugins.incoming_notification_vars.flashingInterval);var e=hbl.plugins.incoming_notification_vars.originalFavicon||"";hbl.plugins.incoming_notification_vars.remove_current_icon(),hbl.plugins.incoming_notification_vars.set_icon(e),hbl.plugins.incoming_notification_vars.flashing=!1},hbl.plugins.incoming_notification_vars.remove_current_icon=function(e){if(document.getElementsByTagName("head")&&0!=document.getElementsByTagName("head").length){for(var t=document.getElementsByTagName("head")[0].getElementsByTagName("link"),n=0;n<t.length;n++){var i=t[n];if("image/x-icon"==i.type&&/favicon|favico|shortcut|icon|shortcut\s*icon/i.test(i.rel)){var a=i.href;return e||document.getElementsByTagName("head")[0].removeChild(i),a}}return void 0}},hbl.plugins.incoming_notification_vars.set_icon=function(e){var t=document.createElement("link");t.type="image/x-icon",t.rel="shortcut icon",t.href=e,hbl.plugins.incoming_notification_vars.remove_current_icon(),document.getElementsByTagName("head")&&0!=document.getElementsByTagName("head").length&&document.getElementsByTagName("head")[0].appendChild(t)}},hbl.plugins.messages_received=0,hbl.plugins.expand_on_receive_message=function(){this.name="expand_on_receive_message",this.load=function(e){e.hwindow.eventmgr.register("receive_message",this.onReceiveMessage,-1)},this.onReceiveMessage=function(e){var t=e.msg[e.msg.length-1][1];/^\s*!/.test(t)||(hbl.plugins.messages_received+=1,e.window.pop_out||("start"==e.type||e.window.config.vars.expandOnFirstMessageReceived&&!e.window.config.vars.expandOnMessageReceived&&1!=hbl.plugins.messages_received?"start"!=e.type&&e.window.theme&&"closed"==e.window.theme.state&&(e.window.theme.state="compressed",e.window.show()):(hbl.client.eventmgr.handle("window_expanded"),e.window.expand(),e.window.show())))}},hbl.plugins.away_div_handler=function(){this.name="away_div_handler",this.load=function(e){hbl.util.hide_div("habla_unavailable_div"),hbl.util.hide_div("habla_available_div"),hbl.util.show_div("habla_loading_div",e.hwindow.config.vars.habla_special_div_show_type)||hbl.util.show_div("habla_unavailable_div",e.hwindow.config.vars.habla_special_div_show_type),(void 0!=document.getElementById("habla_available_div")||void 0!=document.getElementById("habla_unavailable_div"))&&e.hwindow.eventmgr.register("operator_status_change",this.onOperatorStatusChange)},this.onOperatorStatusChange=function(e){{var t=e.available,n=e.status;e.message}!t||n&&"chat"!=n&&e.window.config.vars.hide_when_away?(hbl.util.hide_div("habla_available_div"),hbl.util.show_div("habla_unavailable_div",e.window.config.vars.habla_special_div_show_type),hbl.util.hide_div("habla_loading_div")):(hbl.util.show_div("habla_available_div",e.window.config.vars.habla_special_div_show_type),hbl.util.hide_div("habla_unavailable_div"),hbl.util.hide_div("habla_loading_div"))}},hbl.plugins.auto_initiate=function(){this.load=function(e){e.hwindow.config.vars.auto_initiate_allowed&&e.hwindow.config.vars.auto_initiate&&e.hwindow.eventmgr.register("chat_loaded",this.onChatLoad)},this.onChatLoad=function(e){e.session_start&&!e.opbusy&&e.opavailable&&(habla_window.auto_initiated=!1,setTimeout(function(){if(0==hbl.client.buffer.length&&hbl.client.opavailable){habla_window.show(),habla_window.expand(),habla_window.auto_initiated=!0;var t=e.window.config.vars.auto_initiate_message;habla_window.theme.appendNiceMessage(e.window.config.vars.auto_initiate_name,t[Math.floor(Math.random()*t.length)],!0,!1,!0),habla_window.highlight(),hbl.client.buffer=[" "],habla_window.send_pipeline.add(function(e){return habla_window.auto_initiated&&(hbl.client.sendmessage(habla_window.config.vars.auto_initiate_response_notify,!0),habla_window.auto_initiated=!1),e},1e4),habla_window.config.vars.auto_initiate_notify&&hbl.client.sendmessage(habla_window.config.vars.auto_initiate_notify_msg,!0)}},parseInt(1e3*e.window.config.vars.auto_initiate_period)))}},hbl.plugins.google_translate=function(){this.name="googletranslate",this.load=function(){}},hbl.plugins.sounds=function(){this.name="sounds",this.load=function(e){1==e.conf.vars.enableSounds&&hbl.util.simple_load_js_async(e.conf.vars.plugin_path+"contributed/sounds.js")}},hbl.plugins.smileys=function(){this.name="smileys",this.load=function(e){1==e.conf.vars.enableSmileys&&hbl.util.simple_load_js_async(e.conf.vars.plugin_path+"contributed/smileys.js")}},hbl.themes.default_theme=function(){this.appended=!0,this.last_msg=-1,this.visible=!1,this.highlighted=!1,this.state="compressed",this.message_sent=!1,this.offline_window=!1,this.pre_chat_sent=!1,this.ready=!1,this.position="BR",this.build=function(e,t,n){this.client=t,this.config=e,this.set_config(),this.load_styles(),this.div=void 0,this.divid=e.vars.divid,this.build_dom(n),this.set_dom_event_handlers(),this.config.init_from_config(this),this.palette_hack(),this.render_styles(),this.config.vars.disableJSStyles||this.config.vars.no_palette||this.render_palette(),this.set_default_text(),this.register_handlers(),this.ready=!0,this.config.vars.disableJSStyles&&!this.config.vars.start_hidden&&this.show(),hbl.eventmgr.handle("post_theme_loaded")},this.palette_hack=function(){if(hbl.need_ugly_backwards_palette_hack){var e={};for(var t in this.config.style_classes_map)if(this.config.style_classes_map.hasOwnProperty(t))for(var n in this.config.style_classes_map[t])if(this.config.style_classes_map[t].hasOwnProperty(n))for(var i in this.config.palette)this.config.palette.hasOwnProperty(i)&&"hbl_pal_"+i==this.config.style_classes_map[t][n]&&(this.config.style_classes_map[t][n]="hbl_pal_"+i+"_local",e[i+"_local"]=this.config.palette[i]);this.config.palette=e}},this.set_config=function(){var e=new hbl.hconfig;e.style_classes={};var t="habla_button",n="habla_button_a_normal",i="habla_wcsend_input_pre",a="habla_wcsend_field",o="hbl_pal_main_font_size",r="hbl_pal_main_font_family",s="hbl_pal_header_font_size",l="hbl_pal_control_border",_="habla_pre_chat_form_field",c="hbl_pal_button_bg",h="habla_wcsend_input_normal",d="hbl_pal_input_font_size";e.style_classes_map={habla_window_div:["habla_window_div_position","habla_window_div_base","hbl_pal_main_width"],habla_closebutton_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_sizebutton_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_popout_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_end_popout_a:[t,n,s,r,c,"hbl_pal_button_fg"],habla_button_normal:[t,n,s,c,"hbl_pal_button_fg"],habla_button_highlighted:[t,"habla_button_a_highlighted","hbl_pal_header_font_size","hbl_pal_button_bg_highlight","hbl_pal_button_fg_highlight"],habla_button_hover:[t,"habla_button_a_hover","hbl_pal_header_font_size","hbl_pal_button_bg_hover","hbl_pal_button_fg_hover"],habla_panel_div:["habla_panel_border","hbl_pal_main_bg","hbl_pal_panel_border",r,o],habla_oplink_a:["habla_oplink_a_normal","hbl_pal_header_font_size","hbl_pal_title_fg"],habla_oplink_hover:["habla_oplink_a_hover","hbl_pal_header_font_size","hbl_pal_title_fg"],habla_wcsend_input_pre:[a,i,h,"hbl_pal_input_pre_fg",r,d,l],habla_wcsend_input_post:[a,"habla_wcsend_input_post",h,"hbl_pal_main_fg",r,d],habla_wcsend_input:[a,i,h,l,r,d],habla_wcsend_input_highlighted:[a,i,"habla_wcsend_input_highlighted","hbl_pal_control_highlight_border",r,d],habla_name_input:[a,i,h,r,l,d],habla_offline_email_input:[a,i,h,r,l,d],habla_offline_phone_input:[a,i,h,r,l,d],habla_offline_body_input:[i,h,r,l,d],habla_offline_clear_div:["clear_style"],habla_chatform_form:["habla_chatform_form"],habla_input_div:["habla_input_div"],habla_pre_chat_email_input:[_,a,i,h,r,l,d],habla_pre_chat_name_input:[_,a,i,h,r,l,d],habla_pre_chat_phone_input:[_,a,i,h,r,l,d],habla_offline_message_sent_div:["hbl_panel","habla_offline_message_sent_div","hbl_pal_main_height",l,"hbl_pal_main_fg"],habla_pre_chat_div:["hbl_panel","habla_pre_chat_div","hbl_pal_main_height","hbl_pal_main_fg"],habla_offline_message_div:["hbl_panel","habla_offline_message_div",l,"hbl_pal_main_fg"],habla_conversation_div:["hbl_panel","habla_conversation_div","hbl_pal_main_height",l,"hbl_pal_main_fg","hbl_pal_main_bg"],habla_say_text_span:["habla_say_text_span","hbl_pal_main_fg"],habla_submit_button:["habla_submit_button"],habla_offline_submit_input:["habla_offline_submit_input","hbl_pal_offline_submit_fg",l,"hbl_pal_offline_submit_bg"],habla_pre_chat_submit_input:[_,"habla_offline_submit_input","hbl_pal_offline_submit_fg",l,"hbl_pal_offline_submit_bg"],habla_offline_error_span:["habla_offline_error_span"],habla_pre_chat_clear_div:["clear_style"],habla_conversation_p_item:["habla_conversation_p_item","hbl_pal_main_fg"],habla_conversation_person1:["habla_conversation_person1","hbl_pal_local_fg"],habla_conversation_person2:["habla_conversation_person2","hbl_pal_remote_fg"],habla_conversation_text_span:["habla_conversation_text_span","hbl_pal_main_fg"],habla_conversation_notification_nickname:["habla_conversation_person2","hbl_pal_remote_fg","habla_conversation_notification_nickname"],habla_conversation_notification_text_span:["habla_conversation_text_span","hbl_pal_main_fg","habla_conversation_notification"],habla_topbar_div_compressed:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_compressed"],habla_topbar_div:["habla_topbar_div_normal","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"],habla_topbar_div_highlighted:["habla_topbar_div_highlighted","hbl_pal_title_fg_highlight","hbl_pal_title_bg_highlight","habla_topbar_div_expanded"]},e.vars={habla_sizebutton_text_expanded:"_",habla_sizebutton_text_compressed:"^",habla_closebutton_text:"x",habla_popout_text:">",habla_end_popout_text:"&lt;&lt;",_habla_link_div:"padding: 3px 0 5px 0 !important; font-family: helvetica, sans-serif; text-align: center; text-transform: uppercase; font-size: 9px; letter-spacing: 2px; font-weight: bold; color: #aaa !important;",_habla_link_a:"font-family: helvetica, sans-serif; text-transform: uppercase; font-size: 9px !important; letter-spacing: 2px; font-weight: bold; color: #e75917 !important;"},this.config.merge(e);var u=new hbl.hconfig;u.load_defaults(),this.config.merge(u),hbl.client.pollingmanager.setLongPoll(!this.config.vars.poll),this.config.remap_palette(),this.config.remap_palette(),this.config.vars.right_to_left&&(this.config.vars.local_user_display_name="&larr;"),this.config.vars.enable_buttons&&(this.config.style_classes_map.habla_topbar_div=["habla_topbar_div_normal","habla_topbar_clickable","hbl_pal_title_fg","hbl_pal_title_bg","habla_topbar_div_expanded"]),this.config.vars.corner_position&&(this.config.vars.corner_position=this.__getAdjustedPosition(this.config.vars.corner_position))
},this.build_dom=function(e,t){document.getElementById(this.divid)&&(this.appended=!1),this.habla_container=hbl.util.find_or_create_div(this.divid,void 0==this.config.vars.not_append?hbl.util.get_body():void 0),this.habla_container.id="habla_beta_container_do_not_rely_on_div_classes_or_names",this.habla_container.className=this.__get_browser_class()+" "+this.__get_mobile_class()+" "+("BackCompat"==document.compatMode?"olrk-quirks":"olrk-noquirks");var n=hbl.util.find_or_create_div("hbl_operator_state_div",this.habla_container);n.className="olrk-unknown",olark("api.chat.onOperatorsAvailable",function(){n.className="olrk-available"}),olark("api.chat.onOperatorsAway",function(){n.className="olrk-away"});var i=hbl.util.find_or_create_div("hbl_region",n);i.className=this.config.vars.right_to_left?"olrk-rtl":"olrk-normal",this.window_state_div=hbl.util.find_or_create_div("habla_window_state_div",i),this.window_state_div.className=this.config.vars.show_end_popout?"olrk-state-popout":" olrk-state-compressed",this.habla_window_div=hbl.util.find_or_create_div(this.divid,this.window_state_div),t||hbl.util.hide_div(this.habla_window_div);var a=this.config.vars.corner_position&&this.config.vars.corner_position.match(/B/);a&&(this.habla_compressed_div=hbl.util.find_or_create_div("habla_compressed_div",this.habla_window_div)),this.habla_panel_div=hbl.util.find_or_create_div("habla_panel_div",this.habla_window_div),this.habla_both_div=hbl.util.find_or_create_div("habla_both_div",this.habla_panel_div),hbl.util.hide_div(this.habla_panel_div),this.habla_topbar_div=hbl.util.find_or_create_div("habla_topbar_div",this.habla_both_div),this.config.vars.add_tab_closure_span&&(this.olrk_tab_closure_span=hbl.util.find_or_create_el("olrk_tab_closure_span","span"),this.habla_both_div.appendChild(this.olrk_tab_closure_span)),this.habla_expanded_div=hbl.util.find_or_create_div("habla_expanded_div",this.habla_panel_div),a||(this.habla_compressed_div=hbl.util.find_or_create_div("habla_compressed_div",this.habla_window_div)),this.config.vars.left_align_widget&&(this.habla_compressed_div.className="olrk-left-align"),this.habla_closed_div=hbl.util.find_or_create_div("habla_closed_div",this.habla_window_div),e||this.hide(),this.habla_oplink_a=hbl.util.find_or_create_el("habla_oplink_a","a"),this.config.vars.append_oplink_before_buttons&&this.habla_topbar_div.appendChild(this.habla_oplink_a),this.config.vars.show_end_popout?(this.habla_end_popout_a=hbl.util.find_or_create_el("habla_end_popout_a","a"),this.habla_topbar_div.appendChild(this.habla_end_popout_a)):this.config.vars.show_popout&&(this.habla_popout_a=hbl.util.find_or_create_el("habla_popout_a","a"),this.habla_topbar_div.appendChild(this.habla_popout_a)),this.config.vars.enable_buttons&&(this.config.vars.hide_min_max_buttons||(this.habla_closebutton_a=hbl.util.find_or_create_el("habla_closebutton_a","a"),this.config.vars.close_hides_window&&this.habla_topbar_div.appendChild(this.habla_closebutton_a),this.habla_sizebutton_a=hbl.util.find_or_create_el("habla_sizebutton_a","a"),this.habla_topbar_div.appendChild(this.habla_sizebutton_a))),this.config.vars.append_oplink_before_buttons||this.habla_topbar_div.appendChild(this.habla_oplink_a);var o=function(e){var t=document.createElement("div");return t.className="hbl_txt_wrapper",t.appendChild(e),t};this.habla_middle_div=hbl.util.find_or_create_div("habla_middle_div",this.habla_expanded_div);var r=hbl.util.find_or_create_div("habla_middle_wrapper_div",this.habla_middle_div);this.habla_conversation_div=hbl.util.find_or_create_div("habla_conversation_div",r),this.habla_offline_message_sent_div=hbl.util.find_or_create_div("habla_offline_message_sent_div",r),this.habla_offline_message_sent_div.style.display="none",this.habla_offline_message_span=hbl.util.find_or_create_el("habla_offline_message_span","span"),this.habla_offline_message_div=hbl.util.find_or_create_div("habla_offline_message_div",r),this.habla_offline_message_div.style.display="none",this.habla_name_input=hbl.util.find_or_create_el("habla_name_input","textarea"),this.habla_offline_phone_input=hbl.util.find_or_create_el("habla_offline_phone_input","textarea"),this.habla_offline_email_input=hbl.util.find_or_create_el("habla_offline_email_input","textarea"),this.habla_offline_body_input=hbl.util.find_or_create_el("habla_offline_body_input","textarea"),this.habla_offline_clear_div=hbl.util.find_or_create_el("habla_offline_clear_div","div"),this.habla_offline_submit_input=hbl.util.find_or_create_el("habla_offline_submit_input","input");try{this.habla_offline_submit_input.setAttribute("type","submit")}catch(s){}this.habla_offline_error_span=hbl.util.find_or_create_el("habla_offline_error_span","span"),this.habla_offline_message_div.appendChild(this.habla_offline_message_span),this.habla_offline_message_div.appendChild(o(this.habla_name_input)),this.habla_offline_message_div.appendChild(o(this.habla_offline_email_input)),hbl.config.vars.require_offline_phone>0&&this.habla_offline_message_div.appendChild(o(this.habla_offline_phone_input)),this.habla_offline_message_div.appendChild(o(this.habla_offline_body_input)),hbl.config.vars.disable_extra_br||this.habla_offline_message_div.appendChild(hbl.util.find_or_create_el("habla_br","br")),this.habla_offline_message_div.appendChild(this.habla_offline_error_span),this.habla_offline_message_div.appendChild(this.habla_offline_submit_input),this.habla_offline_message_div.appendChild(this.habla_offline_clear_div),this.habla_pre_chat_span=hbl.util.find_or_create_el("habla_pre_chat_span","span"),this.habla_pre_chat_div=hbl.util.find_or_create_div("habla_pre_chat_div",r),this.habla_pre_chat_div.style.display="none",this.habla_pre_chat_name_input=hbl.util.find_or_create_el("habla_pre_chat_name_input","textarea"),this.habla_pre_chat_clear_div=hbl.util.find_or_create_el("habla_pre_chat_clear_div","div"),this.habla_pre_chat_email_input=hbl.util.find_or_create_el("habla_pre_chat_email_input","textarea"),this.habla_pre_chat_phone_input=hbl.util.find_or_create_el("habla_pre_chat_phone_input","textarea"),this.habla_pre_chat_submit_input=hbl.util.find_or_create_el("habla_pre_chat_submit_input","input");try{this.habla_pre_chat_submit_input.setAttribute("type","submit")}catch(s){}if(this.habla_pre_chat_error_span=hbl.util.find_or_create_el("habla_pre_chat_error_span","span"),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_span),this.habla_pre_chat_div.appendChild(o(this.habla_pre_chat_name_input)),this.habla_pre_chat_div.appendChild(o(this.habla_pre_chat_email_input)),this.habla_pre_chat_div.appendChild(o(this.habla_pre_chat_phone_input)),hbl.config.vars.disable_extra_br||this.habla_pre_chat_div.appendChild(hbl.util.find_or_create_el("habla_br_2","br")),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_error_span),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_submit_input),this.habla_pre_chat_div.appendChild(this.habla_pre_chat_clear_div),this.habla_chatform_form=hbl.util.find_or_create_el("habla_chatform_form","form"),this.habla_chatform_form.setAttribute("action","#"),this.habla_chatform_form.setAttribute("method","GET"),this.habla_chatform_form.setAttribute("autocomplete","off"),this.habla_input_div=hbl.util.find_or_create_el("habla_input_div","div"),this.habla_wcsend_input=hbl.util.find_or_create_el("habla_wcsend_input","textarea"),this.habla_wcsend_input.setAttribute("size",this.config.vars.input_box_size),this.habla_input_div.appendChild(o(this.habla_wcsend_input)),hbl.util.BrowserDetect.need_submit_button){this.habla_submit_button=hbl.util.find_or_create_el("habla_submit_button","input");try{this.habla_submit_button.setAttribute("type","button")}catch(s){}this.habla_input_div.appendChild(this.habla_submit_button)}this.habla_chatform_form.appendChild(this.habla_input_div),this.habla_middle_div.appendChild(this.habla_chatform_form)},this.set_events=function(e,t){function n(t,n,i){return function(a){var o;return a||(a=window.event),a.target?o=a.target:a.srcElement&&(o=a.srcElement),3==o.nodeType&&(o=o.parentNode),o==e&&(habla_window.eventmgr.handle(t+"_"+n,{target:o,event:a}),i&&(a.cancelBubble=!0,a.stopPropagation))?(a.stopPropagation(),!1):void 0}}"undefined"!=typeof e&&(e.onblur=n(t,"onblur"),e.onfocus=n(t,"onfocus"),e.onclick=n(t,"onclick",!0),e.onmouseover=n(t,"onmouseover"),e.onmouseout=n(t,"onmouseout"))},this.set_dom_event_handlers=function(){this.habla_submit_button&&(this.habla_submit_button.onclick=function(){habla_window.eventmgr.handle("window_form_submit",{event:void 0})}),this.set_events(this.habla_wcsend_input,"habla_wcsend_input",!0),this.set_events(this.habla_name_input,"habla_name_input"),this.set_events(this.habla_offline_email_input,"habla_offline_email_input"),this.set_events(this.habla_offline_phone_input,"habla_offline_phone_input"),this.set_events(this.habla_offline_body_input,"habla_offline_body_input"),this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input"),this.set_events(this.habla_pre_chat_email_input,"habla_pre_chat_email_input"),this.set_events(this.habla_pre_chat_phone_input,"habla_pre_chat_phone_input"),this.set_events(this.habla_pre_chat_name_input,"habla_pre_chat_name_input"),this.set_events(this.habla_pre_chat_submit_input,"habla_pre_chat_submit_input"),this.habla_conversation_div.onclick=function(){return habla_window.eventmgr.handle("habla_conversation_div_onclick")},this.habla_chatform_form.onfocus=function(){habla_window.eventmgr.handle("habla_chatform_form_onfocus")},this.habla_chatform_form.onsubmit=function(e){return habla_window.eventmgr.handle("window_form_submit",{event:e}),!1},this.habla_pre_chat_phone_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_pre_chat_email_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_pre_chat_name_input.onkeypress=function(e){e||(e=window.event);var t=void 0;return window.event?(e=window.event,t=e.keyCode):e.which&&(t=e.which),13==t||10==t?(habla_window.eventmgr.handle("habla_pre_chat_submit_input_onclick"),!1):void 0},this.habla_wcsend_input.onkeydown=function(e){if(e||(e=window.event),function(t){function n(e){olark.__legacy_shim.disableComposing||hbl.client.sendcommand("send_compose_state",e)}function i(){t.visitorHasStartedTyping||(t.visitorHasStartedTyping=!0,n(l.COMPOSING))}function a(){clearTimeout(t.visitorHasPausedTyping),t.visitorHasPausedTyping=setTimeout(function(){o(),n(l.PAUSED)},_)}function o(){clearTimeout(t.visitorHasPausedTyping),n(l.ACTIVE),t.visitorHasStartedTyping=!1}function r(){o()}function s(){""==habla_window.theme.habla_wcsend_input.value?o():(i(),a())}var l={ACTIVE:"active",INACTIVE:"inactive",COMPOSING:"composing",PAUSED:"paused"},_=3e3;switch(t.visitorHasStartedTyping=t.visitorHasStartedTyping||!1,t.visitorHasPausedTyping=t.visitorHasPausedTyping||-1,e.keyCode){case 10:case 13:r();break;default:s()}}(this),!habla_window.theme.habla_wcsend_input.has_typed)return 13!=e.keyCode&&10!=e.keyCode?habla_window.setInputBox(habla_window.theme.habla_wcsend_input,String.fromCharCode(e.keyCode),"highlight"):habla_window.setInputBox(habla_window.theme.habla_wcsend_input,"","highlight"),habla_window.theme.habla_wcsend_input.has_typed=!0,!1;if(function(){function e(e,n){function a(){i=!1}if(i)return!1;var o=n.parentNode||document.body||document.documentElement;i=!0,setTimeout(a,600),"undefined"==typeof t&&(t=document.createElement("olark"),t.style.display="block",t.style.visibility="hidden",t.style.position="absolute",o.appendChild(t));var r=e.replace(/(\<|\>)/g,"^");t.innerHTML=r;var s=parseInt(t.offsetWidth)>=parseInt(n.offsetWidth);return o.removeChild(t),s}var t,n,i=!1;habla_window.config.vars.disable_expand_text_input||habla_window.expanded_textbox||!e(habla_window.theme.getMessageInputFieldValue(),habla_window.theme.getMessageInputField())||(habla_window.expanded_textbox=!0,habla_window.setInputHeight(habla_window.config.vars.resize_input_height),n=habla_window.theme.habla_wcsend_input.parentNode,n.className=n.className.replace("hbl_long_text_entered","")+" hbl_long_text_entered"),!habla_window.config.vars.disable_expand_text_input&&habla_window.expanded_textbox&&habla_window.theme.getMessageInputFieldValue().length<habla_window.config.vars.resize_length&&(habla_window.expanded_textbox=!1,habla_window.setInputHeight(habla_window.config.vars.input_height),n=habla_window.theme.habla_wcsend_input.parentNode,n.className=n.className.replace("hbl_long_text_entered","")+" hbl_long_text_entered")}(),13==e.keyCode||10==e.keyCode){if(""==habla_window.theme.getMessageInputFieldValue().replace(/^\s*|\s*$/g,""))return;return habla_window.expanded_textbox=!1,habla_window.setInputHeight(habla_window.config.vars.input_height),habla_window.eventmgr.handle("window_submit",{event:e}),!1}return!0},this.set_events(this.habla_oplink_a,"habla_oplink_a"),this.config.vars.show_end_popout?this.set_events(this.habla_end_popout_a,"habla_end_popout_a"):this.config.vars.show_popout&&this.set_events(this.habla_popout_a,"habla_popout_a"),this.config.vars.enable_buttons?(this.habla_topbar_div.onclick=function(e){return habla_window.eventmgr.handle("window_topbar_clicked"),e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),!1},this.config.vars.hide_min_max_buttons||(this.set_events(this.habla_closebutton_a,"habla_closebutton_a"),this.set_events(this.habla_sizebutton_a,"habla_sizebutton_a"))):this.habla_oplink_a.onclick=function(){return!1}},this.styles=[],this.set_css_style=function(e){if(e){e=e.replace("static.olark.com",hbl_static_hostname);var t=/^\s*http/i.test(e);if(t||(e=hbl_ext+"://"+e),e+="?"+hbl_ext,this.style_div){var n=hbl.util.find_or_create_el("habla_style_div_alternative","link");n.setAttribute("type","text/css"),n.setAttribute("rel","alternative stylesheet"),hbl.util.get_head().appendChild(n),n.setAttribute("href",e);var i=document.getElementById("habla_style_div"),a=document.getElementById("habla_style_div_alternative");i.setAttribute("rel","alternative stylesheet"),a.setAttribute("rel","stylesheet"),i.id="habla_style_div_alternative",a.id="habla_style_div"}else this.style_div=hbl.util.find_or_create_el("habla_style_div","link"),this.style_div.setAttribute("type","text/css"),this.style_div.setAttribute("rel","stylesheet"),hbl.util.get_head().appendChild(this.style_div),this.style_div.setAttribute("href",e)}},this.load_styles=function(){var e=this.config.vars.legacy_css_for_linkfollow;if(window.__olark_iframe_wrapper&&e)this.set_css_style(e);else if(!this.config.vars.disableJSStyles||this.config.vars.force_olark_css){var t=hbl_static_hostname+"/themes/defaults/base.css?"+hblCacheConstant,n=hbl_static_hostname+"/themes/defaults/base.ie.css?"+hblCacheConstant,i=hbl.util.BrowserDetect.use_position_absolute_on_ie,a="BackCompat"==document.compatMode?!0:!1,o=hbl_static_hostname+"/themes/azul_popout/preview_theme.css?"+hblCacheConstant,r=void 0;r=window.__olark_popout?this.config.vars.popout_css_url?this.config.vars.popout_css_url:o:this.config.vars.inline_css_url?i?a&&this.config.vars.inline_css_url_quirks?this.config.vars.inline_css_url_quirks:this.config.vars.inline_css_url_ie?this.config.vars.inline_css_url_ie:this.config.vars.inline_css_url:a&&this.config.vars.inline_css_url_quirks?this.config.vars.inline_css_url_quirks:this.config.vars.inline_css_url:i?n:t,this.set_css_style(r)}},this.render_styles=function(){this.config.vars.require_name||(this.habla_pre_chat_name_input.style.display="none",this.habla_pre_chat_name_input.parentNode.style.display="none"),this.config.vars.require_phone||(this.habla_pre_chat_phone_input.style.display="none",this.habla_pre_chat_phone_input.parentNode.style.display="none"),this.config.vars.require_email||(this.habla_pre_chat_email_input.style.display="none",this.habla_pre_chat_email_input.parentNode.style.display="none"),this.config.render_all_styles(this)},this.setInputBox=function(e,t,n,i){e.value=t,this.setInputBoxStyle(e,n,i)},this.setInputBoxStyle=function(e,t,n){n?this.config.set_element_classes(e,"habla_wcsend_input_post"):this.config.set_element_classes(e,"habla_wcsend_input_pre"),"normal"==t?this.config.set_element_classes(e,"habla_wcsend_input"):"highlight"==t&&this.config.set_element_classes(e,"habla_wcsend_input_highlighted")},this.set_default_text=function(){this.set_default_text_event(this.habla_name_input,"habla_name_input",this.config.vars.habla_name_input_text),this.set_default_text_event(this.habla_offline_email_input,"habla_offline_email_input",this.config.vars.habla_offline_email_text),this.set_default_text_event(this.habla_offline_phone_input,"habla_offline_phone_input",this.config.vars.habla_offline_phone_text),this.set_default_text_event(this.habla_offline_body_input,"habla_offline_body_input",this.config.vars.habla_offline_body_text),this.set_default_text_event(this.habla_pre_chat_name_input,"habla_pre_chat_name_input",this.config.vars.habla_name_input_text),this.set_default_text_event(this.habla_pre_chat_email_input,"habla_pre_chat_email_input",this.config.vars.habla_offline_email_text),this.set_default_text_event(this.habla_pre_chat_phone_input,"habla_pre_chat_phone_input",this.config.vars.habla_offline_phone_text),this.set_default_text_event(this.habla_wcsend_input,"habla_wcsend_input",this.config.vars.textbox_message||this.config.vars.say_text),this.habla_offline_submit_input.value=this.config.vars.habla_offline_submit_value,this.set_events(this.habla_wcsend_input,"habla_wcsend_input"),this.set_events(this.habla_offline_email_input,"habla_offline_email_input"),this.set_events(this.habla_offline_phone_input,"habla_offline_phone_input"),this.set_events(this.habla_offline_body_input,"habla_offline_body_input"),this.set_events(this.habla_offline_submit_input,"habla_offline_submit_input"),this.habla_offline_message_sent_div.innerHTML=this.config.vars.habla_offline_sent_text,this.habla_closebutton_a&&(this.habla_closebutton_a.innerHTML=this.config.vars.habla_closebutton_text),this.habla_sizebutton_a&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed),this.habla_popout_a&&(this.habla_popout_a.innerHTML=this.config.vars.habla_popout_text),this.habla_end_popout_a&&(this.habla_end_popout_a.innerHTML=this.config.vars.habla_end_popout_text),this.habla_submit_button&&(this.habla_submit_button.value=this.config.vars.send_text),this.habla_pre_chat_submit_input&&(this.habla_pre_chat_submit_input.value=this.config.vars.pre_chat_submit),this.habla_pre_chat_span.innerHTML=this.config.vars.pre_chat_message,this.setHeader(this.config.vars.check_for_status),1!=window.olark.__legacy_shim.has_messages_in_history&&this.setBody(this.config.vars.welcome_msg)},this.set_default_text_event=function(e,t,n){var i="placeholder"in e;if(i){this.setInputBox(e,""),e.placeholder=n,e.has_typed=!1,hbl.eventmgr.register(t+"_onblur",function(e){e.target.has_typed=""==e.target.value?!1:!0});var a=function(e){e.target.has_typed=!0};hbl.eventmgr.register(t+"_onfocus",a),hbl.eventmgr.register(t+"_onclick",a)}else this.setInputBox(e,n),e.default_text=n,e.has_typed=!1,hbl.eventmgr.register(t+"_onblur",function(e){e.window.theme.setInputBoxStyle(e.target,"normal"),""==e.target.value&&(e.target.value=e.target.default_text,e.target.has_typed=!1)},0),hbl.eventmgr.register(t+"_onclick",function(e){e.target.has_typed||(e.target.has_typed=!0,e.window.setInputBox(e.target,"","highlight")),e.window.theme.setInputBoxStyle(e.target,"highlight")},0),hbl.eventmgr.register(t+"_onfocus",function(e){e.target.has_typed||(e.target.has_typed=!0,e.window.setInputBox(e.target,"","highlight")),e.window.theme.setInputBoxStyle(e.target,"highlight")},0)},this.set_rollover_event=function(e,t,n,i){e&&(e.on_class=i,e.off_class=n,hbl.eventmgr.register(t+"_onmouseover",function(e){e.window.config.set_element_classes(e.target,e.target.on_class)},0),hbl.eventmgr.register(t+"_onmouseout",function(e){e.window.config.set_element_classes(e.target,e.target.off_class)},0),hbl.eventmgr.register(t+"_onclick",function(e){e.window.config.set_element_classes(e.target,e.target.off_class)},0))},this.register_handlers=function(){this.set_rollover_event(this.habla_popout_a,"habla_popout_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_end_popout_a,"habla_end_popout_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_sizebutton_a,"habla_sizebutton_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_closebutton_a,"habla_closebutton_a","habla_button_normal","habla_button_hover"),this.set_rollover_event(this.habla_oplink_a,"habla_oplink_a","habla_oplink_a","habla_oplink_hover"),hbl.eventmgr.register("habla_conversation_div_onclick",function(){habla_window.eventmgr.handle("window_click")},0),hbl.eventmgr.register("habla_chatform_form_onfocus",function(){habla_window.eventmgr.handle("window_focus")},0),hbl.eventmgr.register("habla_popout_a_onclick",function(e){e.window.popout()},0),hbl.eventmgr.register("habla_end_popout_a_onclick",function(e){e.window.end_popout(),setTimeout(function(){window.close()},2)},0),hbl.eventmgr.register("habla_wcsend_input_onclick",function(e){e.window.eventmgr.handle("window_focus")},0),hbl.eventmgr.register("habla_pre_chat_submit_input_onclick",function(e){var t=e.window.config,n=e.window.theme.habla_pre_chat_email_input,i=e.window.theme.habla_pre_chat_name_input,a=e.window.theme.habla_pre_chat_phone_input,o=n.value?hbl.util.strip_whitespace(n.value):void 0,r=i.value?hbl.util.strip_whitespace(i.value):void 0,s=a.value?hbl.util.strip_whitespace(a.value):void 0,l=i.has_typed?!0:!1,_=a.has_typed&&hbl.util.is_valid_phone(s)?!0:!1,c=n.has_typed&&hbl.util.is_valid_email(o)?!0:!1;if(!c&&l&&hbl.util.is_valid_email(r)){var h=r;r=o,o=h,c=!0,l=n.has_typed?!0:!1}(t.vars.require_name<=1||l)&&(t.vars.require_phone<=1||_)&&(t.vars.require_email<=1||c)?(e.window.theme.habla_pre_chat_error_span.innerHTML="",window.olark.__legacy_shim.send_prechat_info({name:r,email:hbl.util.is_valid_email(o)?o:null,phone:hbl.util.is_valid_phone(s)?s:null}),e.window.theme.pre_chat_sent=!0,e.window.setShowPreChat(!1)):e.window.theme.habla_pre_chat_error_span.innerHTML=e.window.config.vars.pre_chat_error_text},0),hbl.eventmgr.register("habla_offline_submit_input_onclick",function(e){var t=e.window.theme.habla_offline_body_input,n=e.window.theme.habla_offline_email_input,i=e.window.theme.habla_offline_phone_input,a=e.window.theme.habla_name_input,o=e.window.theme.config.vars.require_offline_phone;if(e.window.theme.message_sent)e.window.theme.setOfflineWindow(e.window.theme.config.vars.habla_offline_sent_text||" ");else{var r=hbl.util.strip_whitespace(n.value);if(t.has_typed&&n.has_typed&&hbl.util.is_valid_email(r)&&(1>=o||hbl.util.is_valid_phone(i.value))){e.window.theme.message_sent=!0;var s=hblPostURL+"?site_id="+olark._.identityManager.getSiteId()+"&"+hbl.util.urlencode({body:t.value,email:n.value,name:a.value,phone:i.value,location:document.location,referrer:document.referrer});e.window.theme.habla_offline_error_span.innerHTML=e.window.config.vars.sending_text,hbl.util.load_js_async(s),olark("api.visitor.updateEmailAddress",r),olark("api.visitor.updateFullName",a.value),olark("api.visitor.updatePhoneNumber",i.value),hbl.client.sendofflinemessage(t.value,{email:r,name:a.value,phone:i.value,location:document.location,referrer:document.referrer}),e.window.eventmgr.handle("offlineMessageToOperator",{body:t.value,nickname:a.value}),e.window.theme.setOfflineWindow(e.window.theme.config.vars.habla_offline_sent_text||" ")}else e.window.theme.habla_offline_error_span.innerHTML=e.window.config.vars.email_body_error_text}},0),hbl.eventmgr.register("habla_wcsend_input_onmouseover",function(e){e.window.eventmgr.handle("window_focus")},0)},this.remove=function(){this.appended&&hbl.util.remove_element(this.divid)},this.setShowPreChat=function(e){window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status||this.showOnlyThisDiv(e?this.habla_pre_chat_div:this.habla_conversation_div)},this.showOnlyThisDiv=function(e){var t=this.habla_conversation_div,n=this.habla_offline_message_div,i=this.habla_offline_message_sent_div,a=this.habla_pre_chat_div,o=this.habla_chatform_form,r=this.habla_wcsend_input;if(e==t){t.style.display="block",n.style.display="none",i.style.display="none",a.style.display="none";var s="notavailable"!=habla_window.get_operator_state();s&&(o.style.display="block",r.style.display="block")}else e==n?(t.style.display="none",n.style.display="block",i.style.display="none",a.style.display="none",o.style.display="none",r.style.display="none"):e==i?(t.style.display="none",n.style.display="none",i.style.display="block",a.style.display="none",o.style.display="none",r.style.display="none"):e==a&&(t.style.display="none",n.style.display="none",i.style.display="none",a.style.display="block",o.style.display="none",r.style.display="none");olark._.needsFirstTimeOperatorLogin?(this.habla_name_input.style.display="none",this.habla_offline_email_input.style.display="none",this.habla_offline_phone_input.style.display="none",this.habla_offline_body_input.style.display="none",this.habla_offline_submit_input.style.display="none"):(this.habla_name_input.style.display="block",this.habla_offline_email_input.style.display="block",this.habla_offline_phone_input.style.display="block",this.habla_offline_body_input.style.display="block",this.habla_offline_submit_input.style.display="block")},this.setOfflineWindow=function(e){if(!(window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.ignore_prechat_status)){var t=this.config.vars.show_pre_chat&&1!=this.config.vars.disable_offline_messaging_fallback&&"notavailable"==habla_window.get_operator_state();e||t?(this.habla_offline_message_span.innerHTML=e||this.config.vars.offline_message,this.message_sent?(this.showOnlyThisDiv(this.habla_offline_message_sent_div),this.offline_window=!1):(this.offline_window=!0,this.showOnlyThisDiv(this.habla_offline_message_div))):(this.offline_window=!1,this.showOnlyThisDiv(this.habla_conversation_div))}},this.scroll_conversation_history_to_most_recent=function(){var e=this;setTimeout(function(){e.habla_conversation_div.scrollTop=e.habla_conversation_div.scrollHeight},10)},this.setBody=function(e){hbl.client.buffer.length&&hbl.client.is_conversation()||(this.habla_conversation_div.innerHTML="",this.config.render_class(this.habla_conversation_div,"habla_conversation_message_off","habla_conversation_message_on"),""!=e&&(e=hbl.util.as_dom(e),this.config.render_class(this.habla_conversation_div,"habla_conversation_message_on","habla_conversation_message_off"),this.habla_conversation_div.appendChild(e),e.id="hbl_body_message"),this.scroll_conversation_history_to_most_recent())},this.disableMessageInput=function(e){this.habla_wcsend_input.disabled=!0,this.habla_wcsend_input.value=e||""},this.getBody=function(){return this.habla_conversation_div.innerHTML};var e={},t=null,n=function(e){var t=document.createElement("div");t.appendChild(document.createTextNode(e));var n=t.innerHTML;return n};this.appendNiceMessage=function(i,a,o,r){if(void 0!=a&&void 0!=i){if(a&&(a=n(a)),r||(a=this.display_pipeline.run(a)),a){window.olark&&window.olark.__legacy_shim&&window.habla_window&&(a=hbl.hwindow_util.wrap_and_create_links(a,window.habla_window));var s=hbl.client.op_nickname_map[i],l=null;hbl.config.vars.operators&&s&&hbl.config.vars.operators[s.toString()]&&(l=hbl.config.vars.operators[s.toString()].avatar_url),"https:"===document.location.protocol&&"string"==typeof l&&(l=l.replace("http://","https://"));var _=document.createElement("p");if(l&&!e[i]){e[i]=!0;var c=document.createElement("img");c.className="olrk_avatar",c.src=l,_.appendChild(c)}this.config.set_element_classes(_,"habla_conversation_p_item"),null!=t&&t!=i&&(_.className=_.className+" olrk_new_sender"),t=i;var h=document.createElement("span"),d=document.createElement("span");if(i===this.config.vars.myname){this.config.set_element_classes(h,"habla_conversation_person1"),this.config.set_element_classes(d,"habla_conversation_text_span");var u=this.config.vars.local_user_display_name;"&rarr;"===u||"&larr;"===u?h.innerHTML=u:hbl.util.set_inner_text(h,u)}else if(/^INTERNAL_NOTIFICATION/.test(i)){this.config.set_element_classes(h,"habla_conversation_notification_nickname"),this.config.set_element_classes(d,"habla_conversation_notification_text_span"),hbl.util.set_inner_text(h,"");var p=i.split("-"),f=p.slice(2).join("-");p=p.slice(0,2),p.push(f),3===p.length&&setTimeout(function(){olark.__core.trigger_event({namespace:"chat",type:"interfaceElementReady",extensionName:p[1],key:p[2],dom:d})},0)}else{this.config.set_element_classes(h,"habla_conversation_person2"),this.config.set_element_classes(d,"habla_conversation_text_span");var g=this.config.vars.local_name_override?this.config.vars.local_name_override:i;g&&!/^\s*$/.test(g)?hbl.util.set_inner_text(h,g+": "):hbl.util.set_inner_text(h,g)}d.innerHTML=a,_.appendChild(h),_.appendChild(d),this.appendMessage(_,o)}window.habla_window.theme.scroll_conversation_history_to_most_recent()}},this.appendMessage=function(e,t){-1==this.last_msg&&t&&this.setBody(""),e=hbl.util.as_dom(e),this.last_msg+=1,e.setAttribute("id","habla_msg_"+this.last_msg),this.habla_conversation_div.appendChild(e),this.scroll_conversation_history_to_most_recent()},this.setHeader=function(e){this.habla_oplink_a.innerHTML=e},this.getHeader=function(){return this.habla_oplink_a.innerHTML},this.hide=function(){this.visible=!1,this.habla_conversation_div&&(this.habla_conversation_div.style.overflow="hidden"),hbl.util.hide_div(this.habla_window_div),hbl.util.hide_div(this.habla_panel_div),hbl.util.hide_div(this.habla_both_div),hbl.util.hide_div(this.habla_closed_div),hbl.util.hide_div(this.habla_expanded_div),hbl.util.hide_div(this.habla_compressed_div)},this.focus_on_the_input_box=function(){var e=this,t=document.activeElement&&document.activeElement.tagName?document.activeElement.tagName:null;t&&/^(input|textarea|select|option|button|optgroup|form)$/i.test(t)||e.config.vars.disable_input_focusing||window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.disable_input_focusing||e.config.vars.is_inline||e.config.vars.disableFocus||!e.habla_wcsend_input||"none"==e.habla_chatform_form.style.display||setTimeout(function(){if("none"!=e.habla_chatform_form.style.display)try{e.habla_wcsend_input.focus()}catch(t){}},20)},this.expand=function(){this.__set_css_window_state("expanded"),this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_expanded&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded),this.show(),this.focus_on_the_input_box()},this.compress=function(){this.__set_css_window_state("compressed"),this.habla_sizebutton_a&&this.config.vars.habla_sizebutton_text_compressed&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_compressed),this.show()},this.show=function(){this.ready&&(this.visible=!0,this.config.vars.disableJSStyles&&hbl.util.show_div(this.habla_window_div),"closed"==this.state?(hbl.util.hide_div(this.habla_expanded_div),hbl.util.hide_div(this.habla_panel_div),hbl.util.hide_div(this.habla_compressed_div),this.habla_conversation_div.style.overflow="hidden",hbl.util.show_div(this.habla_closed_div)):"expanded"==this.state?(hbl.util.hide_div(this.habla_compressed_div),hbl.util.hide_div(this.habla_closed_div),hbl.util.show_div(this.habla_panel_div),hbl.util.show_div(this.habla_expanded_div),hbl.util.show_div(this.habla_both_div),this.habla_conversation_div.style.overflow="auto",this.scroll_conversation_history_to_most_recent(),this.habla_sizebutton_a&&(this.habla_sizebutton_a.innerHTML=this.config.vars.habla_sizebutton_text_expanded),this.focus_on_the_input_box(),this.normal()):"compressed"==this.state&&(hbl.util.hide_div(this.habla_expanded_div),hbl.util.hide_div(this.habla_closed_div),hbl.util.show_div(this.habla_panel_div),hbl.util.show_div(this.habla_both_div),hbl.util.show_div(this.habla_compressed_div),this.habla_conversation_div.style.overflow="hidden",this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_compressed"),this.habla_sizebutton_div&&(this.habla_sizebutton_div.innerHTML=this.config.vars.habla_sizebutton_text_compressed)))
},this.close=function(){this.__set_css_window_state("closed"),this.show()},this.__set_css_window_state=function(e){this.state;this.state=e,this.window_state_div.className=(this.config.vars.show_end_popout?"olrk-state-popout":"")+"olrk-state-"+e},this.__get_browser_class=function(){return"habla-browser-"+hbl.util.BrowserDetect.browser.toLowerCase()},this.__get_mobile_class=function(){return navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Mobile/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)?"habla-mobile":navigator.userAgent.match(/iPad/)?"habla-ipad":"habla-desktop"},this.setWidth=function(e){if(!this.config.vars.disable_width){var t=e;this.habla_panel_div.style.width=e+"px",t=hbl.util.BrowserDetect.backwards_dimension||"Explorer"==hbl.util.BrowserDetect.browser&&hbl.util.BrowserDetect.backwards_dimension?e-this.config.vars.input_width_offset_compat+"px":"Explorer"==hbl.util.BrowserDetect.browser?e-this.config.vars.input_width_offset_ie+"px":e-this.config.vars.input_width_offset_normal+"px",this.habla_wcsend_input.style.width=t,this.habla_name_input.style.width=t,this.habla_offline_body_input.style.width=t,this.habla_offline_email_input.style.width=t,this.habla_offline_phone_input.style.width=t,this.habla_pre_chat_name_input.style.width=t,this.habla_pre_chat_email_input.style.width=t,this.habla_pre_chat_phone_input.style.width=t}},this.setInputHeight=function(e){hbl.config.vars.disable_height||(e=e>18?e:18,hbl.util.BrowserDetect.backwards_dimension&&(e=e>24?e:24),"undefined"==typeof this.originalHeight&&(this.originalHeight=e,this.habla_wcsend_input.style.lineHeight=e+"px"),this.habla_wcsend_input.style.height=e+"px")},this.setFormInputHeight=function(e){hbl.config.vars.disable_height||(e=e>18?e:18,hbl.util.BrowserDetect.backwards_dimension&&(e=e>24?e:24),e+="px",this.habla_name_input.style.height=e,this.habla_offline_email_input.style.height=e,this.habla_offline_phone_input.style.height=e,this.habla_pre_chat_name_input.style.height=e,this.habla_pre_chat_name_input.style.lineHeight=e,this.habla_pre_chat_email_input.style.height=e,this.habla_pre_chat_email_input.style.lineHeight=e,this.habla_pre_chat_phone_input.style.height=e,this.habla_pre_chat_phone_input.style.lineHeight=e)},this.render_palette=function(){var e=this.config.palette;this.config.vars.limited_palette&&(e=this.config.vars.limited_palette);for(var t in e)if(e.hasOwnProperty(t)&&"string"==typeof this.config.palette[t]){var n=hbl.util.getElementsByClass(this.habla_window_div,"hbl_pal_"+t);for(var i in n)n.hasOwnProperty(i)&&n[i]&&n[i].style&&(t.match("_fg")?n[i].style.color=this.config.palette[t]:t.match("_bg")?n[i].style.backgroundColor=this.config.palette[t]:t.match("_border")&&(n[i].style.borderColor=this.config.palette[t]))}},this.getX=function(){return this.habla_window_div.style.left.match(/\d\d*/)},this.getY=function(){return this.habla_window_div.style.top.match(/\d\d*/)},this.setXY=function(e,t){this.habla_window_div.style.top=t,this.habla_window_div.style.left=e},this.setHeight=function(e){function t(e,t){e&&(e.style.height=t+"px")}hbl.config.vars.disable_height||(e=parseInt(e),t(this.habla_conversation_div,e),t(this.habla_pre_chat_div,e),t(this.habla_offline_body_input,e-85>0?e-85:0))},this.setMargins=function(e,t,n,i){this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginTop=t+"px",this.habla_window_div.style.marginLeft=e+"px",this.habla_window_div.style.marginRight=n+"px",this.habla_window_div.style.marginBottom=i+"px")},this.setInline=function(e){if(e){var t=this.habla_window_div.style.display;this.habla_window_div.setAttribute("style",""),this.config.style_classes_map.habla_window_div=["habla_window_div_position_inline","habla_window_div_base","hbl_pal_main_width"],this.habla_window_div.style.display=t,this.config.render_element_classes(this,"habla_window_div")}else this.setPosition(this.config.vars.corner_position)},this.__getAdjustedPosition=function(e){return e=e.toUpperCase(),this.config.vars.theme_requires_position&&(this.config.vars.theme_requires_position.match(/B/)?e=e.replace("T","B")+"B":this.config.vars.theme_requires_position.match(/T/)&&(e=e.replace("B","T")),this.config.vars.theme_requires_position.match(/R/)?e=e.replace("L","R")+"R":this.config.vars.theme_requires_position.match(/L/)&&(e=e.replace("R","L"))),e},this.setPosition=function(e){var t=this.habla_window_div.style.display;this.config.style_classes_map.habla_window_div=["habla_window_div_base","hbl_pal_main_width"],e=this.__getAdjustedPosition(e),this.habla_window_div.setAttribute("style",""),e.match(/B/)?(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginBottom=this.config.vars.bottom_margin+"px",this.habla_window_div.style.bottom="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-bottom")):(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginTop=this.config.vars.top_margin+"px",this.habla_window_div.style.top="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-top")),e.match(/R/)?(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginRight=this.config.vars.right_margin+"px",this.habla_window_div.style.right="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-right")):(this.config.vars.disable_javascript_position||(this.habla_window_div.style.marginLeft=this.config.vars.left_margin+"px",this.habla_window_div.style.left="0px"),this.config.style_classes_map.habla_window_div.push("olrk-fixed-left")),this.habla_window_div.style.display=t,this.config.vars.disable_javascript_position||(this.habla_window_div.style.position=hbl.util.BrowserDetect.use_position_absolute_on_ie?"absolute":"fixed"),this.config.render_element_classes(this,"habla_window_div"),this.position=e},this.highlight=function(){this.highlighted||(this.config.set_element_classes(this.habla_closebutton_a,"habla_button_highlighted"),this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_highlighted"),this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div_highlighted"),this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input_highlighted"),this.highlighted=!0)},this.normal=function(){this.highlighted&&(this.config.set_element_classes(this.habla_closebutton_a,"habla_button_normal"),this.config.set_element_classes(this.habla_sizebutton_a,"habla_button_normal"),this.config.set_element_classes(this.habla_topbar_div,"habla_button_normal"),this.config.set_element_classes(this.habla_topbar_div,"habla_topbar_div"),this.config.set_element_classes(this.habla_wcsend_input,"habla_wcsend_input"),this.highlighted=!1)},this.getMessageInputField=function(){return this.habla_wcsend_input},this.getMessageInputFieldValue=function(){return this.habla_wcsend_input.value},this.setMessageInputFieldValue=function(e){this.habla_wcsend_input.value=e},this.display_pipeline=new hbl.util.pipeline(this),this.display_pipeline.add(hbl.pipelines.wrap_text,999),this.display_pipeline.add(hbl.pipelines.emoticons,1e3),window.olark&&window.olark.__legacy_shim&&window.olark.__legacy_shim.pipeline_disabler&&this.display_pipeline.add(window.olark.__legacy_shim.pipeline_disabler,1001)},hbl.eventmgr.register("habla_preload_done",function(){hbl.config.vars.theme_path||hbl.config.vars.theme_obj||(hbl.config.vars.theme_obj=new hbl.themes.default_theme)},0),(!window.olark||window.olark&&!window.olark.__legacy_shim)&&(window.olark&&window.olark.__internal&&window.olark.__internal.skip_wc_init_post||(hblJSInline?hbl.eventmgr.register("habla_called_wc_init",function(){wc_init_post()}):wc_init_post())),window.olark&&window.olark.__internal&&window.olark.__internal.declare("__internal.legacy",function(){}),window.olark&&window.olark.__legacy_shim&&(window.olark.__legacy_shim.legacy_post_stub_is_loaded=!0),window.olark.__core.framestorewithjson=function(json,store,framesocket,framestore,framestorewithjson){return json=function(window,document){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,a,o,r,s=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.__jsonlib_toJSON&&(l=l.__jsonlib_toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,n=0;o>n;n+=1)r[n]=str(n,l)||"null";return a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+s+"]":"["+r.join(",")+"]",gap=s,a}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)i=rep[n],"string"==typeof i&&(a=str(i,l),a&&r.push(quote(i)+(gap?": ":":")+a));else for(i in l)Object.hasOwnProperty.call(l,i)&&(a=str(i,l),a&&r.push(quote(i)+(gap?": ":":")+a));return a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+s+"}":"{"+r.join(",")+"}",gap=s,a}}"function"!=typeof Date.prototype.__jsonlib_toJSON&&(Date.prototype.__jsonlib_toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.__jsonlib_toJSON=Number.prototype.__jsonlib_toJSON=Boolean.prototype.__jsonlib_toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep,stringify=null;"function"!=typeof stringify&&(stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("stringify failed");return str("",{"":e})});var parseText=null;return"function"!=typeof parseText&&(parseText=function(text,reviver){function walk(e,t){var n,i,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.hasOwnProperty.call(a,n)&&(i=walk(a,n),void 0!==i?a[n]=i:delete a[n]);return reviver.call(e,t,a)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON parse error: "+text)}),{encode:stringify,decode:parseText}}(window,document),store=function(){function e(){try{return k in g&&g[k]}catch(e){return!1}}function t(){try{return x in g&&g[x]&&g[x][g.location.hostname]}catch(e){return!1}}function n(){function e(e){var t=e.key;t?a(t):o()}window.addEventListener?window.addEventListener("storage",e,!1):window.attachEvent("onstorage",e)}function i(){setInterval(o,v)}function a(e){var t=w[e],n=c(e);if(m[e]=m[e]||[],w[e]=n,t!=n)for(var i=0;i<m[e].length;i++)try{m[e][i]({newValue:n})}catch(a){window.console&&window.console.error&&window.console.error(a)}}function o(){for(var e in m)m.hasOwnProperty(e)&&a(e)}function r(e){return function(){var t=Array.prototype.slice.call(arguments||[],0);t.unshift(h),b.body.appendChild(h),h.addBehavior("#default#userData"),h.load(k);var n=e.apply(f,t);return b.body.removeChild(h),n}}function s(){var e=Array.prototype.slice.call(arguments||[],0),t=e.shift();try{return u[t].apply(u,e),p[t].apply(p,e)}catch(n){return u[t].apply(u,e)}}function l(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t].replace(/^\s*/,"").replace(/\s*$/,"");if(0==n.indexOf(I))return f.deserialize(unescape(n.slice(I.length)))}return{}}function _(e){document.cookie=I+escape(f.serialize(e))+S,document.cookie.length>y&&(window.console&&window.console.warn&&window.console.warn("cookie is too large, clearing storejs"),_({}))}var c,h,d,u,p,f={},g=window,b=g.document,m={},v=750,y=4e3,w={},k="localStorage",x="globalStorage";if(f.set=function(){},f.get=function(){},f.remove=function(){},f.clear=function(){},f.transact=function(e,t){var n=f.get(e);"undefined"==typeof n&&(n={}),t(n),f.set(e,n)},f.listen=function(e,t){w[e]=c(e),m[e]=m[e]||[],m[e].push(t)},f.serialize=function(e){return JSON.stringify(e)},f.deserialize=function(e){return"string"!=typeof e?void 0:JSON.parse(e)},e())h=g[k],f.set=function(e,t){h.setItem(e,f.serialize(t))},f.get=function(e){return f.deserialize(h.getItem(e))},f.remove=function(e){h.removeItem(e)},f.clear=function(){h.clear()},c=function(e){return h.getItem(e)},n();else if(t())h=g[x][g.location.hostname],f.set=function(e,t){h[e]=f.serialize(t)},f.get=function(e){return f.deserialize(h[e]&&h[e].value)},f.remove=function(e){delete h[e]},f.clear=function(){for(var e in h)delete h[e]},c=function(e){return h[e]},i();else if(b.documentElement.addBehavior)h=b.createElement("div"),d={},u={},p={},p.set=r(function(e,t,n){e.setAttribute(t,f.serialize(n)),e.save(k)}),p.get=r(function(e,t){return f.deserialize(e.getAttribute(t))}),p.remove=r(function(e,t){e.removeAttribute(t),e.save(k)}),p.clear=r(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(k);for(var n,i=0;n=t[i];i++)e.removeAttribute(n.name);e.save(k)}),u.set=function(e,t){d[e]=t},u.get=function(e){return d[e]},u.remove=function(e){delete d[e]},u.clear=function(){d={}},f.set=function(e,t){return s("set",e,t)},f.get=function(e){return s("get",e)},f.remove=function(e){return s("remove",e)},f.clear=function(){return s("clear")},c=function(e){try{return r(function(e,t){return e.getAttribute(t)})(e)}catch(t){return d[e]}},i();else{var S="; path="+document.location.pathname,I="storejs=";f.set=function(e,t){{var n=l();n[e]}n[e]=t,_(n)},f.get=function(e){return l()[e]},f.remove=function(e){var t=l();try{delete t[e]}catch(n){t[e]=void 0}_(t)},f.clear=function(){_({})},c=function(e){return f.serialize(l()[e])}}return f}(),framesocket=function(e,t){function n(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(t){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function i(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(t){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function a(e){return e.contentWindow?e.contentWindow:e.contentDocument.window}function o(){return Math.random().toString().replace("0.","TK")}function r(){var t=e.ActiveXObject;if(!t)return-1;try{var n,i=new t("ShockwaveFlash.ShockwaveFlash");return i?(n=i.GetVariable("$version"),parseInt(/([0-9]+)/.exec(n)[1])):-1}catch(a){return-1}}function s(e){return/^\s*(file\:|[a-zA-Z]\:).*/.test(e)}function l(e){var t;return e?""==e.length?null:s(e)?"file:":(t=e.split("//"),t.length>1?t[0]+"//"+t[1].split("/")[0]:t[0]):null}function _(n,i){var a,o,r=Math.floor(99999*Math.random()).toString(),s=t.createElement("span"),l="framesocket"+r,_="framesocket"+r,c=t.getElementsByTagName("body")[0],h=!1,d="try{window."+_+"()}catch(e){"+_+"()}";return c?o=function(){c.appendChild(s)}:(c=t.getElementsByTagName("script")[0],o=function(){c.parentNode.insertBefore(s,c)}),e[_]=function(){i&&!h&&(h=!0,i(a))},s.style.display="none",/(Firefox)/.test(navigator.userAgent)?(s.innerHTML='<iframe style="display: none !important" id="'+l+'" onload="'+d+'"></iframe>',o(),a=t.getElementById(l),a.src=n):(s.innerHTML='<iframe style="display: none !important" id="'+l+'" src="'+n+'" onload="'+d+'"></iframe>',o(),a=t.getElementById(l)),a}function c(e){setTimeout(e,0)}function h(e){return l("file:"==e?null:e)}function d(e,t){function n(){if(e()){var i=a.shift();o=!1,"undefined"!=typeof i&&t(i),a.length>0&&!o&&(o=!0,c(n))}}function i(e){a.push(e),n()}var a=[],o=!1,r=null;return r={queuedSend:i,attemptDequeue:n}}function u(){function n(){function t(t,n){e.postMessage?_.postMessage(t,n):_.document.postMessage(t,n)}function n(e){null==c||s(c)?t(e,"*"):t(e,l(c))}function i(){return"undefined"!=typeof _&&"undefined"!=typeof c?!0:!1}function a(e){_=e,h.attemptDequeue()}function o(e){c=e,h.attemptDequeue()}function r(e){h.queuedSend(e)}var _,c,h,u;return h=d(i,n),u={setPostMessageTargetWindow:a,setPostMessageTargetOrigin:o,send:r}}function r(n){function i(e){var i,r=l(e.origin||e.uri),_=null;"null"==e.origin&&(r="file:"),r&&!s(r)&&(e.uri&&0==e.uri.toString().indexOf(r)?_=e.uri.toString().slice(r.length):t.referrer&&0==t.referrer.toString().indexOf(r)&&(_=t.referrer.toString().slice(r.length))),i=h(r),("undefined"==typeof a||a==i)&&("undefined"==typeof o||o==e.source)&&n({data:e.data,origin:i})}var a,o,r={};return e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),r.setExpectedOrigin=function(e){a=h(e)},r.setExpectedWindow=function(e){o=e},r}b.connect=function(e,t){function i(e){d.send(u+m+e)}var s,c=e.server||e,h=null,d=n(),u=o(),p=c.replace(/\#[^?]*/,"")+"#"+u;return t=t||function(){},d.setPostMessageTargetOrigin(c),_(p,function(e){var n=a(e);s=r(t),s.setExpectedOrigin(l(p)),s.setExpectedWindow(n),d.setPostMessageTargetWindow(n)}),i(v),h={send:i}},b.accept=function(t){function a(e){var n=e.data.split(m),a=n[0],r=n[1];a==_?r==v?h||(h=!0,o.setExpectedOrigin(e.origin),l.setPostMessageTargetOrigin(e.origin)):c(function(){t({data:r,origin:e.origin})}):i("[framesocket] received a message from an origin with an invalid identity")}var o,s=null,l=n(),_=(e.location.hash||"").slice(1),h=!1;return t=t||function(){},l.setPostMessageTargetWindow(e.parent),o=r(a),o.setExpectedWindow(e.parent),s={send:l.send}}}function p(){b.connect=function(t,n){function i(){return g}function a(e){u.frameElementContext.sendToChild(e,b)}function r(e){l.queuedSend(e)}function s(t,n){return t!=b?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to client in frameElement transport"),null):void n()}var l,u,p,f=t.server||t,g=!1,b=o(),m=f.replace(/\#[^?]*/,"")+"#"+b;return n=n||function(){},l=d(i,a),u=_(m),u.frameElementContext=function(){},u.frameElementContext.markChildAsReady=function(e){s(e,function(){c(function(){g=!0,l.attemptDequeue()})})},u.frameElementContext.sendToParent=function(e,t){s(t,function(){n({data:e,origin:h(f)})})},p={send:r}},b.accept=function(n){function i(){return!0}function a(t){e.frameElement.frameElementContext.sendToParent(t,_)}function o(e){s.queuedSend(e)}function r(t,n){return t!=_?(e.console&&e.console.warn&&e.console.warn("[framesocket] invalid security token given to server in frameElement transport"),null):void n()}var s,l,_=(e.location.hash||"").slice(1);return n=n||function(){},e.frameElement.frameElementContext(),e.frameElement.frameElementContext.sendToChild=function(e,i){r(i,function(){n({data:e,origin:h(t.referrer)})})},e.frameElement.frameElementContext.markChildAsReady(_),s=d(i,a),l={send:o}}}function f(){function n(){for(;_.length;)_.shift()(a())}function i(e){var n=t.getElementsByTagName("script")[0],i=t.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,n.parentNode.insertBefore(i,n)}function a(){var t=null;return e.minixdm&&(t=e.minixdm.easyXDM),t||e.easyXDM}function o(e,t){_.push(t),a()?n():r||(r=!0,i(e),s=setInterval(function(){a()&&(n(),clearInterval(s))},100))}var r=!1,s=null,_=[];b.connect=function(t,n){var i,a=t.server||t,r=a.replace(/(\/[^\/]+)$/,""),s=r+"/minixdm.swf",_=r+"/minixdm.js";"http:"==e.location.protocol&&(s=s.replace("https","http")),o(_,function(e){i=new e.Socket({protocol:y,lazy:!1,swf:s,remote:a.replace(/\#[^?]*/,"")+"#basepath="+encodeURIComponent(r),onMessage:function(e,t){n({data:e,origin:l(t)})}})});var c={send:function(e){o(_,function(){i.postMessage(e)})}};return c},b.accept=function(t){var n,i=decodeURIComponent(/basepath=([^?&]+)/.exec(e.location.href.slice(1))[1]),a=i+"/minixdm.swf",r=i+"/minixdm.js";"http:"==e.location.protocol&&(a=a.replace("https","http")),o(r,function(e){n=new e.Socket({protocol:y,swf:a,onMessage:function(e,n){t({data:e,origin:l(n)})}})});var s={send:function(e){o(r,function(){n.postMessage(e)})}};return s}}function g(){n("[framesocket] unsupported browser")}var b={},m="~:DATA:~",v="~:INIT:~",y="6";return e.postMessage||t.postMessage?u():"Gecko"==navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?p():r()>6?f():(b.connect=function(){return g(),{send:g}},b.accept=function(){return g(),{send:g}},b.isCompatible=function(){return!1}),b.isCompatible=b.isCompatible||function(){return!0},b}(window,document),framestore=function(e,t,n,i,a){function o(){if(e.console&&e.console.error)try{e.console.error.apply(e.console,arguments)}catch(t){try{e.console.error(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function r(){if(e.console&&e.console.warn)try{e.console.warn.apply(e.console.warn,arguments)}catch(t){try{e.console.warn(Array.prototype.slice.call(arguments||[]).join(" "))}catch(t){}}}function s(){this.name="ReadTimeoutError"}function l(){this.name="WriteTimeoutError"}function _(){return(new Date).getTime()}function c(e,t){for(var i=Array.prototype.slice.call(arguments||[]).slice(2),a=t.toString(),o=0;o<i.length;o++)a+="undefined"==typeof i[o]?k+escape(x):k+escape(n.encode(i[o]));e.send(a)}function h(e,t){for(var i,a=e.split(k),o=a[0],s=a.slice(1),l=t[o],_=[],c=0;c<s.length;c++)i=unescape(s[c]),_.push(i==x?{}.undefinedValue:n.decode(i));l?l.apply(l,_):r("[framestore] unknown command type:",o)}function d(e,t){try{i.remove("__framestore__.locks."+e)}catch(n){}t(function(){})}function u(e){var t=f(),n=null,i=_(),a=null;for(var o in t)o!=e&&t.hasOwnProperty(o)&&(a=t[o],(null===n||a===!0||i>a)&&(n=o,i=a===!0?0:a));n&&b(n)}function p(e,t){for(;e;)e--,u(t)}function f(){var e="__framestore__.index";try{return i.get(e)||{}}catch(t){return r("[framestore] index capture failed, resetting"),i.set(e,{}),{}}}function g(e){var t="__framestore__.index";try{return i.set(t,e)}catch(n){r("[framestore] index capture failed, clearing entire storage"),i.clear(),i.set(t,e)}}function b(e){var t=f();i.remove(v(e)),delete t[e],g(t)}function m(e){var t=f();t[e]=_(),g(t)}function v(e){return"__framestore__.stores."+e}function y(e,n,a){m(e),d("stores."+e,function(o){function r(e,t){(e||t)&&(e&&(s.data=e),t&&(s.metadata=t),s.metadata.lastUpdated=_(),i.set(l,s)),o()}var s,l=v(e),c={metadata:{creator:t.referrer,lastUpdated:_()},data:{}};try{s=i.get(l)||c}catch(h){if(!a)throw h;s=c}n(s.data,s.metadata,r)})}var w={},k=",",x="~UNDEFINED",S="~DELETEDKEY",I=100,C=2100;return w.connect=function(t,n,i){function o(){k||(k=setTimeout(_,I))}function _(){f.flush()}function d(e){22===e.code||/QUOTA/.test(e.name||"")?m?M&&M():T&&T():e instanceof l?A&&A():e instanceof s?E&&E():m||v?P&&P(e):(r("[framestore] failed to boot, trying to dump storage"),v=!0,f.dump(),f.pull())}function u(e){x=!1,d(e)}var p,f={},g=t.server,b=t.key,m=!1,v=!1,y={},w=[],k=null,x=!1,P=t.onFailure,T=t.onDisabled,M=t.onOverflow,E=t.onReadTimeout,A=t.onWriteTimeout,O=!1,N=null,j=null,V=null,B=t.maxMillisecondsForResponse||C;return p=a.connect(g,function(t){h(t.data,{DOWNLOADED:function(){i&&i.onDownloaded()},FLUSHDONE:function(e){N==e&&(x=!1,w=[],O&&_())},FLUSHFAIL:function(e,t){N==e&&u(t)},PULLFAIL:function(e){V&&(clearTimeout(V),V=null),d(e)},PUSH:function(t,a,o){i&&!m&&i.onFirstPullReceived();var r,s,l,c;if(o)r=a;else for(r=a,s=0;s<w.length;s++)l=w[s],c=y[l],r[l]=c;y=r,V&&(clearTimeout(V),V=null),t=t,m||(m=!0,e.addEventListener?e.addEventListener("beforeunload",_,!1):e.attachEvent("onbeforeunload",_),i&&i.onFirstPullParsed(),n(f))}})}),f.pull=function(){V=setTimeout(function(){r("[framesocket] timed out while pulling from persistent storage"),d(new s)},B),c(p,"PULL",b)},f.flush=function(){if(x)return void(O=!0);if(k&&(clearTimeout(k),k=null),j&&(clearTimeout(j),j=null),O=!1,m&&w.length>0){var e,t,n,i={};for(e=0;e<w.length;e++)t=w[e],n=y[t],i[t]="undefined"==typeof n?S:n;N=(+new Date).toString(),x=!0,j=setTimeout(function(){x&&(r("[framesocket] timed out while flushing to persistent storage"),u(new l))},B),c(p,"FLUSH",b,i,N)}},f.get=function(e){return y[e]},f.set=function(e,t){y[e]=t,w.push(e),o()},f.remove=function(e){try{y[e]=void 0,delete y[e]}catch(t){}w.push(e),o()},f.clear=function(){y={},k&&(clearTimeout(k),k=null),c(p,"CLEAR",b)},f.dump=function(){c(p,"DUMP",b,y)},f.reclaim=function(e){c(p,"RECLAIM",b,e)},f.reject=function(e){for(var t in y){var n;try{n=e(t)?!0:!1}catch(i){n=!1}if(y.hasOwnProperty(t)&&n){try{y[t]=void 0,delete y[t]}catch(i){}w.push(t)}}o()},f.pull(),f},w.accept=function(){function e(e){c(s,"FLUSHDONE",e)}function t(e,t){r("[framestore] unable to flush to persistent storage"),o(e),c(s,"FLUSHFAIL",t,e)}function n(e){r("[framestore] unable to pull from persistent storage"),o(e),c(s,"PULLFAIL",e)}var s,l={};s=a.accept(function(a){h(a.data,{PULL:function(e){function t(t){try{y(e,function(n,i,a){c(s,"PUSH",e,n,t),a(null,null)})}catch(i){n(i)}}l[e]?t():(l[e]=!0,i.listen(v(e),t),i.listen("__framestore__.index",function(){var n=f();for(var i in n)if(i==e)return;r("[framestore] storage reclaimed, pushing cleared contents"),t(!0)}),t())},FLUSH:function(n,i,a){try{y(n,function(n,o,r){var s,l,_={};for(s in i)if(i.hasOwnProperty(s))if(l=i[s],_[s]=n[s],l==S)try{n[s]=void 0,delete n[s]}catch(c){}else n[s]=l;try{r(n,null),e(a)}catch(c){for(var h in _)_.hasOwnProperty(h)&&(n[h]=_[h]);t(c,a)}})}catch(o){t(o,a)}},CLEAR:function(e){b(e)},DUMP:function(e,t){y(e,function(e,n,i){i(t,null)},!0)},RECLAIM:function(e,t){t&&t>0?p(t,e):r("[framestore] number of reclaimed entries must be nonzero")}})}),c(s,"DOWNLOADED")},i.serialize=function(e){return n.encode(e)},i.deserialize=function(e){return"string"!=typeof e?void 0:n.decode(e)},w}(window,document,json,store,framesocket),framestorewithjson=function(e,t,n,i,a){return{framestore:n,json:i,framesocket:a}}(window,document,framestore,json,framesocket)}(),function(e,t){e.wait_for(function(){return e.framestorewithjson},function(){function n(n,i){function a(){return olark._.cookieManager.get("olfsk")}function o(){olark._.cookieManager.erase("olfsk")}function r(e){olark._.cookieManager.set("olfsk",e,63072e6)}function s(){u=!1;var e=olark._.isNewConversation?!0:!1;return e||olark._.hlog("already booted once, but lost olfsk #warn #olfsk_regen"),Math.random().toString().replace("0.","olfsk")}function l(a){function s(t){h||(h=!0,e.data.forceDomain=function(e){o(),c=e,r(a)},e.data.forcePath=function(e){o(),_=e,r(a)},r(a),e.data.storejs=t,i())}function l(){var t=e.framestorewithjson.json;s({set:function(e,n){localStorage.setItem(e,t.encode(n))},get:function(e){return t.decode(localStorage.getItem(e)||"null")},remove:function(e){localStorage.removeItem(e)}})}var u=!1,p=!1,f=function(){e.data.storejs.reject(function(e){return"vsession"==e||e==olark._.identityManager.getConversationId()?!1:!0}),e.data.storejs.reclaim(1),e.data.storejs.flush()},g=!1,b=document.referrer||"";"https:"===location.protocol&&/^http\:/.test(b)&&(g=!0),"http:"===location.protocol&&/^https\:/.test(b)&&(g=!0),""===b&&"http:"===location.protocol&&(g=!0),g&&olark._.hlog("switching from HTTP to HTTPS #ssl_protocol_switch");var m={server:d,key:a,onDisabled:function(){"localStorage"in window&&(t.warn("[olark] persistent storage disabled, chat will restart when crossing over into SSL or other subdomains"),olark._.hlog("data persistence lowered due to #local_storage_disabled"),l())},onOverflow:function(){u?(olark._.hlog("storage overflow, #overflow_cleared_convo_storage"),e.data.storejs.clear()):(olark._.hlog("storage overflow, #eliminated_convo_data"),u=!0,f())},onReadTimeout:function(){olark._.hlog("reads taking too long #storage_read_timeout"),f()},onWriteTimeout:function(){olark._.hlog("writes taking too long #storage_write_timeout"),f()},onFailure:function(n){p?(olark._.hlog("storage failure, #failure_cleared_convo_storage"),e.data.storejs.clear()):(p=!0,t.warn("[olark] dumping storage cache due to unexpected issue:",n),olark._.hlog("unable to persist storage #storage_failure"),e.data.storejs.dump())}};n?l():e.data.storejs=e.framestorewithjson.framestore.connect(m,s,{onDownloaded:function(){olark._.P("storedownloaded")},onFirstPullReceived:function(){olark._.P("storereceived")},onFirstPullParsed:function(){olark._.P("storeparsed")}})}var _="/",c=null,h=!1,d=olark._&&olark._.storage?olark._.storage:"https://static.olark.com/jsclient/storage.html?v=1",u=!0;(olark._.storage?1:0)||olark._.hlog("no storage URL specified in loader, falling back #warn #no_storage_url"),l(a()||s()),setTimeout(function(){h||olark._.hlog("slow data connection (>8s) #slow_framestore_connection")},8e3)}function i(e,t,i){n(t,i)}var a="prev-",o=900,r=864e5,s=/^\s*(__.*|chatNickname|chatStatus)\s*$/,l=function(e,t){e=e||{};for(var n=t.length;n--;){var i=t[n],a=e[i];if("undefined"==typeof a)throw new Error("[olark] '"+i+"' is a required argument")}return e},_=function(e){var t=this;if(t.__key=e.key,t.__keystore=e.keystore,t.__link_to_conversation=e.link_to_conversation,t.__link_to_visitor=e.link_to_visitor,t.__initial_value=e.initial_value,t.__backup=e.backup,t.__backupTransform=e.backupTransform,t.__link_to_visitor&&t.__link_to_conversation)throw new Error("cannot link object reference to both the visitor and conversation");if(t.__event_object_string="PersistentObjectReference."+t.__key,"undefined"==typeof t.get()&&"undefined"!=typeof t.__initial_value&&t.set(t.__initial_value),t.__link_to_conversation&&t.__keystore.isLinkedToVisitor({key:t.__key}))throw new Error("this object is already linked to the visitor, cannot link it to the conversation");if(t.__link_to_visitor&&t.__keystore.isLinkedToConversation({key:t.__key}))throw new Error("this object is already linked to the conversation, cannot link it to the visitor")};_.prototype.get=function(){var t=this,n=t.__keystore.get({key:t.__key,backup:t.__backup,backupTransform:t.__backupTransform});return"undefined"==typeof n?(t.set(t.__initial_value),e.clone_object(t.__initial_value)):e.clone_object(n)},_.prototype.set=function(t){var n=this;if("undefined"==typeof t)throw new Error("'value' required for object set");var i=n.__keystore.get({key:n.__key,backup:n.__backup,backupTransform:n.__backupTransform});e.deep_equals(i,t)||(n.__keystore.set({key:n.__key,value:t,link_to_conversation:n.__link_to_conversation,link_to_visitor:n.__link_to_visitor,backup:n.__backup}),e.trigger_event({namespace:n.__event_object_string,type:"keyChange",key:n.__key,newValue:t,oldValue:i}))},_.prototype.edit=function(e){var t=this,n=t.get();e(n),t.set(n)},_.prototype.change=function(e){t.warn("[olark] 'change' is deprecated, use __SPI_onChange instead"),this.__SPI_onChange(e)},_.prototype.__SPI_onChange=function(t){var n=this;e.listen_for_event({namespace:n.__event_object_string,type:"keyChange",callback:t})};var c=function(){};c.prototype.get=function(){throw new Error},c.prototype.set=function(){throw new Error},c.prototype.clearConversationData=function(){throw new Error},c.prototype.clearVisitorData=function(){throw new Error},c.prototype.isLinkedToConversation=function(){throw new Error},c.prototype.isLinkedToVisitor=function(){throw new Error};var h=function(e){e=e||{};var t=this;t.__conversation_expiration_delta_in_days=.1,t.__visitor_expiration_delta_in_days=365;var n=f({key:"csession",defaultValue:null,expiration_access_tag:olark._.identityManager.getConversationId()});n||p({key:"csession",value:{},expiration_in_milliseconds:t.__conversation_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getConversationId()});var i=f({key:"vsession",defaultValue:null,expiration_access_tag:olark._.identityManager.getVisitorId()});
i||p({key:"vsession",value:{},expiration_in_milliseconds:t.__visitor_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getVisitorId()}),t.set({key:"siteId",value:olark._.siteId,link_to_visitor:!0})};h.prototype=new c,h.prototype.constructor=h,h.prototype.get=function(e){e=e||{};{var n=e.key,i=e.backup;e.backupTransform}if("undefined"==typeof n)throw new Error("'key' required");var a,o=f({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()}),r=f({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()}),s=o[n],l=r[n];if("undefined"!=typeof l?"undefined"!=typeof s?t.warn("[olark]",n,"was stored as associated with both the visitor and conversation, falling back to the conversation value"):a=l:a=s,"undefined"==typeof a&&i){var _,c,h,d,u=(olark._.cookieManager.getAllowingNullAndUndefinedAndEmptyString("_okbk")||"").split(",");for(d=0;d<u.length;d++)_=u[d].split("="),c=_[0],h=unescape(_[1]),c==i&&(a=h)}return a},h.prototype.set=function(e){e=e||{};var t=this,n=e.key,i=e.value,a=e.link_to_visitor,o=e.link_to_conversation,s=e.backup;if("undefined"==typeof n)throw new Error("'key' required");if("undefined"==typeof i)throw new Error("'value' required for key store set");if(a&&o)throw new Error("cannot link data to both a visitor and conversation");if(!a&&!o)throw new Error("currently, you must link to either a conversation or visitor");var l=f({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()}),_=f({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()});if(a){if(_[n])throw new Error("[error] cannot link "+n+" to the visitor, it is already associated with the conversation");l[n]=i,p({key:"vsession",value:l,expiration_in_milliseconds:t.__visitor_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getVisitorId()})}if(o){if(l[n])throw new Error("cannot link this value to the conversation, it is already associated with the visitor");_[n]=i,p({key:"csession",value:_,expiration_in_milliseconds:t.__conversation_expiration_delta_in_days*r,expiration_access_tag:olark._.identityManager.getConversationId()})}if(s){var c,h,d,u,g=(olark._.cookieManager.get("_okbk")||"").split(","),b=[s+"="+escape(i)];for(u=0;u<g.length;u++)c=g[u].split("="),h=c[0],d=unescape(c[1]),h!=s&&b.push(g[u]);olark._.cookieManager.setAllowingNullAndUndefinedAndEmptyString("_okbk",b.join(",")||null)}},h.prototype.clearConversationData=function(){g({key:"csession"}),olark._.cookieManager.erase("_okbk")},h.prototype.clearVisitorData=function(){g({key:"vsession"})},h.prototype.isLinkedToConversation=function(e){e=e||{};var t=e.key;if("undefined"==typeof t)throw new Error("'key' required");var n=f({key:"csession",defaultValue:{},expiration_access_tag:olark._.identityManager.getConversationId()});return"undefined"!=typeof n[t]},h.prototype.isLinkedToVisitor=function(e){e=e||{};var t=e.key;if("undefined"==typeof t)throw new Error("'key' required");var n=f({key:"vsession",defaultValue:{},expiration_access_tag:olark._.identityManager.getVisitorId()});return"undefined"!=typeof n[t]};var d=function(e){e=e||{};var t=this;if("undefined"==typeof e.namespace)throw new Error("'namespace' required");t.__namespace=e.namespace,t.__keystore=new h};d.prototype.__SPI_clearVisitorAndConversationData=function(){var e=this;e.__keystore.clearVisitorData(),e.__keystore.clearConversationData()},d.prototype.__SPI_clearOnlyConversationData=function(){var e=this;e.__keystore.clearConversationData()},function(){var e=d.prototype;e.declareConversationObject=function(e){var n=this;return t.warn("[olark] api.data.declareConversationObject is deprecated, please use api.data.getConversationObject instead"),n.getConversationObject(e)},e.declareVisitorObject=function(e){var n=this;return t.warn("[olark] api.data.declareVisitorObject is deprecated, please use api.data.getVisitorObject instead"),n.getVisitorObject(e)}}(),d.prototype.getConversationObject=function(e){e=e||{};var t=this;if("undefined"==typeof e.key)throw new Error("'key' required for getConversationObject");if("undefined"==typeof e.initialValue&&(e.initialValue=null),s.test(e.key))throw new Error("[olark] '"+e.key+"' is a protected key name, please choose something else");var n=e.initialValue,i=(e.__SPI_forceNamespace||t.__namespace)+"."+e.key,a=new _({key:i,keystore:t.__keystore,initial_value:n,link_to_conversation:!0,backup:e.backup,backupTransform:e.backupTransform});return a},d.prototype.getVisitorObject=function(e){e=e||{};var t=this;if("undefined"==typeof e.key)throw new Error("'key' required for getVisitorObject");if("undefined"==typeof e.initialValue&&(e.initialValue=null),s.test(e.key))throw new Error("[olark] '"+e.key+"' is a protected key name, please choose something else");var n=e.initialValue,i=(e.__SPI_forceNamespace||t.__namespace)+"."+e.key,a=new _({key:i,keystore:t.__keystore,initial_value:n,link_to_visitor:!0,backup:e.backup,backupTransform:e.backupTransform});return a};var u=null;!function(){var t={},n={get:function(n){var i=(new Date).getTime(),a=t[n];if(a&&i-a.timestamp<o)return a.val;var r=e.data.storejs.get(n);return t[n]={val:r,timestamp:i},r},set:function(n,i){var a=(new Date).getTime(),o={val:i,timestamp:a};e.data.storejs.set(n,i),t[n]=o},remove:function(n){e.data.storejs.remove(n),t[n]=void 0;try{delete t[n]}catch(i){}}};u=n}();var p=function(e){e=l(e,["key","value","expiration_in_milliseconds"]);var t=e.key,n=(new Date).getTime(),i={value:e.value,unix_timestamp:n,expiration_in_milliseconds:e.expiration_in_milliseconds};if(e.expiration_access_tag){var o=u.get(a+t);o&&o.expiration_access_tag===e.expiration_access_tag&&(t="prev-"+t),i.expiration_access_tag=e.expiration_access_tag}u.set(t,i)},f=function(n){return n=l(n,["key"]),e.try_and_optionally_catch(function(){var e=u.get(n.key);if(e&&e.expiration_access_tag&&e.expiration_access_tag!==n.expiration_access_tag){var t=u.get(a+n.key);t&&t.expiration_access_tag===n.expiration_access_tag?e=t:(olark._.hlog("new session started, #returning_visitor_session"),u.set(a+n.key,e),u.remove(n.key),e=u.get(n.key))}if(e){var i=(new Date).getTime(),o=i-e.unix_timestamp;return o<e.expiration_in_milliseconds?e.value:(g({key:n.key}),n.defaultValue)}return n.defaultValue},function(e){t.error("[olark] problem retrieving '"+n.key+"' from storejs: "+e.toString()),t.showErrorBacktrace(e)})},g=function(e){e=l(e,["key"]),u.remove(e.key)};e.data={AbstractKeyStore:c,StorejsKeyStore:h,DataApi:d,prepare:i,storejs:null}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.data&&window.olark.__legacy_shim.legacy_post_stub_is_loaded},function(){var n=500,i=300,a=null,o=null,r=!1,s=!1,l=!1,_=function(t){var n=this;if(n.__conf=t.conf,"undefined"==typeof n.__conf)throw new Error("'conf' required");if(n.__chat_api=t.chat_api,"undefined"==typeof n.__chat_api)throw new Error("'chat_api' required");n.__initialize_legacy_event_handlers(),n.__setup_chat_history_handling(),n.__conf.box.behave_like_popout&&n.__setup_popout_behavior(),n.__keystore=new e.data.StorejsKeyStore,n.__renderWelcomeMessage(),n.__SPI_onPrechatWelcomeMessage(function(){n.__renderWelcomeMessage()}),n.__conf.system.offline_msg_mode||(n.__prevent_showing=!1,n.__pending_show=!1,n.__chat_api.__SPI_onOperatorGroupChanging(function(){n.__prevent_showing=!0}),n.__chat_api.__SPI_onOperatorGroupChanged(function(){n.__prevent_showing=!1,n.__chat_api.operatorsAreAvailable()&&n.__pending_show&&n.show()}))};_.prototype.listen=function(n,i){t.warn("[olark] api.box.listen is deprecated, please use api.box.on<METHOD> instead"),e.listen_for_event({namespace:"box",type:n,callback:i})},_.prototype.expand=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.expand()})},_.prototype.onExpand=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"expand",callback:t})},_.prototype.shrink=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.compress()})},_.prototype.onShrink=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"shrink",callback:t})},_.prototype.show=function(){var e=this;return e.__prevent_showing?void(e.__pending_show=!0):void e.__SPI_whenRendered(function(){habla_window.show()})},_.prototype.onShow=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"show",callback:t})},_.prototype.overlay=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.theme.setInline(0),habla_window.end_popout()})},_.prototype.onOverlay=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"overlay",callback:t})},_.prototype.hide=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.hide()})},_.prototype.onHide=function(t){window.olark.__legacy_shim.disable_input_focusing=!0,e.listen_for_event({namespace:"box",type:"hide",callback:t})},_.prototype.popout=function(){habla_window.popout()},_.prototype.onPopout=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"popout",callback:t})},_.prototype.dismiss=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.close()})},_.prototype.onDismiss=function(t){window.olark.__legacy_shim.disable_input_focusing=!0,e.listen_for_event({namespace:"box",type:"dismiss",callback:t})},_.prototype.__SPI_disableUserInterface=function(){var e=document.getElementById("habla_beta_container_do_not_rely_on_div_classes_or_names");e.style.visibility="hidden",e.style.display="none"},_.prototype.__SPI_inline=function(){var e=this;e.__SPI_whenRendered(function(){habla_window.theme.setInline(1)})},_.prototype.__SPI_onInline=function(t){window.olark.__legacy_shim.disable_input_focusing=!1,e.listen_for_event({namespace:"box",type:"inline",callback:t})},_.prototype.__SPI_injectStyleIntoPage=function(e){function t(){var t=document.getElementsByTagName("head")[0];t.insertBefore(e,t.firstChild)}/(Chrome)/.test(navigator.userAgent)?setTimeout(t,1e3):t()},_.prototype.__clear_message_history=function(){var t=this;t.__SPI_whenRendered(function(){e.run_legacy_code(function(e){e.habla_window.setBody("")})})},_.prototype.__renderWelcomeMessage=function(){function e(){return n.__keystore.get({key:"__box.welcomeMessage"})}function t(){var t=e();t&&n.__chat_api.sendMessageToVisitor({nickname:" ",body:t,__SPI_notification:!0}),n.__keystore.set({key:"__box.welcomeMessage",value:null,link_to_conversation:!0})}var n=this;e()&&(n.__chat_api.onReady(function(){window.hbl.config.vars.show_pre_chat?n.__chat_api.__SPI_onPrechatInfoReceived(t):t()}),n.__SPI_whenRendered(function(){var t=e();t&&(window.habla_window.theme.habla_pre_chat_span.innerHTML=t)}))},_.prototype.__SPI_setPrechatWelcomeMessage=function(t){var n=this;n.__keystore.set({key:"__box.welcomeMessage",value:t,link_to_conversation:!0}),e.trigger_event({namespace:"box",type:"prechatWelcomeMessage",body:t}),n.expand()},_.prototype.__SPI_onPrechatWelcomeMessage=function(t){e.listen_for_event({namespace:"box",type:"prechatWelcomeMessage",callback:t})},_.prototype.__SPI_showMessageHistory=function(){var e=this;e.__SPI_whenRendered(function(){return habla_window.config.vars.show_pre_chat?void(habla_window.theme.habla_offline_message_div.style.display="none"):(window.olark.__legacy_shim.ignore_prechat_status=!1,void e.__toggle_divs_by_id({show:["habla_chatform_form","habla_conversation_div"],hide:["olark-api-panel","habla_pre_chat_div","habla_offline_message_div"]}))})},_.prototype.__SPI_getLegacyState=function(e){var t=this.__keystore.get({key:"__box.legacyState"})||{box_open:!1,box_visible:!0};e(t)},_.prototype.__SPI_setLegacyState=function(e){this.__keystore.set({key:"__box.legacyState",value:e,link_to_conversation:!0})},_.prototype.__hide_dom=function(e){return"string"==typeof e&&(e=document.getElementById(e)),"object"==typeof e&&null!==e?(e.style.display="none",!0):!1},_.prototype.__show_dom=function(e){return"string"==typeof e&&(e=document.getElementById(e)),"object"==typeof e&&null!==e?(e.style.display="block",!0):!1},_.prototype.__toggle_divs_by_id=function(e){var t=this,n=e.show,i=e.hide;for(var a in n)if("function"!=typeof n[a]){var o=n[a];t.__show_dom(document.getElementById(o))}for(var r in i)if("function"!=typeof i[r]){var s=i[r];t.__hide_dom(document.getElementById(s))}},_.prototype.__SPI_whenRendered=function(e){olark("api.chat.onReady",e)},_.prototype.__SPI_hideForDuration=function(t){this.hide(),e.trigger_event({namespace:"box",type:"hideForDuration",duration:t})},_.prototype.__SPI_onHideForDuration=function(t){e.listen_for_event({namespace:"box",type:"hideForDuration",callback:t})},_.prototype.__SPI_hideBoxForThisPageOnly=function(){this.__SPI_whenRendered(function(){e.run_legacy_code(function(e){try{e.habla_window.theme.habla_window_div.style.visibility="hidden"}catch(n){t.warn("[olark] unable to hide the chatbox for this page",n)}})})},_.prototype.__SPI_setThemeTextField=function(t,n){n&&olark("api.chat.onReady",function(){e.run_legacy_code(function(e){var i=e.habla_window.theme[t];i.has_typed=!0,i.value=n})})},_.prototype.__setup_popout_behavior=function(){var t=this;window.onbeforeunload=function(){return!1};var a=function(){var a=i,o=n;parseInt(navigator.appVersion,10)>3&&(-1!=navigator.appName.indexOf("Microsoft")?(a=document.body.offsetWidth,o=document.body.offsetHeight):(a=window.innerWidth,o=window.innerHeight)),a&&o&&t.__SPI_whenRendered(function(){e.run_legacy_code(function(e){e.habla_window.config.setHeight(parseInt(o,10)-85),e.habla_window.setHeight(parseInt(o,10)-85),e.habla_window.setWidth(parseInt(a,10))})})};a(),window.onresize=a},_.prototype.__initialize_legacy_event_handlers=function(){function t(){habla_window.theme.habla_wcsend_input.disabled=!0,habla_window.theme.habla_wcsend_input.style.display="none"}function n(){habla_window.theme.habla_wcsend_input.disabled=!1,habla_window.theme.habla_wcsend_input.style.display="block"}var i=this;s||(s=!0,i.__chat_api.onOperatorsAway(t),i.__chat_api.onOperatorsBusy(t),i.__chat_api.onOperatorsAvailable(n),i.__SPI_whenRendered(function(){olark._.P("box")}),hbl.eventmgr.register("chat_loaded",function(){r=!0},0),hbl.eventmgr.register("habla_window_changed",function(t){if(r)switch(t.type){case"popout":e.trigger_event({namespace:"box",type:"popout"});break;case"endpop_out":e.trigger_event({namespace:"box",type:"popin"});break;case"show":o||(o=!0,e.trigger_event({namespace:"box",type:"show"}));break;case"hide":o=!1,e.trigger_event({namespace:"box",type:"hide"});break;case"compress":a=!1,e.trigger_event({namespace:"box",type:"shrink"});break;case"expand":a||(a=!0,e.trigger_event({namespace:"box",type:"expand"}))}},0),hbl.eventmgr.register("habla_closebutton_a_onclick",function(){e.trigger_event({namespace:"box",type:"dismiss"})},0))},_.prototype.__populate_message_history_from_chat_api=function(){var t=this;t.__SPI_whenRendered(function(){var n=t.__chat_api.__SPI_getMessageHistory(),i=0;for(n.length>0&&e.run_legacy_code(function(e){e.habla_window.theme.setBody("")});i<n.length;){var a=n[i++],o=a.nickname||"you",r=a.body;e.run_legacy_code(function(e){/^\s+$/.test(r)||e.habla_window.theme.appendNiceMessage(o,r,!0,!0)})}var s=function(){var e=window.habla_window.theme.habla_conversation_div;e.scrollHeight?e.scrollTop=e.scrollHeight:setTimeout(s,100)};s()})},_.prototype.__setup_chat_history_handling=function(){var t=this;l||(l=!0,t.__chat_api.onReady(function(){t.__populate_message_history_from_chat_api(),t.__chat_api.__SPI_populatedLocalChatHistoryFromRpcServer()&&t.expand()}),t.__chat_api.__SPI_onDeliveryOfMessageFromVisitor(function(t){e.run_legacy_code(function(e){var n=e.hbl.config.vars.myname||"you";e.habla_window.theme.appendNiceMessage(n,t.message.body,!0,!0)})}),t.__chat_api.__SPI_onDeliveryOfMessageFromOperator(function(t){e.run_legacy_code(function(e){e.habla_window.theme.appendNiceMessage(t.message.nickname,t.message.body,!0,!0)})}))},olark.declare({name:"__BoxApiHelper",startup:function(t,n){var i=t.data.getConversationObject({key:"visible",initialValue:n.box.start_hidden?!1:null}),a=t.data.getConversationObject({key:"state",initialValue:null}),o=t.data.getConversationObject({key:"close_hides_window",initialValue:!1}),r=t.data.getConversationObject({key:"hidden_for_visit",initialValue:!1}),s=t.data.getVisitorObject({key:"hidden_for_visitor",initialValue:!1}),l=t.data.getConversationObject({key:"auto_messages",initialValue:[]}),_=function(){window.olark.__legacy_shim.box_visible=i.get(),window.olark.__legacy_shim.box_state=a.get()},c=!n.system.hide_not_available||n.system.offline_msg_mode;c||t.chat.onOperatorsAway(function(){t.visitor.getDetails(function(e){e.isConversing||t.box.hide()})});var h=o.get()===!0&&"closed"===a.get()||r.get()===!0||s.get()===!0;h&&(t.box.hide(),_()),t.chat.onReady(function(){e.run_legacy_code(function(e){o.set(e.hbl.config.vars.close_hides_window?!0:!1)})}),t.box.onDismiss(function(){i.set(!1),a.set("closed"),_()}),t.box.onExpand(function(){i.set(!0),a.set("expanded"),_()}),t.box.onShrink(function(){i.set(!0),a.set("compressed"),_()}),t.box.onOverlay(function(){i.set(!0),_()}),t.box.onPopout(function(){i.set(!1),a.set("closed"),_()}),t.box.onHide(function(){i.set(!1),_()}),t.chat.onOperatorsAway(function(){n.system.hide_when_offline&&t.box.hide()}),t.chat.onOperatorsAvailable(function(){n.system.hide_when_offline&&t.box.show()}),t.box.__SPI_onInline(function(){i.set(!0),_()}),t.box.__SPI_onHideForDuration(function(e){var t=e.duration;t.forVisit?r.set(!0):t.forVisitor&&s.set(!0),i.set(!1),a.set("closed"),_()});var d=function(){r.set(!1),s.set(!1)};t.box.__SPI_whenRendered(function(){t.box.onShow(d),t.box.onExpand(d),t.box.onPopout(d),t.box.onOverlay(d)}),_(),t.chat.onMessageToVisitor(function(){t.box.expand()}),t.chat.onOperatorsAvailable(function(){t.box.__SPI_showMessageHistory()}),window.olark.__legacy_shim.populate_message_history_from_chat_api=function(){t.box.__populate_message_history_from_chat_api()},t.box.__SPI_onPrechatWelcomeMessage(function(e){var t=l.get();t.push(e.body),l.set(t)}),t.chat.onBeginConversation(function(e){var n=l.get().slice(0);n.length>0&&"visitor_msg"==e.__spi_message_type&&t.chat.sendNotificationToOperator({body:["visitor is replying to these automated messages:","  >> "+n.join("\n  >> ")].join("\n")})})}}),olark.extend("__BoxApiHelper"),e.box={BoxApi:_}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.framestorewithjson&&e.data&&window.olark.__legacy_shim.legacy_post_stub_is_loaded},function(){function n(e){function t(e){var t=typeof e;return"object"===t&&(e?"number"!=typeof e.length||e.propertyIsEnumerable("length")||"function"!=typeof e.splice||(t="array"):t="null"),t}return"array"==t(e)}var i=.25,a=/^\s*\!\s*([^\s]+)\s*((.*)\s*)?/,o=1001,r=9999,s=250,l=260,_=270,c=300,h="INTERNAL_NOTIFICATION",d=1e3,u=3e3,p=120,f=600,g=["VisitorImportance","Shopify","CartSaver"],b=" | ",m="\n| ",v=!1,y=!1,w=!1,k=null,x=!1,S=!1,I=!1,C=!1,P={},T=function(){var t=this;t.__message_sending_failsafe_timeout=null,t.__nickname_update_pending=!1,t.__status_update_pending=!1,t.__message_queue=[],t.__notification_queue=[],t.__keystore=new e.data.StorejsKeyStore,t.__connection_wrapper=null,t.__all_extensions_have_run_their_startup_method=!1,t.__sync_pipeline=[],t.__sync_pipeline_is_draining=!1};!function(n){var i=null;T.get_instance=function(){return i||(i=new T),i};var a=!1,o=function(t){a?t():e.listen_for_event({namespace:"SessionConnection",type:"afterReady",callback:function(){a=!0,t()}})};n.get_local_data=function(e){var t=this;return t.__local_get(e)},n.put_local_data=function(e){var t=this;return t.__local_set(e)},n.send_message=function(t){var n=this;if("undefined"==typeof t.body)throw new Error("[olark] 'body' required");n.__message_queue.push(t.body),1==n.__message_queue.length&&e.do_async_call({delay:_},function(){n.__synchronize_with_jabber()})},n.send_notification=function(t){var n=this;if("undefined"==typeof t.body)throw new Error("[olark] 'body' required");n.__notification_queue.push(t.body),1==n.__notification_queue.length&&e.do_async_call({delay:c},function(){n.__synchronize_with_jabber()})},n.update_nickname_for_extension=function(e){var t=this;if("undefined"==typeof e.extension_name)throw new Error("[olark] 'extension_name' required");if("undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");var n=e.extension_name,i=e.snippet,a=e.hides_default_nickname,o=t.__local_get({key:"nickname_lookup"})||{};o[n]={snippet:i,hides_default_nickname:a,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature},t.__local_set({key:"nickname_lookup",value:o}),t.__mark_nickname_update_pending()},n.__mark_nickname_update_pending=function(t){var n=this;n.__nickname_update_pending||(n.__nickname_update_pending=!0,e.do_async_call({delay:s},function(){n.__synchronize_with_jabber(t)})),n.__mark_status_update_pending(!0)},n.update_status_for_extension=function(e){var t=this;if("undefined"==typeof e.extension_name)throw new Error("[olark] 'extension_name' required");if("undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");var n=t.__local_get({key:"status_lookup"})||{};n[e.extension_name]={snippet:e.snippet,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature},t.__local_set({key:"status_lookup",value:n}),t.__mark_status_update_pending()},n.__mark_status_update_pending=function(t){var n=this;n.__status_update_pending||(n.__status_update_pending=!0,e.do_async_call({delay:l},function(){n.__synchronize_with_jabber(void 0,t)}))},n.disconnect=function(){var t=this;e.run_legacy_code(function(e){e.hbl.client.sendcommand&&e.hbl.client.sendcommand("disconnectchat",t.__enableMessageToBeRoutedToGroupIfNecessary(""))})},n.getGroupForThisPage=function(){return this.__groupIdString},n.lockToGroupForThisPage=function(e){var t=this;olark.__legacy_shim.currentGroupIdstring=t.__groupIdString=e},n.unlockFromGroupForThisPage=function(){var e=this;olark.__legacy_shim.currentGroupIdstring=e.__groupIdString={}.undefinedValue},n.__TMP_set_connection_wrapper=function(e){var t=this;t.__connection_wrapper=e,t.__with_open_connection(function(){t.__all_extensions_have_run_their_startup_method=!0,t.__synchronize_with_jabber()})},n.__TMP_get_current_combined_nickname=function(){var t=this,n=t.__local_get({key:"nickname_lookup"})||{},i=[],a=!0,o=function(e){return{v:e.snippet,t:e.secureTimestamp,s:e.secureSignature}};return e.for_each_extension_name_starting_with_most_recent(function(e){var t=n[e],r=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return!0;return!1},s=function(t){r(g,e)?i.unshift(t):i.push(t)};t&&"function"!=typeof t&&t.snippet&&t.snippet.length>0&&(t.hides_default_nickname&&(a=!1),s(o(t)))}),(a||0===i.length)&&i.push(o({snippet:t.__get_default_nickname_snippet()})),e.framestorewithjson.json.encode(i)},n.__TMP_get_current_combined_status=function(){var n=this,i=n.__local_get({key:"status_lookup"})||{},a=[],o=function(e){return{v:e.snippet,t:e.secureTimestamp,s:e.secureSignature}};return e.for_each_extension_name_starting_with_most_recent(function(e){try{var n=i[e];n&&"function"!=typeof n&&a.unshift(o(n))}catch(r){t.error("[olark] problem setting status: "+r.toString()),t.showErrorBacktrace(r)}}),0===a.length&&(a=[{v:"There is no status information available right now.\n Add custom information using the Javascript API (www.olark.com/docs)."}]),a.unshift({v:"{{nickname}}"}),e.framestorewithjson.json.encode(a)},n.__enableMessageToBeRoutedToGroupIfNecessary=function(e){if("string"!=typeof e)throw new Error("[olark] message must be a string");return e},n.__get_default_nickname_snippet=function(){var e=this,t=e.__local_get({key:"default_nickname"})||null;return t||(t="{{geolocation}} #"+Math.floor(1e4*Math.random()).toString(),e.__local_set({key:"default_nickname",value:t})),t},n.__local_get=function(e){var t=this;if("undefined"==typeof e.key)throw new Error("'key' required");var n=t.__keystore.get({key:"sessconn"})||{};return n[e.key]||null},n.__local_set=function(e){var t=this;if("undefined"==typeof e.key)throw new Error("'key' required");var n=t.__keystore.get({key:"sessconn"})||{};n[e.key]=e.value,t.__keystore.set({key:"sessconn",value:n,link_to_conversation:!0})},n.__update_nickname_in_jabber=function(t){var n=this;o(function(){n.__local_set({key:"has_sent_initial_nickname",value:!0}),n.__nickname_update_pending=!1;var i=n.__TMP_get_current_combined_nickname(),a=n.__local_get({key:"previous_nickname"})!=i;n.__local_set({key:"previous_nickname",value:i}),(a||t)&&e.run_legacy_code(function(e){e.hbl.client.setnickname(n.__enableMessageToBeRoutedToGroupIfNecessary(i))})})},n.__update_status_in_jabber=function(t){var n=this;o(function(){n.__local_set({key:"has_sent_initial_status",value:!0}),n.__status_update_pending=!1;var i=n.__TMP_get_current_combined_status(),a=n.__local_get({key:"previous_status"})!=i;n.__local_set({key:"previous_status",value:i}),(a||t)&&e.run_legacy_code(function(e){var t="chat";e.hbl.client.sendpresence(n.__enableMessageToBeRoutedToGroupIfNecessary(i),t)})})};var r=function(e){if("undefined"==typeof e.list)throw new Error("'list' required");for(var t={},n=e.list,i=[],a=0;a<n.length;a++){var o=n[a];t[o]||(t[o]=!0,i.push(o))}return i};n.__dequeue_messages_into_jabber=function(){var n=this;o(function(){var i=n.__message_queue;n.__message_queue=[];var a=r({list:i});a.length!=i.length&&t.warn("[olark] message batch contains",i.length-a.length,"duplicate messages");var o=null;i.length>0&&(o=e.join_string_list({list:a,separator:"\n"})),o&&n.__sendmessage(o,!1)})},n.__dequeue_notifications_into_jabber=function(){var n=this,i=n.__notification_queue;n.__notification_queue=[],e.run_legacy_code(function(){var a=r({list:i});a.length!=i.length&&t.warn("[olark] notification batch contains",i.length-a.length,"duplicate notifications");var o=null;i.length>1?o="[info]\n  - "+e.join_string_list({list:a,separator:"\n  - "}):1==i.length&&(o="[info] "+i[0]),o&&n.__sendmessage(o,!0)})},n.__sendmessage=function(t,n){var i=this,a=i.__local_get({key:"sentmessage"})?!1:!0;e.run_legacy_code(function(e){e.hbl.client.sendmessage(i.__enableMessageToBeRoutedToGroupIfNecessary(t),n?!0:!1,n?!0:{}.undefinedValue,a,i.__TMP_get_current_combined_nickname(),i.__TMP_get_current_combined_status())}),i.__local_set({key:"sentmessage",value:!0})},n.__synchronize_with_jabber=function(e,t){var n=this,i=n.__nickname_update_pending,a=n.__status_update_pending,o=n.__notification_queue.length>0?!0:!1,r=n.__message_queue.length>0?!0:!1,s=n.__local_get({key:"has_sent_initial_nickname"}),l=n.__local_get({key:"has_sent_initial_status"});n.__all_extensions_have_run_their_startup_method&&(s||(i=!0),l||(a=!0));var _=s,c=l;n.__force_nickname_update=n.__force_nickname_update||e,n.__force_status_update=n.__force_status_update||t;var h=n.__sync_pipeline;i&&!n.__nickname_update_queued&&(_=!0,n.__nickname_update_queued=!0,h.push(function(){var e=n.__force_nickname_update;n.__nickname_update_queued=!1,n.__force_nickname_update=!1,n.__update_nickname_in_jabber(e)})),a&&!n.__status_update_queued&&(_?(c=!0,n.__status_update_queued=!0,h.push(function(){var e=n.__force_status_update;n.__status_update_queued=!1,n.__force_status_update=!1,n.__update_status_in_jabber(e)})):n.__trigger_message_sending_failsafe()),o&&(c?h.push(function(){n.__dequeue_notifications_into_jabber()}):n.__trigger_message_sending_failsafe()),r&&(c?h.push(function(){n.__dequeue_messages_into_jabber()}):n.__trigger_message_sending_failsafe()),n.__drain_sync_pipeline()},n.__drain_sync_pipeline=function(){var n=this,i=n.__sync_pipeline,a=function(){if(i.length>0){var o=i.shift();e.try_and_optionally_catch(function(){o()},function(e){t.error("[olark] problem servicing SessionConnection pipeline: "+e.toString()),t.showErrorBacktrace(e)})}i.length>0?e.do_async_call({delay:d},a):n.__sync_pipeline_is_draining=!1};n.__sync_pipeline_is_draining===!1&&(n.__sync_pipeline_is_draining=!0,a())},n.__with_open_connection=function(e){var t=this;t.__connection_wrapper(e)},n.__trigger_message_sending_failsafe=function(){var t=this,n=t.__local_get({key:"has_sent_initial_nickname"}),i=t.__local_get({key:"has_sent_initial_status"});t.__message_sending_failsafe_timeout||(t.__message_sending_failsafe_timeout=e.do_async_call({delay:u},function(){n&&i||(n=!0,i=!0,t.__synchronize_with_jabber())}))}}(T.prototype);var M=function(e){var n=this;if(n.__legacy_message_tuple=e.legacy_message_tuple,"undefined"==typeof n.__legacy_message_tuple)throw new Error("'legacy_message_tuple' required");if("undefined"==typeof e.send_event_type)throw new Error("'send_event_type' required");if("undefined"==typeof e.deliver_event_type)throw new Error("'send_event_type' required");if("undefined"==typeof e.final_delivery_action)throw new Error("'final_delivery_action' required");n.__send_event_type=e.send_event_type,n.__deliver_event_type=e.deliver_event_type,n.__final_delivery_action=e.final_delivery_action,n.__delivered=!1,n.__predelivery_actions=[],n.__new_body=null,n.__SPI_notification=e.__SPI_notification,n.__message_event={namespace:"chat",type:n.__send_event_type,automated:e.is_automated?!0:!1,__SPI_notification:e.__SPI_notification,nickname:n.__legacy_message_tuple[0],body:n.__legacy_message_tuple[1],__legacy_sequence_id:parseFloat(n.__legacy_message_tuple[2]),__SPI_deferMessageDelivery:function(e){n.__predelivery_actions.push(e)},updateBody:function(e){n.__new_body&&t.warn("[olark] two handlers tried to modify the body of the same message, allowing the second one to override"),n.__new_body=e}},n.__original_body=window.olark.__core.clone_object(n.__message_event.body)};!function(n){n.get_processed_body=function(){var e=this;return e.__new_body||e.__message_event.body},n.send=function(){var t=this;e.trigger_event(t.__message_event)},n.deliver=function(){for(var t=this,n=[],i=function(){n[a]=!0;for(var e=n.length,i=!0;e--;)n[e]||(i=!1);i&&t.__trigger_delivery()},a=t.__predelivery_actions.length;a--;)n.push(!1);for(a=t.__predelivery_actions.length,e.listen_for_event({namespace:"chat::Message",type:"doneDeferringMessageDelivery",callback:i});a--;)!function(t,i){i({deliverMessage:function(){n[t]=!0,e.trigger_event({namespace:"chat::Message",type:"doneDeferringMessageDelivery"})}})}(a,t.__predelivery_actions[a]);i()},n.__trigger_delivery=function(){var n=this;n.__delivered||(n.__delivered=!0,n.__original_body!=n.__message_event.body&&t.warn("[olark] you cannot modify the 'body' attribute of messages directly, please use message.updateBody() to modify the body"),e.trigger_event({namespace:"chat",type:n.__deliver_event_type,automated:n.__message_event.automated,nickname:n.__message_event.nickname,body:n.get_processed_body(),__legacy_sequence_id:parseFloat(n.__message_event.__legacy_sequence_id)}),n.__final_delivery_action())}}(M.prototype);var E=function(e){function t(e){return"true"==e?!0:!1}function n(e){return"null"==e?null:e}var i=this;if(i.__conf=e.conf,"undefined"==typeof i.__conf)throw new Error("'conf' required");if(i.__extension_name=e.extension_name,"undefined"==typeof i.__extension_name)throw new Error("'extension_name' required");i.__data=new window.olark.__core.data.DataApi({namespace:"__chatd"}),i.__last_incr_seq_id=i.__data.getConversationObject({key:"last_incr_seq_id",initialValue:0,backup:"cd1",backupTransform:parseFloat}),i.__last_leg_seq_id=i.__data.getConversationObject({key:"last_leg_seq_id",initialValue:0,backup:"cd2",backupTransform:parseFloat}),i.__is_conversing=i.__data.getConversationObject({key:"is_conversing",initialValue:!1,backup:"cd3",backupTransform:t}),i.__hasconnected=i.__data.getConversationObject({key:"hasconnected",initialValue:!1,backup:"cd4",backupTransform:t}),i.__data_history=i.__data.getConversationObject({key:"data_history",initialValue:!1}),i.__last_op_presence=i.__data.getConversationObject({key:"last_op_presence",initialValue:"away",backup:"cd5",backupTransform:n}),i.__last_cmd_seq_id=i.__data.getConversationObject({key:"last_cmd_seq_id",initialValue:0,backup:"cd6",backupTransform:parseFloat}),i.__last_presence=i.__data.getConversationObject({key:"last_presence",initialValue:"chat",backup:"cd8",backupTransform:n}),i.__is_connection_upgraded=i.__data.getConversationObject({key:"is_connection_upgraded",initialValue:!1}),i.__is_ended=i.__data.getConversationObject({key:"is_ended",initialValue:!1}),i.__next_conversation_id=i.__data.getConversationObject({key:"next_conversation_id",initialValue:null}),i.__needsToDoPrechat=i.__data.getConversationObject({key:"needs_prechat",initialValue:null}),i.__SPI_onPrechatInfoReceived(function(){i.__needsToDoPrechat.set(!1)
}),i.onReady(function(){null===i.__needsToDoPrechat.get()&&i.__needsToDoPrechat.set(hbl.config.vars.show_pre_chat?!0:!1)}),i.onBeginConversation(function(){i.__needsToDoPrechat.set(!1)}),i.__initialize_legacy_connection_and_messaging_handlers(),i.__initialize_legacy_history_tracking(),i.__initialize_conversation_tracking(),i.__has_local_history=!0,i.__conversation_message_history=[],i.__session_connection=T.get_instance(),i.__session_connection.__TMP_set_connection_wrapper(function(e){i.__wait_for_chat_to_connect(e)})};!function(){var n=E.prototype;E.prototype.listen=function(n,i){t.warn("[olark] api.chat.listen is deprecated, please use api.chat.on<METHOD> instead"),e.listen_for_event({namespace:"chat",type:n,callback:i})},n.onMessageFromVisitor=function(e){var n=this;return t.warn("[olark] api.chat.onMessageFromVisitor is deprecated, please use api.chat.onMessageToOperator instead"),n.onMessageToOperator(e)},n.onMessageFromOperator=function(e){var n=this;return t.warn("[olark] api.chat.onMessageFromOperator is deprecated, please use api.chat.onMessageToVisitor instead"),n.onMessageToVisitor(e)},n.getNickname=function(){var e=this;return t.warn("[olark] api.chat.getNickname is deprecated, please use api.chat.getVisitorNickname instead"),e.getVisitorNickname()},n.sendAutomatedMessageToVisitor=function(e){var n=this;return t.warn("[olark] api.chat.sendAutomatedMessageToVisitor is deprecated, please use api.chat.sendMessageToVisitor instead"),n.sendMessageToVisitor(e)},n.updateNickname=function(e){var n=this;return t.warn("[olark] api.chat.updateNickname is deprecated, please use api.chat.updateVisitorNickname instead"),n.updateVisitorNickname(e)},n.onConnectComplete=function(e){var n=this;return t.warn("[olark] api.chat.onConnectComplete is deprecated, please use api.chat.onReady instead"),n.onReady(e)}}(),E.prototype.updateVisitorNickname=function(e){e=e||{};var i=this;if(e.nickname&&(e.snippet=e.nickname,t.warn("[olark] giving 'nickname' as an argument to updateVisitorNickname is now deprecated, use 'snippet' instead")),"string"==typeof e&&(e={snippet:e}),"undefined"==typeof e.snippet)return t.warn("[olark] 'snippet' required"),!1;if(n(e.snippet)){if(e.secureTimestamp||e.secureSignature)throw new Error("[olark] you cannot give a list of snippets and also security information, please join the snippets yourself before signing them");e.snippet=e.snippet.join(b)}i.__session_connection.update_nickname_for_extension({extension_name:e.source||i.__extension_name,snippet:e.snippet,hides_default_nickname:e.hidesDefault?!0:!1,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature})},E.prototype.getVisitorNickname=function(n){n=n||{};var i=this;n.other&&t.warn("[olark] giving 'other' as an argument to getVisitorNickname is now deprecated, this method only returns the entire nickname"),n.combined&&t.warn("[olark] giving 'combined' as an argument to getVisitorNickname is now deprecated, this method only returns the entire nickname");for(var a=i.__session_connection.__TMP_get_current_combined_nickname(),o=e.framestorewithjson.json.decode(a),r=[],s=0;s<o.length;s++)r.push(o[s].v);return r.length?r.join(b):null},E.prototype.updateVisitorStatus=function(e){e=e||{};var i=this;if(e.status&&(e.snippet=e.status,t.warn("[olark] giving 'status' as an argument to updateVisitorStatus is now deprecated, use 'snippet' instead")),"string"==typeof e&&(e={snippet:e}),"undefined"==typeof e.snippet)throw new Error("[olark] 'snippet' required");if(n(e.snippet)){if(e.secureTimestamp||e.secureSignature)throw new Error("[olark] you cannot give a list of snippets and also security information, please join the snippets yourself before signing them");e.snippet=e.snippet.join(m)}i.__session_connection.update_status_for_extension({extension_name:i.__extension_name,snippet:e.snippet,secureTimestamp:e.secureTimestamp,secureSignature:e.secureSignature})},E.prototype.getVisitorStatus=function(n){n=n||{};var i=this;n.other&&t.warn("[olark] giving 'other' as an argument to getVisitorStatus is now deprecated, this method only returns the entire status"),n.combined&&t.warn("[olark] giving 'combined' as an argument to getVisitorStatus is now deprecated, this method only returns the entire status");for(var a=i.__session_connection.__TMP_get_current_combined_status(),o=e.framestorewithjson.json.decode(a),r=[],s=0;s<o.length;s++)r.push(o[s].v);return r.length?r.join(m):null},E.prototype.sendNotificationToOperator=function(t){var n=this,i=null;if(i="string"==typeof t?t:t.body,!i)throw new Error("body required");n.__wait_for_chat_to_connect(function(){e.trigger_event({namespace:"chat",type:"notificationToOperator",body:i,after:function(){n.__session_connection.send_notification({body:i})}})})},E.prototype.sendMessageFromVisitor=function(t){var n=this,i=null;if(i="string"==typeof t?t:t.body,!i)throw new Error("body required");n.__wait_for_chat_to_connect(function(){e.trigger_event({namespace:"chat",type:"messageFromVisitor",body:i,after:function(){n.__session_connection.send_message({body:i})}})})},E.prototype.onNotificationToOperator=function(t){e.listen_for_event({namespace:"chat",type:"notificationToOperator",callback:function(e){t({notification:{body:e.body}})}})},E.prototype.sendNotificationToVisitor=function(e){var t=this;t.sendMessageToVisitor({nickname:h,body:e.body,__SPI_notification:!0})},E.prototype.__SPI_sendInterfaceElementToVisitor=function(e){var t=this,n=h+"-"+t.__extension_name+"-"+e.key;t.sendMessageToVisitor({nickname:n,body:"...",__SPI_notification:!0})},E.prototype.__SPI_onInterfaceElementReady=function(t){var n=this;e.listen_for_event({namespace:"chat",type:"interfaceElementReady",callback:function(e){e.extensionName===n.__extension_name&&t({key:e.key,dom:e.dom})}})},E.prototype.__get_next_message_sequence_id_that_is_server_safe=function(){var e=this,t=e.__last_leg_seq_id.get(),n=parseFloat(t),a=e.__last_incr_seq_id.get(),o=parseFloat(a),r=null;return t!=n&&(olark._.hlog("last_legacy_sequence_id was not a float:",t,"#non_int_legseq_id #warn"),t=n||0),a!=o&&(olark._.hlog("last_incremented_sequence_id was not a float:",a,"#non_int_incrseq_id #warn"),a=o||0),r=t>=a?t+i:a+i,e.__last_incr_seq_id.set(r),r},E.prototype.onNotificationToVisitor=function(t){e.listen_for_event({namespace:"chat",type:"messageFromOperator",callback:function(e){e.nickname==h&&t({notification:{body:e.body}})}})},E.prototype.sendMessageToVisitor=function(t){var n=this,i=t.nickname,a=t.body,o=t.skipPrechatSurvey?!0:!1;if(!a)throw new Error("body required");var r=t.automated===!1?!1:!0;o||n.__needsToDoPrechat.get()!==!0?n.__wait_for_chat_to_connect(function(){e.run_legacy_code(function(e){i||(i=e.hbl.client.current_operator()||" "),n.__send_and_deliver_message_from_operator({legacy_message_tuple:[i,a,n.__get_next_message_sequence_id_that_is_server_safe()],is_automated:r,__SPI_notification:t.__SPI_notification})})}):olark("api.box.__SPI_setPrechatWelcomeMessage",a)},E.prototype.onMessageToVisitor=function(t){e.listen_for_event({namespace:"chat",type:"messageFromOperator",callback:function(e){t({message:{nickname:e.nickname,body:e.body,updateBody:function(t){e.updateBody(t)},__SPI_deferMessageDelivery:function(t){e.__SPI_deferMessageDelivery(t)},automated:e.automated,__SPI_notification:e.__SPI_notification}})}})},E.prototype.onMessageToOperator=function(t){e.listen_for_event({namespace:"chat",type:"messageFromVisitor",callback:function(e){t({message:{nickname:e.nickname,body:e.body,updateBody:function(t){e.updateBody(t)},__SPI_deferMessageDelivery:function(t){e.__SPI_deferMessageDelivery(t)}}})}})},E.prototype.onOfflineMessageToOperator=function(t){e.listen_for_event({namespace:"chat",type:"offlineMessageToOperator",callback:function(e){t({message:{nickname:e.message.nickname,body:e.message.body}})}})},E.prototype.onCommandFromOperator=function(t){e.listen_for_event({namespace:"chat",type:"commandFromOperator",callback:function(e){t({command:{name:e.name,body:e.body,nickname:e.nickname}})}})},E.prototype.__SPI_onDeliveryOfMessageFromVisitor=function(t){e.listen_for_event({namespace:"chat",type:"deliveryOfMessageFromVisitor",callback:function(e){t({__legacy_sequence_id:parseFloat(e.__legacy_sequence_id),message:{nickname:e.nickname,body:e.body}})}})},E.prototype.__SPI_onDeliveryOfMessageFromOperator=function(t){e.listen_for_event({namespace:"chat",type:"deliveryOfMessageFromOperator",callback:function(e){t({__legacy_sequence_id:parseFloat(e.__legacy_sequence_id),message:{nickname:e.nickname,body:e.body}})}})},E.prototype.operatorsAreAvailable=function(){return"available"==k},E.prototype.onOperatorsAvailable=function(t){e.listen_for_event({namespace:"chat",type:"operatorsAvailable",callback:t})},E.prototype.operatorsAreBusy=function(){return"busy"==k},E.prototype.onOperatorsBusy=function(t){e.listen_for_event({namespace:"chat",type:"operatorsBusy",callback:t})},E.prototype.operatorsAreAway=function(){return"away"==k},E.prototype.onOperatorsAway=function(t){e.listen_for_event({namespace:"chat",type:"operatorsAway",callback:t})},E.prototype.__SPI_onConnectBegin=function(t){e.listen_for_event({namespace:"chat",type:"connectBegin",callback:t})},E.prototype.setOperatorGroup=function(t){this.__SPI_lockToOperatorGroup(t.group||t),e.trigger_event({namespace:"chat",type:"operatorGroupChanging"}),this.onReady(function(){hbl.client.eventmgr.register("handled_nrpc_response",function(){e.trigger_event({namespace:"chat",type:"operatorGroupChanged"}),hbl.client.eventmgr.unregister_all("handled_nrpc_response")}),hbl.client.sendcommand("return_long_poll_now","")})},E.prototype.__SPI_onOperatorGroupChanging=function(t){e.listen_for_event({namespace:"chat",type:"operatorGroupChanging",callback:t})},E.prototype.__SPI_onOperatorGroupChanged=function(t){e.listen_for_event({namespace:"chat",type:"operatorGroupChanged",callback:t})},E.prototype.__SPI_lockToOperatorGroup=function(e){olark._.cookieManager.setAllowingNullAndUndefinedAndEmptyString("_okgid",e),this.__session_connection.lockToGroupForThisPage(e)},E.prototype.__SPI_lockToExistingOperatorGroupIfGiven=function(e){var t=olark._.cookieManager.getAllowingNullAndUndefinedAndEmptyString("_okgid");this.__session_connection.lockToGroupForThisPage(t||null===t?t:e)},E.prototype.__SPI_unlockFromCurrentGroup=function(){olark._.cookieManager.erase("_okgid"),this.__session_connection.unlockFromGroupForThisPage()},E.prototype.onReady=function(e){this.__wait_for_chat_to_connect(e)},E.prototype.whenDataReady=function(t){x?t():e.listen_for_event({namespace:"chat",type:"dataReady",callback:t})},E.prototype.connect=function(){var e=this;e.__SPI_connectToRpcServers()},E.prototype.__SPI_onConnectFailure=function(t){e.listen_for_event({namespace:"chat",type:"connectFailure",callback:t})},E.prototype.__wait_for_chat_to_connect=function(t){if(y)t();else{var n=e.create_idempotent_callback(t);e.listen_for_event({namespace:"chat",type:"onReady",callback:n})}},E.prototype.__SPI_visitorIsAvailable=function(){var e=this,t=e.__last_presence.get();return"chat"==t},E.prototype.__SPI_visitorIsBusy=function(){var e=this,t=e.__last_presence.get();return"dnd"==t},E.prototype.__SPI_visitorIsAway=function(){var e=this,t=e.__last_presence.get();return"away"==t},E.prototype.__SPI_isConversing=function(){var e=this;return e.__is_conversing.get()===!0?!0:!1},E.prototype.__SPI_beginConversation=function(t){var n=this;n.__is_conversing.get()!==!0&&(n.__is_conversing.set(!0),e.trigger_event({namespace:"chat",type:"beginConversation",__spi_message_type:t}))},E.prototype.__SPI_onConversationBegin=function(t){e.listen_for_event({namespace:"chat",type:"beginConversation",callback:t})},E.prototype.__SPI_endConversation=function(){var e=this;e.__is_conversing.set(!1)},E.prototype.__SPI_onConversationEnd=function(t){e.listen_for_event({namespace:"chat",type:"endConversation",callback:t})},E.prototype.__SPI_onEndedStateChanged=function(t){var n=this;e.listen_for_event({namespace:"chat",type:"endedStateChange",callback:function(){n.__SPI_getEndedState(t)}})},E.prototype.__SPI_getEndedState=function(e){e({is_ended:this.__is_ended.get(),next_conversation_id:this.__next_conversation_id.get(),is_conversing:this.__SPI_isConversing()})},E.prototype.onBeginConversation=function(t){e.listen_for_event({namespace:"chat",type:"beginConversation",callback:t})},E.prototype.__initialize_conversation_tracking=function(){var e=this;e.onMessageToOperator(function(t){t.message.__SPI_notification!==!0&&e.__SPI_beginConversation("visitor_msg")}),e.onMessageToVisitor(function(t){t.message.__SPI_notification!==!0&&e.__SPI_beginConversation("operator_msg")})},E.prototype.__SPI_getConversationUUID=function(){return olark._.identityManager.getConversationId()},E.prototype.__SPI_getVisitorUUID=function(){return olark._.identityManager.getVisitorId()},E.prototype.__SPI_getLegacyConfig=function(){return e.run_legacy_code(function(e){return e.hbl.config})},E.prototype.__SPI_queryCurrentGroup=function(e){e({group:this.__session_connection.getGroupForThisPage()})},E.prototype.__SPI_disableEventConnection=function(){C=!0},E.prototype.__SPI_enableEventConnection=function(){C=!1},E.prototype.__SPI_getLegacySiteId=function(){return olark._.identityManager.getSiteId()},E.prototype.__SPI_sendRawMessageToVisitor=function(t){var n=this,i=t.body,a=t.nickname,o=[a,i,n.__get_next_message_sequence_id_that_is_server_safe()];e.run_legacy_code(function(e){e.hbl.client.incoming_pipeline.run(o)})},E.prototype.__SPI_sendRawMessageToOperator=function(e){var t=this,n=e.body;t.__send_and_deliver_message_from_visitor({legacy_message_tuple:[null,n,0]})},E.prototype.__handleHighTrafficConfiguration=function(e){var t=this;if(t.__is_connection_upgraded.get()!==!0&&e.system&&e.system.forced_polling_in_seconds_when_online_but_not_chatting){var n=e.system.forced_polling_in_seconds_when_online_but_not_chatting,i=hbl.client.pollingmanager.getMinAvailablePollTime();hbl.client.pollingmanager.setMinAvailablePollTime(1e3*n);var a=function(){t.__is_connection_upgraded.get()||(t.__is_connection_upgraded.set(!0),hbl.client.pollingmanager.setMinAvailablePollTime(i),hbl.client.pollingmanager.startNextPollNow())};hbl.eventmgr.register("habla_window_changed",function(e){"expand"===e.type&&a()}),olark("api.box.onExpand",a)}},E.prototype.__SPI_connectToRpcServers=function(e){e=e||{};var n=this,i=n.__conf;if(w!==!0)if(w=!0,n.__hasconnected.set(!0),olark._.P("getconnection"),n.onReady(function(){olark._.P("connection")}),C);else{window.hblJavaScriptVersion="api-1.2.1",window.hbl_hostname=i.system.legacy_rpc_server||window.hbl_hostname||"olark.com/rpc",window.hbl.config=window.wc_config();var a=window.hbl.config;a.vars.no_system_messages=!0,a.vars.disable_rpc_state=!0,"chatting"==i.system.show_in_buddy_list&&"undefined"==typeof i.system.forced_polling_in_seconds_when_online_but_not_chatting&&(i.system.forced_polling_in_seconds_when_online_but_not_chatting=300),n.__handleHighTrafficConfiguration(i),i.system.path&&(a.vars.cookie_path=i.system.path,a.vars.hbl_cookie_path=i.system.path),i.system.disable_offline_messaging_fallback&&olark._.hlog("used #disable_offline_messaging_fallback flag");for(var o in i.system)"function"!=typeof i.system[o]&&(a.vars[o]=i.system[o]);for(var r in i.box)"function"!=typeof i.box[r]&&(a.vars[r]=i.box[r]);if(/AppleWebKit/.test(navigator.appVersion))for(var s=document.getElementsByTagName("object"),l=0;l<s.length;l++){var _=s[l].data||"";if(/\.swf/.test(_)){a.vars.disable_expand_text_input=!0;break}}var c=function(e,t){return"undefined"==typeof e?t:e};a.vars.top_margin=c(i.box.vertical_offset,a.vars.top_margin),a.vars.bottom_margin=c(i.box.vertical_offset,a.vars.bottom_margin),a.vars.right_margin=c(i.box.horizontal_offset,a.vars.right_margin),a.vars.left_margin=c(i.box.horizontal_offset,a.vars.left_margin);var h=function(e,t){a.vars[e]=t||i.system[e]};if(h("before_chat_text",i.locale.welcome_title||i.box.welcome_title),h("in_chat_text",i.locale.chatting_title),h("not_available_text",i.locale.unavailable_title||i.box.unavailable_title),h("busy_text",i.locale.busy_title),h("away_text",i.locale.unavailable_title),h("offline_message",i.locale.away_message),h("welcome_msg",i.locale.welcome_message||i.box.welcome_message),h("busy_message",i.locale.busy_message),h("say_text",i.locale.chat_input_text),h("habla_name_input_text",i.locale.name_input_text||i.system.field_text_for_name),h("habla_offline_email_text",i.locale.email_input_text||i.system.field_text_for_email),h("habla_offline_phone_text",i.locale.phone_input_text),h("habla_offline_body_text",i.locale.offline_note_message||i.system.field_for_offline_message_body||i.system.information_text_when_offline),h("habla_offline_submit_value",i.locale.send_button_text||i.system.button_text_for_send),h("habla_offline_sent_text",i.locale.offline_note_thankyou_text||i.system.offline_message_thankyou_text),h("email_body_error_text",i.locale.offline_note_error_text||i.system.offline_message_validation_error_text),h("sending_text",i.locale.offline_note_sending_text||i.system.offline_message_sending_text),h("operator_is_typing_text",i.locale.operator_is_typing_text),h("operator_has_stopped_typing_text",i.locale.operator_has_stopped_typing_text),h("pre_chat_error_text",i.locale.introduction_error_text),h("pre_chat_message",i.locale.introduction_messages),h("pre_chat_submit",i.locale.introduction_submit_button_text),h("check_for_status",i.locale.loading_title),h("send_text",i.locale.send_button_text),i.system.always_create_new_session&&(a.vars.disable_set_cookies=!0,a.vars.disable_get_cookies=!0),a.vars.start_passive&&t.warn("[olark] start_passive mode is not enabled in the new Javascript"),a.vars.max_milliseconds_conversation_can_be_idle=a.vars.max_milliseconds_conversation_can_be_idle||olark._.maxMillisecondsConversationCanBeIdle,i.box.inline){a.setInline(1),a.vars.start_expanded="undefined"==typeof i.box.start_expanded?1:i.box.start_expanded,a.vars.enable_buttons=!1;var d=document.getElementById("olark-box-container");d&&(d.id="habla_window_div")}var u=function(){function t(e,t){i.locale[e]=i.locale[e]||t}var o=function(){var e=olark._.identityManager.getSiteId(),t=olark._.cookieManager.get("_ok"),a=n.__SPI_isConversing(),o=i.system.high_priority_site?!0:!1;t?t!=e&&(a&&!o||(window.hbl.config.vars.disable_get_cookies=!0,olark._.cookieManager.set("_ok",e))):olark._.cookieManager.set("_ok",e)},r=e.__legacy_site_id||n.__conf.system.olark_key;window.hblHasinit=1,window.hbl.post_started=void 0,r&&olark._.identityManager.setSiteId(r),window.hbl.config=window.hbl.config||window.wc_config();var s=["expand_on_receive_message"];i.Notify&&s.push("incoming_notification"),(i.StatusElements||i.CalloutBubble)&&s.push("away_div_handler"),o(),window.wc_init_post(s),t("ended_chat_message",a.vars.ended_chat_message)};n.__conf.system.disable_visitor_composing&&(olark.__legacy_shim.disableComposing=!0),v||y?n.__wait_for_chat_to_connect(function(){n.__SPI_disconnect(),u()}):u()}},E.prototype.__get_message_history=function(){var e=this;return e.__data_history.get()||e.__conversation_message_history},E.prototype.__SPI_setMessageHistory=function(t){var n=this;n.__conversation_message_history=t,e.run_legacy_code(function(e){0===e.hbl.client.buffer.length&&(e.hbl.client.buffer=[[null,"",.2]])}),n.__data_history.set(t)},E.prototype.__SPI_disableChatConnection=function(){hbl.util.append_script=function(){},hbl.client.jsonproxy.prototype.do_nrpc_call=function(){}},E.prototype.__SPI_disconnect=function(){var t=this;t.__session_connection.disconnect(),t.__SPI_setMessageHistory([]),window.hblHasinit=void 0,window.hbl.client.messageq=[],window.hbl.client.jsonthrottle_locked=!1,olark._.identityManager.deleteConversationId(),window.hbl.client.pollingmanager.stop(),window.hbl.client.pollingmanager.reset(),window.hbl.config=window.wc_config(),window.hbl.config.merge({vars:{habla_sizebutton_text_expanded:"_",habla_sizebutton_text_compressed:"^",habla_closebutton_text:"x",habla_popout_text:">",habla_end_popout_text:"&lt;&lt;",corner_position:"BR",bottom_margin:10,right_margin:10,left_margin:10,top_margin:10}}),window.hbl.config.vars.poll=!0,window.habla_window.config=hbl.config,window.habla_window.theme.config=hbl.config,v=!1,y=!1,e.trigger_event({namespace:"chat",type:"disconnect"})},E.prototype.__SPI_getVisitorGeolocation=function(){return P.geolocation||null},E.prototype.__SPI_getVisitorIP=function(){return P.browser_ip||null},E.prototype.__SPI_isPremiumUser=function(){return hbl.client.ssl?!0:!1},E.prototype.__SPI_hasConnectedAlready=function(){var e=this;return e.__hasconnected.get()?!0:!1},E.prototype.__SPI_getLastOperatorPresence=function(e){var t=this;t.whenDataReady(function(){var n=t.__last_op_presence.get();e(n)})},E.prototype.__send_and_deliver_message_from_visitor=function(e){var t=this,n=e.legacy_message_tuple;if("undefined"==typeof n)throw new Error("'legacy_message_tuple' required");n[2]=n[2]||t.__get_next_message_sequence_id_that_is_server_safe();var i=new M({legacy_message_tuple:n,send_event_type:"messageFromVisitor",deliver_event_type:"deliveryOfMessageFromVisitor",final_delivery_action:function(){t.__session_connection.send_message({body:i.get_processed_body()})}});i.send(),i.deliver()},E.prototype.__send_and_deliver_message_from_operator=function(t){var n=this,i=t.legacy_message_tuple,a=t.is_automated,o=i&&i[1]&&/^\s*$/.test(i[1])?!0:!1;if("undefined"==typeof i)throw new Error("'legacy_message_tuple' required");if("undefined"==typeof a)throw new Error("'is_automated' required");if(!o){i[2]=i[2]||n.__get_next_message_sequence_id_that_is_server_safe();var r=new M({legacy_message_tuple:i,is_automated:a,__SPI_notification:t.__SPI_notification,send_event_type:"messageFromOperator",deliver_event_type:"deliveryOfMessageFromOperator",final_delivery_action:function(){e.run_legacy_code(function(e){var t=[i[0],r.get_processed_body(),i[2]];e.hbl.client.append([t])})}});r.send(),r.deliver()}},E.prototype.__determine_presence_from_nrpc_event=function(e){var t=e.opavailable?!0:!1,n=null;if(t)switch(e.status){case"available":case"chat":n="available";break;case"busy":case"dnd":case"offline":case"away":case"xa":n="away";break;default:n="away"}else n="away";return n},E.prototype.__initialize_legacy_connection_and_messaging_handlers=function(){var t=this;if(!I){k=t.__last_op_presence.get()||"away",I=!0,hbl.eventmgr.register("chat_started",function(t){v=!0,e.trigger_event({namespace:"chat",type:"connectBegin"}),P={browser_ip:t.browser_ip,geolocation:t.geolocation}},0),hbl.eventmgr.register("resend_nickname",function(){t.__session_connection.__mark_nickname_update_pending(!0)},0),hbl.eventmgr.register("resend_status",function(){t.__session_connection.__mark_status_update_pending(!0)},0),hbl.eventmgr.register("offlineMessageToOperator",function(t){e.trigger_event({namespace:"chat",type:"offlineMessageToOperator",message:t})});var n=t.__is_ended.get();hbl.eventmgr.register("conversation_ended",function(i){n||(n=!0,t.__is_ended.set(!0),t.__next_conversation_id.set(i.next_conversation_id),e.trigger_event({namespace:"chat",type:"endedStateChange"}))},0),hbl.eventmgr.register("operator_composing",function(e){function n(e){this.composingMessage&&i();var t=document.createElement("p");t.className="habla_conversation_p_item hbl_pal_main_fg",t.innerHTML='<span class="olark-composing-message habla_conversation_person2 hbl_pal_local_fg">'+e+"</span>",t.children&&(t.children[0].style.color="rgb(200,200,200)",this.composingMessage=t,a.appendChild(this.composingMessage)),a.scrollTop=a.scrollHeight}function i(){if(this.composingMessage){clearTimeout(this.composingMessageRemovalTimeout);var e=this.composingMessage.parentNode||this.composingMessage.parent;e&&e.removeChild(this.composingMessage),this.composingMessage=!1}}var a=document.getElementById("habla_conversation_div");this.composingMessage=this.composingMessage||!1,(this.composingMessageRemovalHandlerSet?1:0)||(t.__SPI_onDeliveryOfMessageFromOperator(function(){i()}),this.composingMessageRemovalHandlerSet=!0),t.__SPI_onEndedStateChanged(function(e){e.is_ended&&i()});var o=hbl.config.vars.local_name_override||e.operator_nickname||"operator",r={active:function(){i()},composing:function(){n(o+" "+hbl.config.vars.operator_is_typing_text)},paused:function(){n(o+" "+hbl.config.vars.operator_has_stopped_typing_text),this.composingMessageRemovalTimeout=setTimeout(i,3e4)}};r.hasOwnProperty(e.composing_type)&&(clearTimeout(this.composingMessageRemovalTimeout),r[e.composing_type]())}),hbl.eventmgr.register("nrpc_data_ready",function(n){var i=t.__determine_presence_from_nrpc_event(n);t.__last_op_presence.set(i),x=!0,e.trigger_event({namespace:"chat",type:"dataReady"})}),hbl.eventmgr.register("operator_status_change",function(n){var i=t.__determine_presence_from_nrpc_event(n);switch(i){case"available":e.trigger_event({namespace:"chat",type:"operatorsAvailable",previously:k});break;case"away":e.trigger_event({namespace:"chat",type:"operatorsAway",previously:k})}k=i,t.__last_op_presence.set(k),y||(v=!1,y=!0,e.trigger_event({namespace:"chat",type:"onReady",after:function(){e.trigger_event({namespace:"SessionConnection",type:"afterReady"})}}))},r),t.__wait_for_chat_to_connect(function(){e.run_legacy_code(function(){window.habla_window.send_pipeline.add(function(e){return void t.__send_and_deliver_message_from_visitor({legacy_message_tuple:[null,e,null]})},o)})}),window.olark.__legacy_shim.pipeline_disabler=function(){return void 0},t.__wait_for_chat_to_connect(function(){window.hbl.client.incoming_pipeline.add(function(n){var i=n[0],o=n[1],r=parseFloat(n[2]||-1),s=t.__last_cmd_seq_id.get(),l=a.exec(o);if(l)if(parseFloat(s)!=s&&(olark._.hlog("resetting last_command_index to 0, found a string instead #reset_string_command_index #warn"),s=0,t.__last_cmd_seq_id.set(s)),r>s){t.__last_cmd_seq_id.set(r);var _=l[1],c=l[2];c&&0===c.length&&(c=null),e.trigger_event({namespace:"chat",type:"commandFromOperator",nickname:i,name:_,body:c})}else olark._.hlog("dropping command",l[1],"due to sequence ID mismatch",r,"<=",s,"#warn #dropped_command");else t.__send_and_deliver_message_from_operator({legacy_message_tuple:n,is_automated:!1});return n},o)})}},E.prototype.__SPI_getMessageHistory=function(e){var t=this.__get_message_history();return e&&e(t),t},E.prototype.__SPI_populatedLocalChatHistoryFromRpcServer=function(){var e=this;return!e.__has_local_history},E.prototype.__SPI_onPrechatInfoReceived=function(t){e.listen_for_event({namespace:"chat",type:"prechatInfoReceived",callback:t})},E.prototype.__initialize_legacy_history_tracking=function(){var i=this;if(!S){S=!0;var o=function(e){var o=parseFloat(i.__last_leg_seq_id.get());if(e.__legacy_sequence_id||(e.__legacy_sequence_id=i.__get_next_message_sequence_id_that_is_server_safe()),o<e.__legacy_sequence_id){i.__last_leg_seq_id.set(e.__legacy_sequence_id);var r=i.__get_message_history();n(r)||(t.error("[olark] expected message_history to be a list:",r),r=[]),a.test(e.message.body)||r.push({nickname:e.message.nickname,body:e.message.body});var s=function(){r=r.slice(1,r.length),t.warn("[olark] trying to shrink message history, now has",r.length,"entries"),r.length>0?i.__SPI_setMessageHistory(r,s):i.__SPI_setMessageHistory([])};i.__SPI_setMessageHistory(r,s)}};i.__SPI_onDeliveryOfMessageFromOperator(o),i.__SPI_onDeliveryOfMessageFromVisitor(o),hbl.eventmgr.register("chat_loaded",e.create_idempotent_callback(function(){e.trigger_event({namespace:"chat",type:"legacyChatLoaded"})}));window.olark.__legacy_shim.load_missed_messages=e.create_idempotent_callback(function(e){i.__has_local_history=0!==e.length&&i.__last_leg_seq_id.get();for(var t=0;t<e.length;){var n=e[t],r=n[0],s=n[1],l=n[2],_=i.__last_leg_seq_id.get(),c=a.test(n[1]);c||(i.__has_local_history?l>_&&i.__send_and_deliver_message_from_operator({legacy_message_tuple:n,is_automated:!1}):o({__legacy_sequence_id:parseFloat(l),message:{nickname:r,body:s}})),t++}});var r=i.__SPI_getMessageHistory();window.olark.__legacy_shim.has_messages_in_history=r&&r.length>0?!0:!1}},olark.declare({name:"__ChatApiHelper",startup:function(t,n){function i(){setTimeout(function(){try{var e=window.hbl.client.buffer.length>0,t=habla_window.getHeader()==n.system.before_chat_text;e&&t&&habla_window.setHeader(n.system.in_chat_text)}catch(i){}},900)}var a=!1;window.olark.__legacy_shim.send_prechat_info=function(n){if(!a){a=!0;var i="";n.name&&n.name.length&&"undefined"!=n.name&&(t.visitor.addFullName(n.name),i+="\n    name: "+n.name),n.email&&n.email.length&&"undefined"!=n.email&&(t.visitor.addEmailAddress(n.email),i+="\n    email: "+n.email),n.phone&&n.phone.length&&"undefined"!=n.phone&&(t.visitor.updatePhoneNumber(n.phone),i+="\n    phone: "+n.phone),i||(i="Prechat survey left blank."),t.chat.sendNotificationToOperator({body:i}),e.trigger_event({namespace:"chat",type:"prechatInfoReceived"})}},t.chat.onMessageToVisitor(i),t.chat.onMessageToOperator(i);var o=t.data.getConversationObject({key:"lock",initialValue:!1}),r=null,s=null,l=t.data.getConversationObject({key:"isFirstBusyCommand",initialValue:!0}),_=function(){r||(r=setInterval(function(){h()},1e3*p),s=setInterval(function(){t.chat.sendNotificationToOperator({body:"this visitor is still locked into chat, to unlock this visitor type !unlock"})},1e3*f))},c=function(){r&&(clearInterval(r),clearInterval(s),r=null,s=null)},h=function(){e.run_legacy_code(function(e){e.hbl.client.sendcommand("return_long_poll_now","")})};t.chat.onReady(function(){o.get()===!0?_():c()}),t.chat.onCommandFromOperator(function(i){switch(i.command.name){case"lock":o.set(!0),t.chat.sendNotificationToOperator({body:"visitor has been locked into this chat, to unlock this visitor type !unlock"}),_();break;case"unlock":o.set(!1),t.chat.sendNotificationToOperator({body:"visitor has been unlocked from this chat"}),c();break;case"busy":var a=n.locale.operator_busy_message_update||"Just checking in - I'm still busy chatting with {{ active_conversation_count }} other customers. I'll be with you as soon as I can.";l.get()&&(a=n.locale.operator_busy_message||"Sorry, I'm currently a bit busy at the moment with {{ active_conversation_count }} other customers. I'll be with you as soon as I can.",t.chat.sendNotificationToOperator({body:"Visitor has been queued. Simply send a message to start chatting and remove them from the queue."}),l.set(!1));var r=parseInt(i.command.body);t.chat.sendNotificationToVisitor({body:a.replace(/\{\{\s*active_conversation_count\s*\}\}/g,r)}),e.trigger_event({namespace:"chat",type:"operatorIsBusy"})}}),t.chat.onCommandFromOperator(function(i){switch(i.command.name){case"transfer":t.chat.__SPI_unlockFromCurrentGroup();break;case"name":var a=i.command.body;t.visitor.updateFullName({fullName:a}),t.chat.sendNotificationToOperator({body:"remembering visitor name as "+a});break;case"email":var o=i.command.body;t.visitor.updateEmailAddress({emailAddress:o}),t.chat.sendNotificationToOperator({body:"remembering visitor email as "+o});break;case"phone":var r=i.command.body;t.visitor.updatePhoneNumber({phoneNumber:r}),t.chat.sendNotificationToOperator({body:"remembering visitor phone number as "+r});break;case"end":olark("api.visitor.getDetails",function(i){var a=i.messageCountForThisVisit>0;a&&(t.chat.sendNotificationToVisitor({body:n.locale.ended_chat_message}),e.trigger_event({namespace:"chat",type:"endConversation"}))})}}),t.chat.onCommandFromOperator(function(e){"help"==e.command.name&&t.chat.sendNotificationToOperator({body:["quick reference for the commands you can type at any time...","\n!tag","     tag this conversation, like '!tag followup' or '!tag important'","\n!transfer","     transfer this visitor to another operator.  Optionally give a note, like '!transfer This guy needs help with billing'","\n!unfollow","     stop receiving page-change notifications for this visitor","\n!push","     push this visitor to a URL, like '!push www.google.com'","\n!block","     block this visitor","For more commands, check out http://www.olark.com/help/olark-commands",""].join("\n")})}),t.box.onDismiss(function(){t.chat.__SPI_endConversation()
}),t.chat.onBeginConversation(function(){t.chat.__SPI_lockToOperatorGroup(n.system.group||n.system.olark_group||null)}),t.chat.__SPI_lockToExistingOperatorGroupIfGiven(n.system.group||n.system.olark_group||null),n.system.forced_rpc_server&&(window.hbl_hostname=n.system.forced_rpc_server,window.hblrpcTrick=0)}}),olark.extend("__ChatApiHelper"),e.chat={ChatApi:E,SessionConnection:T}})}(window.olark.__core,window.olark.__core.logger),function(e){e.wait_for(function(){return!0},function(){var t={},n=function(e){var n=this;if(n.__namespace=e.namespace,"undefined"==typeof n.__namespace)throw new Error("'namespace' required");n.__methods=t[n.__namespace]={}};n.prototype.exportMethods=function(e){var t=this;e(t.__methods)},n.prototype.importMethods=function(n,i){var a=this;if(!e.is_extension_required({extension_name:n}))throw new Error("extension '"+n+"' is required for "+a.__namespace);var o=t[n];if(o)i(o);else{var r=!1;e.listen_for_event({namespace:"Extension",type:"extensionActivated",callback:function(){o=t[n],o&&!r&&(r=!0,i(o))}})}},e.extensions={ExtensionsApi:n}})}(window.olark.__core,window.olark.__core.logger),function(e){e.wait_for(function(){return e.chat},function(){var t={encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var i=e.charCodeAt(n);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},decode:function(e){var t,n,i,a,o="",r=0;for(t=n=i=0;r<e.length;)t=e.charCodeAt(r),128>t?(o+=String.fromCharCode(t),r++):t>191&&224>t?(i=e.charCodeAt(r+1),o+=String.fromCharCode((31&t)<<6|63&i),r+=2):(i=e.charCodeAt(r+1),a=e.charCodeAt(r+2),o+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&a),r+=3);return o}},n=!1,i=function(t){var i=this;if(i.__namespace=t.namespace,i.__conf=t.conf,"undefined"==typeof i.__namespace)throw new Error("'namespace' required");i.__session_connection=e.chat.SessionConnection.get_instance();var a=function(){var t=i.__session_connection.get_local_data({key:"BrowserApi::last_page_visited"}),n=olark._.overrideWindowHref||document.location.href.toString();t!==n&&(e.trigger_event({namespace:"BrowserApi",type:"locationChange",previousUrl:t,currentUrl:n}),i.__session_connection.put_local_data({key:"BrowserApi::last_page_visited",value:n}))};if(!n){if(n=!0,e.after_extensions_are_activated(a),i.__conf.system.hashchange_events_trigger_page_change)try{e.listen_for_browser_event(window,"hashchange",a)}catch(o){}var r=window.history&&window.history.pushState;if(i.__conf.system.history_events_trigger_page_change!==!1&&r)try{var s=window.history.pushState;window.history.pushState=function(){s.apply(window.history,arguments),e.trigger_event({namespace:"BrowserApi",type:"pushstateChanged"})};var l=window.history.replaceState;window.history.replaceState=function(){l.apply(window.history,arguments),e.trigger_event({namespace:"BrowserApi",type:"pushstateChanged"})},e.listen_for_event({namespace:"BrowserApi",type:"pushstateChanged",callback:a}),e.listen_for_browser_event(window.history,"popstate",a)}catch(o){}}};i.prototype.onPageChange=function(t){e.listen_for_event({namespace:"BrowserApi",type:"locationChange",callback:function(e){t({newPage:e.currentUrl,oldPage:e.previousUrl})}})},i.prototype.__SPI_getSafeUrl=function(e){return/webkit/.test(navigator.userAgent.toString().toLowerCase())&&(e=t.decode(unescape(e))),e.replace(/ /g,"%20")},e.browser={BrowserApi:i}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.data},function(){function n(e){e=e||function(){};var t="olark_"+Math.random().toString().replace(".","");return window[t]=function(n){e(n),window[t]=void 0;try{delete window[t]}catch(i){}},t}function i(e){try{for(var t,n=/(q|p|query|queryTerms?)\=([^&\#]+)/i.exec(e)[2],i=decodeURIComponent(n).replace(/\+/g," "),a=/(?:\((.+?)\)|"(.+?)"|'(.+?)'|([^\s]+))/g,o=[];t=a.exec(i);)o.push(t[2]||t[3]||t[4]);return{text:/^\s*$/.test(i)?null:i,terms:o}}catch(r){return{text:null,terms:[]}}}function a(e){try{for(var t,n=/(?:utm_(\w+))\=([^&\#]+)/gi,i={};t=n.exec(e);)try{var a=t[1],o=t[2];i[a]=decodeURIComponent(o).replace(/\+/g," ")}catch(r){}return i}catch(r){return{}}}var o=9e3,r=10,s=1e4,l=7,_=!1,c=function(t){function n(){a.__SPI_bumpVisitHistoryTimestamp(),setTimeout(n,o)}function i(){var e=a.__visitHistory.get(),t=e[e.length-1]||{};t.messageCount=t.messageCount||0,t.messageCount++,a.__visitHistory.set(e)}var a=this;if(a.__namespace=t.namespace,"undefined"==typeof a.__namespace)throw new Error("'namespace' required");var s=t.data,l=t.browser;if(a.__fullNameObject=s.getVisitorObject({key:"visFullName",initialValue:null,__SPI_forceNamespace:"__api"}),a.__emailAddressObject=s.getVisitorObject({key:"visEmailAddress",initialValue:null,__SPI_forceNamespace:"__api"}),a.__phoneNumberObject=s.getVisitorObject({key:"visPhoneNumber",initialValue:null,__SPI_forceNamespace:"__api"}),a.__recentPageHistory=s.getVisitorObject({key:"rph",initialValue:[],__SPI_forceNamespace:"__vis"}),a.__visitHistory=s.getVisitorObject({key:"vh",initialValue:[],__SPI_forceNamespace:"__vis"}),a.__isNewVisit=s.getConversationObject({key:"inv",initialValue:!0,__SPI_forceNamespace:"__vis"}),a.__importance=s.getVisitorObject({key:"imp",initialValue:0,__SPI_forceNamespace:"__vis"}),a.__notes=s.getVisitorObject({key:"nts",initialValue:[],__SPI_forceNamespace:"__vis"}),a.__mostRecentMessage=s.getConversationObject({key:"mrcm",initialValue:void 0,__SPI_forceNamespace:"__vis"}),a.__mostRecentNotificationToOperator=s.getConversationObject({key:"mrno",initialValue:void 0,__SPI_forceNamespace:"__vis"}),a.__mostRecentMessageToOperator=s.getConversationObject({key:"mrcmo",initialValue:void 0,__SPI_forceNamespace:"__vis"}),a.__mostRecentMessageToVisitor=s.getConversationObject({key:"mrcmv",initialValue:void 0,__SPI_forceNamespace:"__vis"}),a.__visitFields=s.getConversationObject({key:"vf",initialValue:{},__SPI_forceNamespace:"__vis"}),a.__didSyncName=s.getConversationObject({key:"dsn",initialValue:!1,__SPI_forceNamespace:"__vis"}),a.__didSyncEmail=s.getConversationObject({key:"dse",initialValue:!1,__SPI_forceNamespace:"__vis"}),a.__didSyncPhone=s.getConversationObject({key:"dsp",initialValue:!1,__SPI_forceNamespace:"__vis"}),a.__conversationBeginPage=s.getConversationObject({key:"cbp",initialValue:void 0,__SPI_forceNamespace:"__vis"}),a.__visitEventSent=s.getConversationObject({key:"ves",initialValue:!1,__SPI_forceNamespace:"__vis"}),a.__landedOnPageTimestamp=+new Date,l.onPageChange(function(){a.__landedOnPageTimestamp=+new Date}),!_){_=!0;var c=a.__recentPageHistory.get(),h=function(){var e=c[c.length-1],t=e?e.url:null;(0===c.length||document.location.href!==t)&&(c.push({title:document.title.length?document.title:null,url:document.location.href,timestamp:+new Date}),c.length>r&&(c=c.slice(c.length-r)),a.__recentPageHistory.set(c))};h(),l.onPageChange(h),a.__visitEventSent.set(!0);var d=e.xdhttp.post("/2.0/sites/"+olark._.siteId+"/visits");d.send({conversation_id:olark._.conversationId}),d.end(function(e){e&&a.__visitEventSent.set(!1)});var u,p=0===a.__visitHistory.get().length,f=a.__isNewVisit.get();(f||p)&&(f||olark._.hlog("got #empty_history, treating as new visit for visit history"),a.__isNewVisit.set(!1),u=a.__visitHistory.get(),u.push({didChat:!1,pageCount:0,messageCount:0,referrer:document.referrer.toString(),createdAt:+new Date,updatedAt:+new Date}),a.__visitHistory.set(u)),n(),u=a.__visitHistory.get(),u=a.__updateMostRecentTimestampOnHistory(u),u[u.length-1].pageCount+=1,a.__visitHistory.set(u),olark("api.chat.onBeginConversation",function(){var e=a.__visitHistory.get(),t=e[e.length-1];t&&t.didChat!==!0&&(t.didChat=!0,a.__visitHistory.set(e),a.__conversationBeginPage.set(document.location.href))}),olark("api.chat.onMessageToOperator",function(){a.__mostRecentMessage.set(+new Date),a.__mostRecentMessageToOperator.set(+new Date),i()}),olark("api.chat.onMessageToVisitor",function(){a.__mostRecentMessage.set(+new Date),a.__mostRecentMessageToVisitor.set(+new Date),i()}),olark("api.chat.onNotificationToOperator",function(){a.__mostRecentNotificationToOperator.set(+new Date)}),a.__SPI_prepopulateEmailFields(),a.__SPI_prepopulateFullNameFields(),a.__SPI_prepopulatePhoneNumberFields(),a.__SPI_prepopulateChatNicknameFromBestVisitorInformation(),this.__emailAddressObject.__SPI_onChange(function(){a.__SPI_prepopulateEmailFields(),a.__SPI_prepopulateChatNicknameFromBestVisitorInformation(),a.__didSyncEmail.set(!1),a.__ensureVisitorDataSynced({emailAddress:!0})}),this.__fullNameObject.__SPI_onChange(function(){a.__SPI_prepopulateFullNameFields(),a.__SPI_prepopulateChatNicknameFromBestVisitorInformation(),a.__didSyncName.set(!1),a.__ensureVisitorDataSynced({fullName:!0})}),this.__phoneNumberObject.__SPI_onChange(function(){a.__SPI_prepopulatePhoneNumberFields(),a.__didSyncPhone.set(!1),a.__ensureVisitorDataSynced({phoneNumber:!0})}),a.__ensureVisitorDataSynced({fullName:!0,emailAddress:!0,phoneNumber:!0})}};!function(o){function r(e,t){var n=olark;return c?t&&t(c[e]):n("api.chat.whenDataReady",function(){c=olark._.geoip,t&&t((c||{})[e])}),(c||{})[e]}function _(e,t){var n=t();return e&&e(n),n}var c=null,d=0,u=null;o.__ensureVisitorDataSynced=function(t){var i=this,a=!1;if(!(t.retry&&d>=l)){var o=function(t,i,o,r){if(!i.get()&&t.get()){var s=["site_id="+encodeURIComponent(olark._.identityManager.getSiteId()),"visitor_id="+encodeURIComponent(olark._.identityManager.getVisitorId()),o+"="+encodeURIComponent(t.get()),"cache="+encodeURIComponent(Math.random()),"jsonp="+n(function(e){e.success&&(d=0,i.set(!0))})];a=!0,i.set(!1),e.async_script_load({url:olark._.apiHost+"/1.0/visitor/"+r+"?"+s.join("&")})}};if(t.fullName&&o(i.__fullNameObject,i.__didSyncName,"full_name","addFullName"),t.emailAddress&&o(i.__emailAddressObject,i.__didSyncEmail,"email_address","addEmailAddress"),t.phoneNumber&&o(i.__phoneNumberObject,i.__didSyncPhone,"phone_number","addPhoneNumber"),a){t.retry&&d++,u||(u={},e.do_async_call({delay:s},function(){var e=u;e.retry=!0,u=null,i.__ensureVisitorDataSynced(e)}));for(var r in t)t.hasOwnProperty(r)&&(u[r]=t[r])}}},o.__SPI_getBrowser=function(){var e=h.parse(window.navigator.userAgent);return e.family+" "+e.toVersionString()},o.__SPI_getOs=function(){var e=navigator.platform;return/Mac/.test(e)?"Mac OSX":/Linux/.test(e)?"Linux":/Win/.test(e)?"Windows":void 0},o.__SPI_getIp=function(){return olark._.ipaddress},o.__SPI_getRecentPageHistory=function(){return this.__recentPageHistory.get()||[]},o.__SPI_prepopulateEmailFields=function(){var e=this.__emailAddressObject.get();olark("api.box.__SPI_setThemeTextField","habla_pre_chat_email_input",e),olark("api.box.__SPI_setThemeTextField","habla_offline_email_input",e)},o.__SPI_prepopulateFullNameFields=function(){var e=this.__fullNameObject.get();olark("api.box.__SPI_setThemeTextField","habla_pre_chat_name_input",e),olark("api.box.__SPI_setThemeTextField","habla_name_input",e)},o.__SPI_prepopulatePhoneNumberFields=function(){var e=this.__phoneNumberObject.get();olark("api.box.__SPI_setThemeTextField","habla_pre_chat_phone_input",e),olark("api.box.__SPI_setThemeTextField","habla_offline_phone_input",e)},o.__SPI_prepopulateChatNicknameFromBestVisitorInformation=function(){var e,t=this.__fullNameObject.get(),n=this.__emailAddressObject.get();t&&n?e=t+" ("+n+")":t?e=t:n&&(e=n),e&&olark("api.chat.updateVisitorNickname",{snippet:e,hidesDefault:!0})},o.__SPI_getIsInspecting=function(e){return _(e,function(){return olark._.cookieManager.get("_okinspect")?!0:!1})},o.__SPI_setIsInspecting=function(e){e?olark._.cookieManager.set("_okinspect",e):olark._.cookieManager.erase("_okinspect")},o.__SPI_bumpVisitHistoryTimestamp=function(){var e=this,t=e.__visitHistory.get();t=e.__updateMostRecentTimestampOnHistory(t),e.__visitHistory.set(t)},o.__updateMostRecentTimestampOnHistory=function(e){var t=e[e.length-1];return t&&(t.updatedAt=+new Date),e},o.addEmailAddress=function(e){this.updateEmailAddress(e)},o.updateEmailAddress=function(e){var t=e.emailAddress||e;if("string"!=typeof t)throw new Error("[olark] emailAddress string expected");var n=hbl.util.strip_whitespace(hbl.util.decode_html_entities(t));if(n=n.split(" ")[0],!hbl.util.is_valid_email(n))throw new Error("[olark] invalid email address: '"+n+"'");this.__emailAddressObject.set(n)},o.addFullName=function(e){this.updateFullName(e)},o.updateFullName=function(e){var t=e.fullName||e;if("string"!=typeof t)throw new Error("[olark] fullName string expected");t=hbl.util.strip_whitespace(hbl.util.decode_html_entities(t)),this.__fullNameObject.set(t)},o.updatePhoneNumber=function(e){var t=e.phoneNumber||e;if("string"!=typeof t)throw new Error("[olark] phoneNumber string expected");t=hbl.util.strip_whitespace(hbl.util.decode_html_entities(t)),this.__phoneNumberObject.set(t)},o.getFullName=function(e){var t=this;return _(e,function(){return t.__fullNameObject.get()})},o.getEmailAddress=function(e){var t=this;return _(e,function(){return t.__emailAddressObject.get()})},o.getPhoneNumber=function(e){var t=this;return _(e,function(){return t.__phoneNumberObject.get()})},o.onChange=function(e){this.__fullNameObject.__SPI_onChange(e),this.__emailAddressObject.__SPI_onChange(e),this.__phoneNumberObject.__SPI_onChange(e),this.__visitHistory.__SPI_onChange(e),this.__recentPageHistory.__SPI_onChange(e),this.__importance.__SPI_onChange(e),this.__notes.__SPI_onChange(e)},o.getCity=function(e){return r("city",e)},o.getRegion=function(e){return r("state",e)},o.getCountry=function(e){return r("country",e)},o.getCountryCode=function(e){return r("country_code",e)},o.getOrganization=function(e){var t;return r("isp",function(n){r("organization",function(i){t=n!=i?i:{}.undefinedValue,e&&e(t)})}),t},o.updateImportance=function(e){var t;try{t=parseInt(e.value||e)}catch(n){t=-1}if(0>t||t>3)throw new Error("[olark] visitor importance must be an integer between 0-3");this.__importance.set(t)},o.addNote=function(e){var t=e.body||e,n=this.__notes.get();if("string"!=typeof t)throw new Error("[olark] visitor notes must be strings");for(var i=!1,a=0;a<n.length;a++)if(n[a]==t){i=!0;break}i||(n.push(t),this.__notes.set(n))},o.updateCustomFields=function(t){var i=e.framestorewithjson.json,a=i.encode(this.__visitFields.get()),o=i.encode(t);if(a!=o){this.__visitFields.set(t);var r=["conversation_id="+encodeURIComponent(olark._.identityManager.getConversationId()),"site_id="+encodeURIComponent(olark._.identityManager.getSiteId()),"custom_fields_json="+encodeURIComponent(o),"cache="+encodeURIComponent(Math.random()),"jsonp="+n()];e.async_script_load({url:olark._.apiHost+"/1.0/visitor/updateDetailsForThisVisit?"+r.join("&")})}},o.updateDetailsForThisVisit=function(e){this.updateCustomFields(e)},o.getDetailsForThisVisit=function(e){e(this.__visitFields.get())},o.trackConversion=function(){var t=["conversation_id="+encodeURIComponent(olark._.identityManager.getConversationId()),"site_id="+encodeURIComponent(olark._.identityManager.getSiteId()),"cache="+encodeURIComponent(Math.random()),"jsonp="+n()];e.async_script_load({url:olark._.apiHost+"/1.0/visitor/trackConversion?"+t.join("&")})},o.getDetails=function(e){var n=this,o=null;return n.getCity(function(s){function l(e){return e?(+new Date-e)/1e3:{}.undefinedValue}try{var _=function(){var e=r("domain"),t=n.getOrganization();return/(gov|edu|ibm|microsoft)/i.test(e)||t?e:void 0},c=n.getRegion(),h=n.getCountry(),d=n.getCountryCode(),u=n.getOrganization(),p=_(),f=n.__recentPageHistory.get(),g=n.__visitHistory.get(),b=n.__conversationBeginPage.get();0==g.length&&(g.push({}),olark._.hlog("#history_is_empty in getDetails")),0==f.length&&(f.push({}),olark._.hlog("#page_history_is_empty in getDetails"));var m=g[g.length-1].referrer;m&&m.indexOf(" ")>0&&(m=encodeURI(m));for(var v=0,y=0,w=0,k=0,x=!1,S=!1,I=!1,C=!1,P="",T=[],M=0;M<g.length;M++){var E=M==g.length-1;v+=g[M].pageCount,y+=g[M].messageCount||0,g[M].didChat&&w++,k+=g[M].updatedAt-g[M].createdAt;var A=a(g[M].referrer);A.campaign&&(I=!0,E&&(C=!0));var O=/(cpc|ppc)/i.test(A.medium||""),N=A.term,j=/gclid\=/.test(g[M].referrer);(N||j||O)&&(x=!0,E&&(S=!0));var V=i(g[M].referrer);V.text&&(E?P=V.text:T.push(V.text))}var B;try{B=n.__visitFields.get()}catch(F){B={}}o={recentPageHistory:f,currentPage:f[f.length-1],conversationBeginPage:b,referrer:m,referredByPaidAdvertisingEver:x,referredByPaidAdvertisingThisVisit:S,referredByCampaignEver:I,referredByCampaignThisVisit:C,searchTextForThisVisit:P,searchTextForPreviousVisits:T,pageCountForThisVisit:g[g.length-1].pageCount,pageCountAcrossAllVisits:v,messageCountForThisVisit:g[g.length-1].messageCount||0,messageCountAcrossAllVisits:y,visitCount:g.length,conversationCount:w,isConversing:g[g.length-1].didChat,secondsSpentOnCurrentPage:Math.round((+new Date-n.__landedOnPageTimestamp)/1e3),secondsSpentForThisVisit:Math.round((+new Date-g[g.length-1].createdAt)/1e3),secondsSpentAcrossAllVisits:Math.round(k/1e3),city:s,region:c,country:h,countryCode:d,organization:u,domain:p,fullName:n.getFullName(),emailAddress:n.getEmailAddress(),phoneNumber:n.getPhoneNumber(),importance:n.__importance.get(),notes:n.__notes.get(),browser:n.__SPI_getBrowser(),operatingSystem:n.__SPI_getOs(),ip:n.__SPI_getIp(),secondsSinceLastMessage:l(n.__mostRecentMessage.get()),secondsSinceLastNotificationToOperator:l(n.__mostRecentNotificationToOperator.get()),secondsSinceLastMessageToOperator:l(n.__mostRecentMessageToOperator.get()),secondsSinceLastMessageToVisitor:l(n.__mostRecentMessageToVisitor.get()),customFields:B}}catch(F){t.error("#error - getDetails",F.message),o={}}e&&e(o)}),o},o.__SPI_getNotes=function(e){var t=this;return _(e,function(){return t.__notes.get()})},o.__SPI_getVisitHistory=function(e){var t=this;return _(e,function(){return t.__visitHistory.get()})}}(c.prototype);var h=function(){function e(e){var n,i;for(n=0;n<a.length;n++)if(i=a[n](e))return i;return new t}function t(e){this.family=e||"Other"}var n,i=[{p:"Trident(.*)rv.(\\d+)\\.(\\d+)",f:"Internet Explorer"},{p:"^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",f:"Wii"},{p:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",f:"Firefox ($1)"},{p:"(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",f:"Firefox ($1)"},{p:"(SeaMonkey|Fennec|Camino)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)"},{p:"(Flock)/(\\d+)\\.(\\d+)(b\\d+?)"},{p:"(Fennec)/(\\d+)\\.(\\d+)(pre)"},{p:"(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Netscape"},{p:"(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",f:"Netscape"},{p:"(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Netscape"},{p:"(MyIBrow)/(\\d+)\\.(\\d+)",f:"My Internet Browser"},{p:"(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",f:"MicroB"},{p:"(Opera)/9.80.*Version\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?"},{p:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",f:"Swiftfox"},{p:"(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",f:"Swiftfox"},{p:"(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Konqueror"},{p:"(Jasmine|ANTGalio|Midori|Fresco|Lobo|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Vodafone|NetFront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|Iron|Iris)/(\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(Bolt|Jasmine|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|Vodafone|NetFront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca)/(\\d+)\\.(\\d+)"},{p:"(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(iCab|Lunascape|Opera|Android) (\\d+)\\.(\\d+)"},{p:"(IEMobile) (\\d+)\\.(\\d+)",f:"IE Mobile"},{p:"(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"},{p:"(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",f:"Obigo"},{p:"(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",f:"Maxthon"},{p:"(Maxthon|MyIE2|Uzbl|Shiira)",r:"0"},{p:"(PLAYSTATION) (\\d+)",f:"PlayStation"},{p:"(PlayStation Portable)[^\\d]+(\\d+).(\\d+)"},{p:"(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)"},{p:"(Opera)/(\\d+)\\.(\\d+).*Opera Mobi",f:"Opera Mobile"},{p:"(POLARIS)/(\\d+)\\.(\\d+)",f:"Polaris"},{p:"(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",f:"Bon Echo"},{p:"(iPhone) OS (\\d+)_(\\d+)(?:_(\\d+))?"},{p:"(Avant)",r:"1"},{p:"(Nokia)[EN]?(\\d+)"},{p:"(Black[bB]erry)(\\d+)",f:"Blackberry"},{p:"(OmniWeb)/v(\\d+)\\.(\\d+)"},{p:"(Blazer)/(\\d+)\\.(\\d+)",f:"Palm Blazer"},{p:"(Pre)/(\\d+)\\.(\\d+)",f:"Palm Pre"},{p:"(Links) \\((\\d+)\\.(\\d+)"},{p:"(QtWeb) Internet Browser/(\\d+)\\.(\\d+)"},{p:"(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",f:"Safari"},{p:"(OLPC)/Update(\\d+)\\.(\\d+)"},{p:"(OLPC)/Update()\\.(\\d+)",r:"0"},{p:"(SamsungSGHi560)",f:"Samsung SGHi560"},{p:"^(SonyEricssonK800i)",f:"Sony Ericsson K800i"},{p:"(Teleca Q7)"},{p:"([MS]?IE) (\\d+)\\.(\\d+)",f:"Internet Explorer"}],a=[];for(n=0;n<i.length;n++)!function(e){function n(e){var n,a,s=e.match(i);return s?(n=o?o.replace("$1",s[1]):s[1],a=new t(n),a.major=parseInt(r?r:s[2]),a.minor=s[3]?parseInt(s[3]):null,a.patch=s[4]?parseInt(s[4]):null,a):null}var i=new RegExp(e.p),o=e.f||null,r=e.r||null;a.push(n)}(i[n]);return t.prototype.toVersionString=function(){var e="";return null!=this.major&&(e+=this.major,null!=this.minor&&(e+="."+this.minor,null!=this.patch&&(e+="."+this.patch))),e},t.prototype.toString=function(){var e=this.toVersionString();return e&&(e=" "+e),this.family+e},{parse:e}}();e.visitor={VisitorApi:c}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return e.data},function(){var n=900,i=function(e){var t=this,n=e.data;t.__browserApi=e.browser,t.__didActionForVisitor=n.getVisitorObject({key:"dafv",initialValue:{},__SPI_forceNamespace:"__rul"}),t.__didActionForConversation=n.getConversationObject({key:"dafc",initialValue:{},__SPI_forceNamespace:"__rul"})};!function(e){function i(e,n,i,a){function o(){"undefined"!=typeof a?a.get()||(a.set(!0),i()):t.warn("[olark] cannot execute rule with didAction undefined.")}"undefined"!=typeof a?a.get()||n(o):t.warn("[olark] cannot execute rule with didAction undefined.")}e.defineRule=function(e){function t(){0===d?i(o,r,s,h):u||(u=setTimeout(function(){u=null,i(o,r,s,h)},n))}var a=this,o=e.id,r=(e.description,e.condition),s=e.action,l=e.perVisit,_=e.perVisitor,c=e.perPage,h={get:function(){if(l||_){var e=l?a.__didActionForConversation:a.__didActionForVisitor;return e.get()[o]}return c?h.value:!1},set:function(e){if(l||_){var t=l?a.__didActionForConversation:a.__didActionForVisitor,n=t.get();n[o]=e,t.set(n)}else c&&(h.value=e)}},d=0,u=null;olark("api.boot.onIdentityReady",t),olark("api.visitor.onChange",t),olark("api.chat.onReady",t),olark("api.chat.onOperatorsAway",t),olark("api.chat.onOperatorsBusy",t),olark("api.chat.onOperatorsAvailable",t),a.__browserApi.onPageChange(function(){c&&h.set(!1),t()})}}(i.prototype),e.rules={RulesApi:i}})}(window.olark.__core,window.olark.__core.logger),function(e,t){e.wait_for(function(){return!0},function(){var n=["callback"],i=function(e){for(var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_.!~*'()",i="0123456789ABCDEF",a="",o=0;o<e.length;o++){var r=e.charAt(o);if(" "==r)a+="+";else if(-1!=n.indexOf(r))a+=r;else{var s=r.charCodeAt(0);s>255?(t.error("[olark] unicode character cannot be URL encoded, attempting to substitute plus sign"),a+="+"):(a+="%",a+=i.charAt(s>>4&15),a+=i.charAt(15&s))}}return a},a=function(e){e=e||{}};a.prototype.requestJson=function(e,t){var a=this,o=e.url;if("string"!=typeof o)throw new Error("[olark] string 'url' is required");var r=e.params;if(typeof r!=typeof{})throw new Error("[olark] dictionary 'params' is required");var s=n,l=t,_="cb"+Math.floor(1e6*Math.random());r[s]=_;var c="",h=!0;for(var d in r)if("function"!=typeof r[d]){var u=r[d];h||(c+="&"),c+=d+"="+i(u),h=!1}o=o.replace("http://",""),o=o.replace("https://",""),o+="?"+c,o=("https:"==document.location.protocol?"https://":"http://")+o;var p=document.createElement("script");p.type="text/javascript",p.src=o;var f=document.getElementsByTagName("head")[0]||document.documentElement;window[_]=function(){l.apply(l,arguments),window[_]=void 0;try{delete window[_]}catch(e){}f.removeChild(p)},a.withConnectionCompatibility(function(){f.insertBefore(p,f.firstChild)})},a.prototype.withConnectionCompatibility=function(t){e.run_legacy_code(function(e){e.hbl.client.sendcommand("return_long_poll_now",""),t()})},e.remote={RemoteApi:a}})}(window.olark.__core,window.olark.__core.logger),function(e){e.wait_for(function(){return!0},function(){function t(t){this._path=t.path||"/",this._method=t.method||"GET",this._host=t.host||window.olark._.apiHost,this._data={},this._window=t.window||window,this._loadScript=t.loadScript||function(t){e.async_script_load({url:t})}}var n=e.logger,i={stringify:e.framestorewithjson.json.encode,parse:e.framestorewithjson.decode};t.prototype.send=function(e){this._data=e},t.prototype.end=function(e){var t=this,a="_olark_callback_"+(new Date).getTime();this._window[a]=function(i){t._window[a]=void 0;try{delete t._window[a]}catch(r){}if(i.code<200||i.code>399)return n.warn(["[olark]",i.code,i.body,o].join(" ")),e(i.code);var s={status:i.code,body:i.body};return e(null,s)};var o=[this._host,this._path,"?_method="+encodeURIComponent(this._method),"&_data="+encodeURIComponent(i.stringify(this._data)),"&_callback="+a].join("");this._loadScript(o)},e.xdhttp={post:function(e,n){n=n||{},n.path=e,n.method="POST";var i=new t(n);return i}}})}(window.olark.__core),function(e,t){e.wait_for(function(){return window.olark.__core.box&&window.olark.__core.chat&&window.olark.__core.data&&window.olark.__core.visitor&&window.olark.__core.rules&&window.olark.__core.extensions&&window.olark.__core.browser&&window.olark.__core.remote},function(){var n=function(e){e=e||{};var n=this,i=e.namespace;if("undefined"==typeof i)throw new Error("'namespace' is required");var a=e.conf;if("undefined"==typeof a)throw new Error("'conf' is required");var o=e.extension_name;if("undefined"==typeof o)throw new Error("'extension_name' is required");n.__SPI_browser=new window.olark.__core.browser.BrowserApi({namespace:i,conf:a}),n.__SPI_extensions=new window.olark.__core.extensions.ExtensionsApi({namespace:i}),n.chat=new window.olark.__core.chat.ChatApi({conf:a,extension_name:o}),n.box=new window.olark.__core.box.BoxApi({conf:a,chat_api:n.chat}),n.data=new window.olark.__core.data.DataApi({namespace:i}),n.visitor=new window.olark.__core.visitor.VisitorApi({namespace:i,data:n.data,browser:n.__SPI_browser}),n.rules=new window.olark.__core.rules.RulesApi({data:n.data,browser:n.__SPI_browser}),n.logger=t,n.__SPI_remote=new window.olark.__core.remote.RemoteApi,n.boot={onIdentityReady:function(e){olark._.identityManager.triggerIfIdentityIsReady(e)},onWindowLoad:function(e){e()}}};e.api={ApiInstance:n}})}(window.olark.__core,window.olark.__core.logger),olark("api.boot.onIdentityReady",function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}function t(){var e=document.location.href,t=e.split("#"),n="__olarkpg__="+Math.random(),i=/__olarkpg__=[^&]+/;return i.test(e)?e.replace(i,n):/\?/.test(e)?t[0]+"&"+n+(t[1]||""):t[0]+"?"+n+(t[1]||"")}function n(t){var n=document.createElement("a");return n.style.display="block",n.id="olark-inspector-"+t.id,n.href=t.href||"#",e(n,"click",t.onclick),n.innerHTML=t.content,n}function i(e,t){var n=document.createElement("div");return n.id="olark-inspector-"+e,n.innerHTML=t,n}function a(){olark("api.visitor.__SPI_setIsInspecting",!1),r.style.display="none",r=null}function o(){function o(){s(function(t){l.innerHTML="";for(var n=0;n<t.length;n++)l.appendChild(t[n]);var i=document.createElement("a");i.innerHTML="close",function(e){e.display="block",e.position="absolute",e.top="0px",e.right="0px",e["text-decoration"]="none",e.color="#ccc"}(i.style),i.href="#",e(i,"click",function(){return a(),!1}),l.appendChild(i)})}function s(e){olark("api.visitor.getDetails",function(a){e([i("olark-header","<strong style='color: #aaa'>OLARK INSPECTOR</strong>"),i("olark-page-count",["visitor from <strong>"+a.city+", "+a.region+", "+a.country+"</strong>","viewed <strong>"+a.pageCountForThisVisit+"</strong> pages","in <strong>"+a.secondsSpentForThisVisit+"</strong> seconds,","and has chatted <strong>"+a.conversationCount+"</strong> times in the past,","and <strong>"+(a.isConversing?"is conversing now":"has not conversed")+"</strong>"].join(" ")),n({id:"start-new-visitor",content:"pretend to be a brand-new visitor",href:t(),onclick:function(){olark._.cookieManager.erase("hblid"),olark._.cookieManager.erase("olfsk"),olark._.cookieManager.erase("wcsid"),olark._.cookieManager.erase("_okgid")}}),n({id:"start-new-conversation",content:"pretend this is a new visit to the site",href:t(),onclick:function(){olark._.cookieManager.erase("wcsid"),olark._.cookieManager.erase("_okgid")}}),n({id:"visit-another-page",content:"pretend to change pages",href:t()})])})}if(!r){r=document.createElement("div");var l=document.createElement("ul");!function(e){e.position="relative",e.width="400px",e.margin="0px",e.marginLeft=e.marginRight="auto",e.padding="10px",e.fontFamily="monospace",e.color="black",e.background="white",e.opacity="0.90",e["list-style-type"]="none",e["-moz-box-shadow"]=e["-webkit-box-shadow"]=e["box-shadow"]="0px 2px 25px #999"}(l.style),function(e){e.position="fixed",e.bottom="0px",e.width="98%"}(r.style),r.appendChild(l),document.body.appendChild(r),o(),olark("api.visitor.onChange",o)}}var r=null;olark("api.visitor.__SPI_getIsInspecting",function(e){e?o():olark("api.chat.onCommandFromOperator",function(e){"develop"==e.command.name&&(olark("api.visitor.__SPI_setIsInspecting",!0),o())})})}),olark.declare({name:"GoogleAnalytics",version:"1.1",startup:function(e,t){function n(e,t){O&&window.console&&window.console[e]&&window.console[e](t)}function i(e){return e.replace(/[^\w\)\(\d]/g,"_").replace(/\_[\_]*/,"_")}function a(e){window.console&&window.console.warn&&window.console.warn(e)}function o(e,t){if(n("log",arguments),P){if("send"==e)if("pageview"==t)s([F+"_trackPageview"]);else if("event"==t){var i=[F+"_trackEvent"].concat(Array.prototype.slice.call(arguments,2));s(i)}else n("log","unknown command: "+t)}else{var a=Array.prototype.slice.call(arguments,0),o="";S&&(o=S+"."),a[0]=o+a[0],k.apply(k,a)}}function r(e){if(!k)return void n("error","GA_OBJECT not found");var t=k,i=function(){var i=S;if(t.getByName(i))return void n("debug","trackingId already found, using it");var a=t.getAll();if(!e&&a.length>0){var o=a[0];e=o.get("trackingId")}e?(n("debug","creating tracking ID for prefix "+i),t.create(e,{name:i})):n("error","GA trackingId couldn't be found")};t(i)}function s(e){n("log",e);try{window._gaq.push(e)}catch(t){}}function l(e){window._gaq=window._gaq||[],e&&(s([F+"_setAccount",e]),null!=b&&s([F+"_setAllowLinker",b]),null!=m&&s([F+"_setAllowHash",m]),null!=v&&s([F+"_setDomainName",v]),null!=y&&s(y))}function _(e){if(e._getAccount)return e._getAccount();var t=void 0;for(var n in e)"string"==typeof e[n]&&e[n].match(/UA\-/)&&(t=e[n]);return t}function c(){var e=["_getTracker","ByName"].join(""),t=window._gat&&window._gat[e],i=window.pageTracker,o=!t&&window._gaq,c=u&&!t&&!o&&P;if(d&&(F="olark."),c)g?(!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}(),l(g),s([F+"_trackPageview"])):n("error","Cannot load Google Analytics Tracking without Tracking ID");else if(P)if(d)g?l(g):n("error","Cannot create Custom Google Analytics Tracker without Tracking ID");else if(i){var h=_(window.pageTracker);
"UA-XXXXX-X"!=h&&h&&p?l(h):n("error","Cannot determine Tracking ID for Google Analytics legacy tracker id is: "+h)}else if(t){var f=_(window._gat[e]()),b="UA-XXXXX-X"==f;b&&n("error","Cannot determine Tracking ID for Google Analytics, _gat is loaded")}else if(o){for(var m=!1,v=0;v<window._gaq.length;v++){var y=window._gaq[v];if(y&&"_setAccount"==y[0]){m=y[1];break}}m||n("error","Cannot determine Tracking ID for Google Analytics _gaq")}else a("Olark Google Analytics Integration is unable to detect Google Analytics on this page");else x||r(I),n("log","using new analytics.js api")}function h(){var e=G.get(),t=D.get(),n=H.get(),r=t>n?!0:!1,l="automated"==q.get(),_="";_=r?e+" initiated":l?"Olark Targeted Chat initiated":"Visitor initiated with "+e,T&&(P?(null!=A&&s([F+"_setCustomVar",A,i(i(L)+":(Visitor) Had Conversation"),i(_),N]),null!=M&&s([F+"_setCustomVar",M,i(i(L)+":(Session)_Had_Conversation"),i(_),j]),null!=E&&s([F+"_setCustomVar",E,i(i(L)+":(Page) Had Conversation"),i(_),V]),f&&o("send","pageview")):a("Olark: Google Analytics Custom variables are not supported when using analytics.js"));var c;r||l?(c=Math.floor((t-n)/1e3),(0>c||c>B)&&(c=0),o("send","event",i(i(L)),"Conversation",i(_),w?c:0)):(c=Math.floor((n-t)/1e3),(0>c||c>B)&&(c=0),o("send","event",i(i(L)),"Conversation",i(_),w?c:0))}var d=t.GoogleAnalytics.create_custom_tracker||null,u=t.GoogleAnalytics.load_ga_if_missing||null,p=void 0===t.GoogleAnalytics.legacy_compatibility?!0:t.GoogleAnalytics.legacy_compatibility,f=t.GoogleAnalytics.track_chat_start_page||null,g=(t.GoogleAnalytics.track_widget_events||null,t.GoogleAnalytics.tracking_id||null),b=t.GoogleAnalytics.allow_linker||null,m=t.GoogleAnalytics.allow_hash||null,v=t.GoogleAnalytics.domain||null,y=t.GoogleAnalytics.custom_config||null,w=t.GoogleAnalytics.track_message_delays||null,k=t.GoogleAnalytics.google_analytics_object||window.ga,x=t.GoogleAnalytics.use_default_tracker||!1,S=x?"":"olark",I=t.GoogleAnalytics.custom_tracking_id||null,C=t.GoogleAnalytics.force_legacy_mode||!1,P=C||!k,T=t.GoogleAnalytics.enable_custom_variables||null,M=t.GoogleAnalytics.had_conversation_session_slot_number||null,E=t.GoogleAnalytics.had_conversation_page_slot_number||null,A=t.GoogleAnalytics.had_conversation_visitor_slot_number||null,O=t.GoogleAnalytics.debug||document.location.toString().match(/__debug_ga/)||null,N=1,j=2,V=3,B=1200,F="",L=window.hblName||"Olark",D=e.data.getConversationObject({key:"lastMessageToOperatorSent",initialValue:null}),H=e.data.getConversationObject({key:"lastMessageToVisitorSent",initialValue:null}),q=e.data.getConversationObject({key:"lastMessageSent",initialValue:null}),R=e.data.getConversationObject({key:"isConversation",initialValue:null}),G=e.data.getConversationObject({key:"lastOperatorNickname",initialValue:""});O&&(window.olark._.ga_debug=this),e.chat.onReady(function(){c(),e.chat.onMessageToVisitor(function(e){var t=D.get(),n=e.message.nickname,a=e.message.automated;if("visitor"==q.get()||null==H.get()){var r=0;D.get()&&(r=Math.floor((+new Date-D.get())/1e3),(0>r||r>B)&&(r=0)),a?o("send","event",i(L),i("Olark Targeted Chat Sent a Message"),i("Targeted"),w?r:0):o("send","event",i(L),i("Operator Sent a Message"),i(n),w?r:0),H.set(+new Date)}null==H.get()&&H.set(+new Date),G.set(n),t&&!R.get()&&h(),R.set(t),q.set(a?"automated":"operator")}),e.chat.onMessageToOperator(function(){var e=H.get();if("operator"==q.get()||"automated"==q.get()||null==D.get()){var t=0;D.get()&&(t=Math.floor((+new Date-D.get())/1e3),(0>t||t>B)&&(t=0)),o("send","event",i(L),i("Visitor Sent a Message"),i("true"),w?t:0),D.set(+new Date)}null==D.get()&&D.set(+new Date),e&&!R.get()&&h(),R.set(e),q.set("visitor")}),olark("api.chat.onOfflineMessageToOperator",function(){o("send","event",i(L),i("Visitor Sent an Offline Message"),i("true"),0)})})}}),olark.declare({name:"VisitorInsight",version:"1.0",startup:function(e,t){function n(e){return"true"==e?!0:!1}var i=function(t){return t?e.__SPI_browser.__SPI_getSafeUrl(t):null},a=function(e){return(t.VisitorInsight||{})[e]||t.system[e]},o=2,r=6e4,s=3e4,l=2,_=18e5,c=5,h=t.chat.visitor_nickname||t.system.force_nickname||null,d=!0;(a("prechat_contains_referrer")===!1||t.chat.notify_operator_of_referrer===!1)&&(d=!1);var u=!0;(a("prechat_contains_location")===!1||t.chat.notify_operator_of_location===!1)&&(u=!1);var p=a("disable_default_visitor_information")?!0:!1,f=a("status_contains_referrer")===!1?!1:!0,g=a("status_contains_location")===!1?!1:!0,b=a("give_location_to_operator")===!1?!1:!0,m=a("max_location_notifs_when_not_conversing")||o,v=a("max_idle_milliseconds_for_location_notifs")||r,y=a("custom_visitor_ip")||null,w="undefined"==typeof a("clickpath_entries")?c:a("clickpath_entries"),k=t.system.disable_time_based_status_updates?!0:!1,x=null,S=+new Date,I=e.data.getConversationObject({key:"didGivePrechatInsight",initialValue:!1,backup:"vi1",backupTransform:n}),C=e.data.getConversationObject({key:"isConversation",initialValue:!1,backup:"vi2",backupTransform:n}),P=e.data.getConversationObject({key:"referrer",initialValue:document.referrer&&""!==document.referrer?document.referrer:null}),T=e.data.getConversationObject({key:"locationNotificationState",initialValue:"active",backup:"vi3",backupTransform:n}),M=e.data.getConversationObject({key:"locationNotifsWithoutConversing",initialValue:0}),E=e.data.getConversationObject({key:"timestampOfLastActivity",initialValue:(new Date).getTime(),backup:"vi4",backupTransform:parseInt}),A=e.data.getConversationObject({key:"pagesCount",initialValue:0}),O=e.data.getVisitorObject({key:"visitCount",initialValue:0}),N=e.data.getConversationObject({key:"visitorMessageCount",initialValue:0}),j=e.data.getConversationObject({key:"operatorMessageCount",initialValue:0}),V=e.data.getConversationObject({key:"operatorNotificationCount",initialValue:0,backup:"vi5",backupTransform:parseInt}),B=e.data.getConversationObject({key:"initialArrivalTimestamp",initialValue:(new Date).getTime()});h&&e.chat.updateVisitorNickname({snippet:h,hidesDefault:!0}),function(){e.chat.onMessageToOperator(function(){N.set(N.get()+1)}),e.chat.onMessageToVisitor(function(){j.set(j.get()+1)}),e.chat.onNotificationToOperator(function(){V.set(V.get()+1)}),e.__SPI_browser.onPageChange(function(){A.set(A.get()+1)}),A.__SPI_onChange(function(e){1==e.newValue&&O.set(O.get()+1)})}(),function(){var e=function(){N.get()>0&&j.get()>0&&C.set(!0)};N.__SPI_onChange(e),j.__SPI_onChange(e)}(),function(){var t=function(){E.set((new Date).getTime()),M.set(0),"disabled"!=T.get()&&T.set("active")};e.chat.onMessageToVisitor(function(){t()}),e.chat.onMessageToOperator(function(){t()}),M.__SPI_onChange(function(e){e.newValue>=m&&T.set("inactive")}),e.box.onDismiss(function(){T.set("inactive")}),e.chat.onCommandFromOperator(function(e){var t=e.command;("unfollow"==t.name||"nofollow"==t.name)&&(T.set("disabled"),olark("api.chat.sendNotificationToOperator",{body:"turned off URL notifications from this visitor"})),"end"===t.name&&T.set("inactive")})}(),function(){var t=function(){var e=(new Date).getTime(),t=e-E.get();return t>v?!0:!1},n=function(){var t=i(olark._.overrideWindowHref||document.location.href);e.chat.sendNotificationToOperator({body:"looking at "+t})},a=function(){b&&!t()&&"active"==T.get()&&(n(),M.set(M.get()+1))},o=function(){if(I.get()===!1&&!p){I.set(!0);var t=e.chat.getVisitorNickname();if(e.chat.sendNotificationToOperator({body:"talking to "+t}),u&&n(),d){var a=i(P.get());a&&e.chat.sendNotificationToOperator({body:"referred from "+a})}/{\s*geolocation\s*}/.test(t)||e.chat.sendNotificationToOperator({body:"located in {{geolocation}}"});var o=F();if(o)for(var r=0;r<o.length;r++)e.chat.sendNotificationToOperator({body:o[r]});e.chat.sendNotificationToOperator({body:"to see additional options, simply type !help"})}};e.__SPI_browser.onPageChange(function(){I.get()===!0&&a()}),N.__SPI_onChange(function(e){1==e.newValue&&o()}),V.__SPI_onChange(function(e){1==e.newValue&&o()})}();var F=function(){var t=[],n=e.visitor.getOrganization();return n&&t.push("might be affiliated with "+n),t},L=function(){var t=+new Date-S;if(!(t>_)){var n=function(e){return e>=864e5?"one day":e>=36e5?Math.floor(e/36e5)+" hours":e>=6e4?Math.floor(e/6e4)+" minutes":e>=1e3?Math.floor(e/1e3)+" seconds":null},a=i(document.location.href.toString()),o=i(P.get()),r=A.get(),c=O.get(),h=y||e.visitor.__SPI_getIp()||"{{ipaddress}}",d=(new Date).getTime()-B.get(),u=n(d),p=e.visitor.getFullName(),b=e.visitor.getEmailAddress(),m=e.visitor.getPhoneNumber(),v=e.visitor.__SPI_getNotes(),I=e.visitor.__SPI_getRecentPageHistory();x=v;var C=v.slice(0)||[];if(p&&C.push("speaking with "+p),b&&C.push(b),m&&C.push("phone number is "+m),a&&g&&C.push("looking at "+a),I&&I.length>1){var T=I.length-1,M=I.length-1-w;1>M&&(M=1),C.push("already looked at:");for(var E=T;E>=M;E--){var N=I[E];N.url?C.push("  "+i(N.url)):N.title&&C.push("  "+N.title)}}if(o&&f&&C.push("referred from "+o),C.push("located in {{geolocation}}"),C.push("{num_pages} pages viewed".replace(/{num_pages}/,r)),C.push(c>1?c+" visits":"first visit"),R>1?C.push("has had "+R+" conversations"):1==R&&C.push("first conversation"),C.push("using "+e.visitor.__SPI_getBrowser()+" on "+e.visitor.__SPI_getOs()),h&&C.push(h),u&&d>s)C.push("spent at least "+u+" so far");else{var j=n(s);j&&C.push("arrived within the last "+j)}var V=F();if(V)for(var D=0;D<V.length;D++)C.push(V[D]);e.chat.updateVisitorStatus({snippet:C});var H=d*l;s>H&&(H=s),e.chat.__SPI_isConversing()||k||setTimeout(L,H)}};e.chat.onReady(L),e.__SPI_browser.onPageChange(function(){setTimeout(L,100)});var D,H,q,R;e.visitor.getDetails(function(e){D=e.fullName,H=e.emailAddress,q=e.phoneNumber,R=e.conversationCount}),e.visitor.onChange(function(){e.visitor.getDetails(function(e){var t=!1;D!==e.fullName&&(D=e.fullName,t=!0),H!==e.emailAddress&&(H=e.emailAddress,t=!0),q!==e.phoneNumber&&(q=e.phoneNumber,t=!0),R!==e.conversationCount&&(R=e.conversationCount,t=!0),t&&L()})}),e.visitor.onChange(function(){if(null!==x){var t=e.visitor.__SPI_getNotes();t.join("")!=x.join("")&&L()}})}}),olark.declare({name:"VisitorImportance",version:"1.0",startup:function(e,t){function n(){olark("api.visitor.getDetails",function(t){for(var n="",i=0;3>i;i++)n+=t.importance>i?a:o;e.chat.updateVisitorNickname({snippet:n})})}var i=1==t.system.show_importance_in_nickname?!0:!1,a=t.system.filled_icon||String.fromCharCode(9733),o=t.system.unfilled_icon||String.fromCharCode(9734);i&&(olark("api.visitor.onChange",n),n())}}),olark.declare({name:"OfflineWarning",version:"1.0",startup:function(e,t){var n=t.system.offlineResponse||"Operator has gone away try again later";e.chat.onMessageToOperator(function(){setTimeout(function(){hbl.client.opavailable||olark("api.chat.sendMessageToVisitor",{body:n,nickname:" "})},1)})}}),olark.declare({name:"EndConversation",version:"1.0",startup:function(e,t){function n(e,t){var n=document.createElement("input");return n.type="submit",n.value=e,n.onclick=t,n.className="habla_offline_submit_input",n}function i(){var e=document.getElementById("habla_end_convo_div");if(!e){var t=document.getElementById("habla_conversation_div");e=document.createElement("div"),e.id="habla_end_convo_div",t.appendChild(e)}var i=document.createElement("p"),a=document.createElement("em");a.innerText=l.end_conversation_placeholder,i.appendChild(a);var r=document.createElement("hr"),s=document.createElement("div"),_=n(l.restart_conversation_input_text,o);s.id="habla_pre_chat_div",e.className="hbl_panel habla_offline_message_div hbl_pal_control_border hbl_pal_main_fg",s.appendChild(_),e.appendChild(i),e.appendChild(r),e.appendChild(s),e.style.clear="both",e.style.display="block"}function a(){var e=document.getElementById("habla_end_convo_div");e&&(e.style.display="none")}function o(){olark._.identityManager.deleteConversationId(),setTimeout(function(){window.location.reload()},1)}function r(){olark._.identityManager.deleteConversationId(),e.box.hide(),olark._.hlog("disabling chatbox due to #convo_ended_before_begin"),window.console&&console.warn&&window.console.warn("[olark] conversation expired, disabling chatbox"),e.box.__SPI_disableUserInterface(),e.chat.__SPI_disableChatConnection()}function s(e){e.is_ended?e.is_conversing?(i(),olark._.identityManager.keepConversationIdAlive()):r():a()}var l={end_conversation_placeholder:t.locale.end_conversation_placeholder||"Conversation ended",restart_conversation_input_text:t.locale.restart_conversation_input_text||"Start a new chat"};t.system.allow_end_conversation&&e.chat.onReady(function(){setTimeout(function(){e.chat.__SPI_getEndedState(function(t){t.is_ended?s(t):e.chat.__SPI_onEndedStateChanged(s)})})})}}),exportLegacyGlobal("hbl",hbl),exportLegacyGlobal("hblrpcTrick",hblrpcTrick),exportLegacyGlobal("hblDEBUG",hblDEBUG),exportLegacyGlobal("hblnoconsole",hblnoconsole),exportLegacyGlobal("hblHideUnsupported",hblHideUnsupported),exportLegacyGlobal("hblJavaScriptVersion",hblJavaScriptVersion),exportLegacyGlobal("hblBegincall",hblBegincall),exportLegacyGlobal("hblJSInline",hblJSInline),exportLegacyGlobal("hbl_max_event",hbl_max_event),exportLegacyGlobal("hbl_hostname_delimiter",hbl_hostname_delimiter),exportLegacyGlobal("wc_config",wc_config),exportLegacyGlobal("wc_init",wc_init),exportLegacyGlobal("habla_load_func",habla_load_func),exportLegacyGlobal("hbl_link",hbl_link),exportLegacyGlobal("__get_element_position",__get_element_position),exportLegacyGlobal("PollingManager",PollingManager),exportLegacyGlobal("habla_start_func",habla_start_func),exportLegacyGlobal("habla_error",habla_error),exportLegacyGlobal("wc_init_post",wc_init_post),exportLegacyGlobal("hbl_ssl",hbl_ssl),exportLegacyGlobal("hbl_ext",hbl_ext),exportLegacyGlobal("hblCacheConstant",hblCacheConstant),exportLegacyGlobal("hbl_hostname",hbl_hostname),exportLegacyGlobal("hbl_static_hostname",hbl_static_hostname),exportLegacyGlobal("hblStaticPath",hblStaticPath),exportLegacyGlobal("hblPostURL",hblPostURL),exportLegacyGlobal("hblPopupURL",hblPopupURL),exportLegacyGlobal("hblUrlHandler",hblUrlHandler),exportLegacyGlobal("hblPostStub",hblPostStub),exportLegacyGlobal("hblName",hblName),exportLegacyGlobal("hblInstallUrl",hblInstallUrl),exportLegacyGlobal("habla_window",habla_window),exportLegacyGlobal("hblHasinit",hblHasinit),exportLegacyGlobal("__get_olark_key",__get_olark_key),exportLegacyGlobal("__ie6_float_hack",__ie6_float_hack)},{underscore:1}]},{},[2]);}).call(this);